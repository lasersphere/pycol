<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>pycol.analyze &mdash; pycol 09.01.2022 documentation</title><link rel="stylesheet" href="../../_static/css/theme.css" type="text/css" />
    <link rel="stylesheet" href="../../_static/pygments.css" type="text/css" />
      <link rel="stylesheet" href="../../_static/css/borders.css" type="text/css" />
      <link rel="stylesheet" href="../../_static/css/wy-nav-content.css" type="text/css" />
  <!--[if lt IE 9]>
    <script src="../../_static/js/html5shiv.min.js"></script>
  <![endif]-->
  <script id="documentation_options" data-url_root="../../" src="../../_static/documentation_options.js"></script>
        <script src="../../_static/jquery.js"></script>
        <script src="../../_static/underscore.js"></script>
        <script src="../../_static/doctools.js"></script>
    <script src="../../_static/js/theme.js"></script>
    <link rel="index" title="Index" href="../../genindex.html" />
    <link rel="search" title="Search" href="../../search.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
            <a href="../../index.html" class="icon icon-home"> pycol
          </a>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <p class="caption"><span class="caption-text">Contents:</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../modules.html">pycol</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../index.html">pycol</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="../../index.html" class="icon icon-home"></a> &raquo;</li>
          <li><a href="../index.html">Module code</a> &raquo;</li>
      <li>pycol.analyze</li>
      <li class="wy-breadcrumbs-aside">
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <h1>Source code for pycol.analyze</h1><div class="highlight"><pre>
<span></span><span class="c1"># -*- coding: utf-8 -*-</span>
<span class="sd">&quot;&quot;&quot;</span>
<span class="sd">PyCLS.Analytics</span>

<span class="sd">Created on 07.05.2020</span>

<span class="sd">@author: Patrick Mueller</span>

<span class="sd">Module for analysing/evaluating/fitting data.</span>

<span class="sd">linear regression algorithms:</span>
<span class="sd">    - york(); [York et al., Am. J. Phys. 72, 367 (2004)]</span>
<span class="sd">    - linear_monte_carlo(); based on [Gebert et al., Phys. Rev. Lett. 115, 053003 (2015), Suppl.]</span>
<span class="sd">    - linear_monte_carlo_nd(); based on [Gebert et al., Phys. Rev. Lett. 115, 053003 (2015), Suppl.]</span>

<span class="sd">curve fitting methods:</span>
<span class="sd">    - curve_fit(); Encapsulates the scipy.optimize.curve_fit method to allow fixing parameters.</span>
<span class="sd">    - odr_fit(); Encapsulates the scipy.odr.odr method to accept inputs similarly to curve_fit().</span>

<span class="sd">classes:</span>
<span class="sd">    - Element; Holds spectroscopic information about a chemical element.</span>
<span class="sd">    - Radii; Holds information about nuclear charge radii of an chemical element.</span>
<span class="sd">    - King; Creates a King plot with isotope shifts or nuclear charge radii.</span>

<span class="sd">&quot;&quot;&quot;</span>

<span class="kn">import</span> <span class="nn">inspect</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">import</span> <span class="nn">scipy.stats</span> <span class="k">as</span> <span class="nn">st</span>
<span class="kn">import</span> <span class="nn">scipy.odr</span> <span class="k">as</span> <span class="nn">odr</span>
<span class="kn">import</span> <span class="nn">scipy.optimize</span> <span class="k">as</span> <span class="nn">so</span>
<span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>

<span class="kn">from</span> <span class="nn">.types</span> <span class="kn">import</span> <span class="o">*</span>
<span class="kn">from</span> <span class="nn">.</span> <span class="kn">import</span> <span class="n">tools</span>
<span class="kn">from</span> <span class="nn">.</span> <span class="kn">import</span> <span class="n">physics</span> <span class="k">as</span> <span class="n">ph</span>
<span class="kn">from</span> <span class="nn">.stats</span> <span class="kn">import</span> <span class="n">average</span>
<span class="c1"># from . import databases as dat</span>


<span class="k">def</span> <span class="nf">_get_rtype2</span><span class="p">(</span><span class="n">ab_dict</span><span class="p">:</span> <span class="nb">dict</span><span class="p">,</span> <span class="n">a</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="n">Iterable</span><span class="p">,</span> <span class="nb">any</span><span class="p">],</span> <span class="n">b</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="n">Iterable</span><span class="p">,</span> <span class="nb">any</span><span class="p">],</span> <span class="n">rtype</span><span class="p">:</span> <span class="nb">type</span> <span class="o">=</span> <span class="n">ndarray</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    :param ab_dict: The nested dictionary of depth 2, where values are extracted from.</span>
<span class="sd">    :param a: The list of keys of the first level of &#39;ab_dict&#39;.</span>
<span class="sd">    :param b: The list of keys of the second level of &#39;ab_dict&#39;.</span>
<span class="sd">    :param rtype: The type in which the results will be returned. Currently supported special types are [dict, ].</span>
<span class="sd">     The standard &#39;rtype&#39; is a numpy array.</span>
<span class="sd">    :returns: A subset of the dictionary &#39;ab_dict&#39; as a dictionary or a numpy array.</span>
<span class="sd">    :raises: ValueError . &#39;a&#39; and &#39;b&#39; must be Non-Iterables or an Iterable of the corresponding types.</span>
<span class="sd">    :raises: KeyError . ab_dict[a][b] must exist for all a and b.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">a_arr</span><span class="p">,</span> <span class="n">b_arr</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="n">a</span><span class="p">),</span> <span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="n">b</span><span class="p">)</span>
    <span class="n">a_dim</span><span class="p">,</span> <span class="n">line_dim</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">a_arr</span><span class="o">.</span><span class="n">shape</span><span class="p">),</span> <span class="nb">len</span><span class="p">(</span><span class="n">b_arr</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">a_dim</span> <span class="o">==</span> <span class="mi">0</span> <span class="ow">and</span> <span class="n">line_dim</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">rtype</span> <span class="o">==</span> <span class="nb">dict</span><span class="p">:</span>
            <span class="k">return</span> <span class="p">{</span><span class="n">a</span><span class="p">:</span> <span class="p">{</span><span class="n">b</span><span class="p">:</span> <span class="n">ab_dict</span><span class="p">[</span><span class="n">a</span><span class="p">][</span><span class="n">b</span><span class="p">]}}</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">ab_dict</span><span class="p">[</span><span class="n">a</span><span class="p">][</span><span class="n">b</span><span class="p">]</span>
    <span class="k">elif</span> <span class="n">a_dim</span> <span class="o">==</span> <span class="mi">0</span> <span class="ow">and</span> <span class="n">line_dim</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">rtype</span> <span class="o">==</span> <span class="nb">dict</span><span class="p">:</span>
            <span class="k">return</span> <span class="p">{</span><span class="n">b_i</span><span class="p">:</span> <span class="n">ab_dict</span><span class="p">[</span><span class="n">a</span><span class="p">][</span><span class="n">b_i</span><span class="p">]</span> <span class="k">for</span> <span class="n">b_i</span> <span class="ow">in</span> <span class="n">b</span><span class="p">}</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">ab_dict</span><span class="p">[</span><span class="n">a</span><span class="p">][</span><span class="n">b_i</span><span class="p">]</span> <span class="k">for</span> <span class="n">b_i</span> <span class="ow">in</span> <span class="n">b</span><span class="p">])</span>
    <span class="k">elif</span> <span class="n">a_dim</span> <span class="o">==</span> <span class="mi">1</span> <span class="ow">and</span> <span class="n">line_dim</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">rtype</span> <span class="o">==</span> <span class="nb">dict</span><span class="p">:</span>
            <span class="k">return</span> <span class="p">{</span><span class="n">a_i</span><span class="p">:</span> <span class="n">ab_dict</span><span class="p">[</span><span class="n">a_i</span><span class="p">][</span><span class="n">b</span><span class="p">]</span> <span class="k">for</span> <span class="n">a_i</span> <span class="ow">in</span> <span class="n">a</span><span class="p">}</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">ab_dict</span><span class="p">[</span><span class="n">a_i</span><span class="p">][</span><span class="n">b</span><span class="p">]</span> <span class="k">for</span> <span class="n">a_i</span> <span class="ow">in</span> <span class="n">a</span><span class="p">])</span>
    <span class="k">elif</span> <span class="n">a_dim</span> <span class="o">==</span> <span class="mi">1</span> <span class="ow">and</span> <span class="n">line_dim</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">rtype</span> <span class="o">==</span> <span class="nb">dict</span><span class="p">:</span>
            <span class="k">return</span> <span class="p">{</span><span class="n">a_i</span><span class="p">:</span> <span class="p">{</span><span class="n">b_i</span><span class="p">:</span> <span class="n">ab_dict</span><span class="p">[</span><span class="n">a_i</span><span class="p">][</span><span class="n">b_i</span><span class="p">]</span> <span class="k">for</span> <span class="n">b_i</span> <span class="ow">in</span> <span class="n">b</span><span class="p">}</span> <span class="k">for</span> <span class="n">a_i</span> <span class="ow">in</span> <span class="n">a</span><span class="p">}</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([[</span><span class="n">ab_dict</span><span class="p">[</span><span class="n">a_i</span><span class="p">][</span><span class="n">b_i</span><span class="p">]</span> <span class="k">for</span> <span class="n">b_i</span> <span class="ow">in</span> <span class="n">b</span><span class="p">]</span> <span class="k">for</span> <span class="n">a_i</span> <span class="ow">in</span> <span class="n">a</span><span class="p">])</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\&#39;</span><span class="s1">a</span><span class="se">\&#39;</span><span class="s1"> and </span><span class="se">\&#39;</span><span class="s1">b</span><span class="se">\&#39;</span><span class="s1"> must be Non-Iterables or an Iterable of the corresponding types.&#39;</span><span class="p">)</span>


<div class="viewcode-block" id="straight"><a class="viewcode-back" href="../../pycol.html#pycol.analyze.straight">[docs]</a><span class="k">def</span> <span class="nf">straight</span><span class="p">(</span><span class="n">x</span><span class="p">:</span> <span class="n">array_like</span><span class="p">,</span> <span class="n">a</span><span class="p">:</span> <span class="n">array_like</span><span class="p">,</span> <span class="n">b</span><span class="p">:</span> <span class="n">array_like</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">ndarray</span><span class="p">:</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    :param x: The x values.</span>
<span class="sd">    :param a: The y-intercept.</span>
<span class="sd">    :param b: The slope.</span>
<span class="sd">    :returns: The y values resulting from the &#39;x&#39; values via the given linear relation.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">x</span><span class="p">,</span> <span class="n">a</span><span class="p">,</span> <span class="n">b</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="n">x</span><span class="p">),</span> <span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="n">a</span><span class="p">),</span> <span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="n">b</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">a</span> <span class="o">+</span> <span class="n">b</span> <span class="o">*</span> <span class="n">x</span></div>


<div class="viewcode-block" id="straight_slope"><a class="viewcode-back" href="../../pycol.html#pycol.analyze.straight_slope">[docs]</a><span class="k">def</span> <span class="nf">straight_slope</span><span class="p">(</span><span class="n">p_0</span><span class="p">:</span> <span class="n">array_iter</span><span class="p">,</span> <span class="n">p_1</span><span class="p">:</span> <span class="n">array_iter</span><span class="p">,</span> <span class="n">axis</span><span class="o">=-</span><span class="mi">1</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">ndarray</span><span class="p">:</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    :param p_0: The first point(s).</span>
<span class="sd">    :param p_1: The second point(s).</span>
<span class="sd">    :param axis: The axis along which the vector components are aligned.</span>
<span class="sd">    :returns: The parametrization of a straight line in n dimensions.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">p_0</span><span class="p">,</span> <span class="n">p_1</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="n">p_0</span><span class="p">),</span> <span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="n">p_1</span><span class="p">)</span>
    <span class="n">dr</span> <span class="o">=</span> <span class="n">p_1</span> <span class="o">-</span> <span class="n">p_0</span>
    <span class="k">return</span> <span class="n">dr</span> <span class="o">/</span> <span class="n">np</span><span class="o">.</span><span class="n">expand_dims</span><span class="p">(</span><span class="n">tools</span><span class="o">.</span><span class="n">absolute</span><span class="p">(</span><span class="n">dr</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="n">axis</span><span class="p">),</span> <span class="n">axis</span><span class="o">=</span><span class="n">axis</span><span class="p">)</span></div>


<div class="viewcode-block" id="straight_std"><a class="viewcode-back" href="../../pycol.html#pycol.analyze.straight_std">[docs]</a><span class="k">def</span> <span class="nf">straight_std</span><span class="p">(</span><span class="n">x</span><span class="p">:</span> <span class="n">array_like</span><span class="p">,</span> <span class="n">sigma_a</span><span class="p">:</span> <span class="n">array_like</span><span class="p">,</span> <span class="n">sigma_b</span><span class="p">:</span> <span class="n">array_like</span><span class="p">,</span> <span class="n">corr_ab</span><span class="p">:</span> <span class="n">array_like</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">ndarray</span><span class="p">:</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    :param x: The x values.</span>
<span class="sd">    :param sigma_a: The standard deviation of the y-intercept.</span>
<span class="sd">    :param sigma_b: The standard deviation of the slope.</span>
<span class="sd">    :param corr_ab: The correlation coefficient between the slope and y-intercept.</span>
<span class="sd">    :returns: The standard deviation of a straight line where the x values do not have uncertainties.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">x</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
    <span class="n">sigma_a</span><span class="p">,</span> <span class="n">sigma_b</span><span class="p">,</span> <span class="n">corr_ab</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="n">sigma_a</span><span class="p">),</span> <span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="n">sigma_b</span><span class="p">),</span> <span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="n">corr_ab</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">sigma_a</span> <span class="o">**</span> <span class="mi">2</span> <span class="o">+</span> <span class="p">(</span><span class="n">x</span> <span class="o">*</span> <span class="n">sigma_b</span><span class="p">)</span> <span class="o">**</span> <span class="mi">2</span> <span class="o">+</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">x</span> <span class="o">*</span> <span class="n">sigma_a</span> <span class="o">*</span> <span class="n">sigma_b</span> <span class="o">*</span> <span class="n">corr_ab</span><span class="p">)</span></div>


<div class="viewcode-block" id="straight_x_std"><a class="viewcode-back" href="../../pycol.html#pycol.analyze.straight_x_std">[docs]</a><span class="k">def</span> <span class="nf">straight_x_std</span><span class="p">(</span><span class="n">x</span><span class="p">:</span> <span class="n">array_like</span><span class="p">,</span> <span class="n">b</span><span class="p">:</span> <span class="n">array_like</span><span class="p">,</span> <span class="n">sigma_x</span><span class="p">:</span> <span class="n">array_like</span><span class="p">,</span>
                   <span class="n">sigma_a</span><span class="p">:</span> <span class="n">array_like</span><span class="p">,</span> <span class="n">sigma_b</span><span class="p">:</span> <span class="n">array_like</span><span class="p">,</span> <span class="n">corr_ab</span><span class="p">:</span> <span class="n">array_like</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">ndarray</span><span class="p">:</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    :param x: The x values.</span>
<span class="sd">    :param b: The slope.</span>
<span class="sd">    :param sigma_x: The standard deviation of the x values.</span>
<span class="sd">    :param sigma_a: The standard deviation of the y-intercept.</span>
<span class="sd">    :param sigma_b: The standard deviation of the slope.</span>
<span class="sd">    :param corr_ab: The correlation coefficient between the slope and y-intercept.</span>
<span class="sd">    :returns: The standard deviation of a straight line where all input values have uncertainties.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">x</span><span class="p">,</span> <span class="n">sigma_x</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="n">x</span><span class="p">),</span> <span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="n">sigma_x</span><span class="p">)</span>
    <span class="n">b</span><span class="p">,</span> <span class="n">sigma_a</span><span class="p">,</span> <span class="n">sigma_b</span><span class="p">,</span> <span class="n">corr_ab</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="n">b</span><span class="p">),</span> <span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="n">sigma_a</span><span class="p">),</span> <span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="n">sigma_b</span><span class="p">),</span> <span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="n">corr_ab</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">sigma_a</span> <span class="o">**</span> <span class="mi">2</span> <span class="o">+</span> <span class="p">(</span><span class="n">x</span> <span class="o">*</span> <span class="n">sigma_b</span><span class="p">)</span> <span class="o">**</span> <span class="mi">2</span> <span class="o">+</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">x</span> <span class="o">*</span> <span class="n">sigma_a</span> <span class="o">*</span> <span class="n">sigma_b</span> <span class="o">*</span> <span class="n">corr_ab</span>
                   <span class="o">+</span> <span class="p">(</span><span class="n">b</span> <span class="o">*</span> <span class="n">sigma_x</span><span class="p">)</span> <span class="o">**</span> <span class="mi">2</span> <span class="o">+</span> <span class="p">(</span><span class="n">sigma_b</span> <span class="o">*</span> <span class="n">sigma_x</span><span class="p">)</span> <span class="o">**</span> <span class="mi">2</span><span class="p">)</span></div>


<div class="viewcode-block" id="draw_straight_unc_area"><a class="viewcode-back" href="../../pycol.html#pycol.analyze.draw_straight_unc_area">[docs]</a><span class="k">def</span> <span class="nf">draw_straight_unc_area</span><span class="p">(</span><span class="n">x</span><span class="p">:</span> <span class="n">array_like</span><span class="p">,</span> <span class="n">y</span><span class="p">:</span> <span class="n">array_like</span><span class="p">,</span> <span class="n">sigma_a</span><span class="p">:</span> <span class="n">array_like</span><span class="p">,</span> <span class="n">sigma_b</span><span class="p">:</span> <span class="n">array_like</span><span class="p">,</span>
                           <span class="n">corr_ab</span><span class="p">:</span> <span class="n">array_like</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    :param x: The x values.</span>
<span class="sd">    :param y: The y values.</span>
<span class="sd">    :param sigma_a: The standard deviation of the y-intercept.</span>
<span class="sd">    :param sigma_b: The standard deviation of the slope.</span>
<span class="sd">    :param corr_ab: The correlation coefficient between the slope and y-intercept.</span>
<span class="sd">    :param kwargs: The keyword arguments for the fill_between function.</span>
<span class="sd">    :returns: The standard deviation of a straight line where the x values do not have uncertainties.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">unc</span> <span class="o">=</span> <span class="n">straight_std</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">sigma_a</span><span class="p">,</span> <span class="n">sigma_b</span><span class="p">,</span> <span class="n">corr_ab</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">fill_between</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span> <span class="o">-</span> <span class="n">unc</span><span class="p">,</span> <span class="n">y</span> <span class="o">+</span> <span class="n">unc</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span></div>


<div class="viewcode-block" id="cubic"><a class="viewcode-back" href="../../pycol.html#pycol.analyze.cubic">[docs]</a><span class="k">def</span> <span class="nf">cubic</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">,</span> <span class="n">c</span><span class="p">,</span> <span class="n">d</span><span class="p">):</span>
    <span class="k">return</span> <span class="n">a</span> <span class="o">+</span> <span class="n">b</span> <span class="o">*</span> <span class="n">x</span> <span class="o">+</span> <span class="mf">0.5</span> <span class="o">*</span> <span class="n">c</span> <span class="o">*</span> <span class="n">x</span> <span class="o">**</span> <span class="mi">2</span> <span class="o">+</span> <span class="mf">1.</span> <span class="o">/</span> <span class="mf">6.</span> <span class="o">*</span> <span class="n">d</span> <span class="o">*</span> <span class="n">x</span> <span class="o">**</span> <span class="mi">3</span></div>


<div class="viewcode-block" id="ellipse2d"><a class="viewcode-back" href="../../pycol.html#pycol.analyze.ellipse2d">[docs]</a><span class="k">def</span> <span class="nf">ellipse2d</span><span class="p">(</span><span class="n">x</span><span class="p">:</span> <span class="n">array_like</span><span class="p">,</span> <span class="n">y</span><span class="p">:</span> <span class="n">array_like</span><span class="p">,</span> <span class="n">scale_x</span><span class="p">:</span> <span class="n">array_like</span><span class="p">,</span> <span class="n">scale_y</span><span class="p">:</span> <span class="n">array_like</span><span class="p">,</span>
              <span class="n">phi</span><span class="p">:</span> <span class="n">array_like</span><span class="p">,</span> <span class="n">corr</span><span class="p">:</span> <span class="n">array_like</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="p">(</span><span class="n">ndarray</span><span class="p">,</span> <span class="n">ndarray</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    :param x: The x-component of the position of the ellipse.</span>
<span class="sd">    :param y: The y-component of the position of the ellipse.</span>
<span class="sd">    :param scale_x: The amplitude of the x-component.</span>
<span class="sd">    :param scale_y: The amplitude of the y-component.</span>
<span class="sd">    :param phi: The angle between the vector to the point on the ellipse and the x-axis.</span>
<span class="sd">    :param corr: The correlation coefficient between the x and y data.</span>
<span class="sd">    :returns: A point on an ellipse in 2d-space with amplitudes &#39;x&#39;, &#39;y&#39;</span>
<span class="sd">     and correlation &#39;corr&#39; between x- and y-component.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">scale_x</span><span class="p">,</span> <span class="n">scale_y</span><span class="p">,</span> <span class="n">corr</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="n">x</span><span class="p">),</span> <span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="n">y</span><span class="p">),</span> \
        <span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="n">scale_x</span><span class="p">),</span> <span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="n">scale_y</span><span class="p">),</span> <span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="n">corr</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">x</span> <span class="o">+</span> <span class="n">scale_x</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">phi</span><span class="p">),</span> <span class="n">y</span> <span class="o">+</span> <span class="n">scale_y</span> <span class="o">*</span> <span class="p">(</span><span class="n">corr</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">phi</span><span class="p">)</span> <span class="o">+</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="mi">1</span> <span class="o">-</span> <span class="n">corr</span> <span class="o">**</span> <span class="mi">2</span><span class="p">)</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">phi</span><span class="p">))</span></div>


<div class="viewcode-block" id="draw_sigma2d"><a class="viewcode-back" href="../../pycol.html#pycol.analyze.draw_sigma2d">[docs]</a><span class="k">def</span> <span class="nf">draw_sigma2d</span><span class="p">(</span><span class="n">x</span><span class="p">:</span> <span class="n">array_iter</span><span class="p">,</span> <span class="n">y</span><span class="p">:</span> <span class="n">array_iter</span><span class="p">,</span> <span class="n">sigma_x</span><span class="p">:</span> <span class="n">array_iter</span><span class="p">,</span> <span class="n">sigma_y</span><span class="p">:</span> <span class="n">array_iter</span><span class="p">,</span>
                 <span class="n">corr</span><span class="p">:</span> <span class="n">array_iter</span><span class="p">,</span> <span class="n">n</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    :param x: The x data.</span>
<span class="sd">    :param y: The y data.</span>
<span class="sd">    :param sigma_x: The 1-sigma uncertainties of the x data.</span>
<span class="sd">    :param sigma_y: The 1-sigma uncertainties of the y data.</span>
<span class="sd">    :param corr: The correlation coefficients between the x and y data.</span>
<span class="sd">    :param n: The maximum sigma region to draw</span>
<span class="sd">    :param kwargs: Additional keyword arguments are passed to plt.plot().</span>
<span class="sd">    :returns: None. Draws the sigma-bounds of the given data points (x, y) until the n-sigma region.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">phi</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mf">0.</span><span class="p">,</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="p">,</span> <span class="mf">0.001</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">x_i</span><span class="p">,</span> <span class="n">y_i</span><span class="p">,</span> <span class="n">s_x</span><span class="p">,</span> <span class="n">s_y</span><span class="p">,</span> <span class="n">r</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">sigma_x</span><span class="p">,</span> <span class="n">sigma_y</span><span class="p">,</span> <span class="n">corr</span><span class="p">):</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">n</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">):</span>
            <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="o">*</span><span class="n">ellipse2d</span><span class="p">(</span><span class="n">x_i</span><span class="p">,</span> <span class="n">y_i</span><span class="p">,</span> <span class="n">i</span> <span class="o">*</span> <span class="n">s_x</span><span class="p">,</span> <span class="n">i</span> <span class="o">*</span> <span class="n">s_y</span><span class="p">,</span> <span class="n">phi</span><span class="p">,</span> <span class="n">r</span><span class="p">),</span> <span class="s1">&#39;k-&#39;</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span></div>


<div class="viewcode-block" id="weight"><a class="viewcode-back" href="../../pycol.html#pycol.analyze.weight">[docs]</a><span class="k">def</span> <span class="nf">weight</span><span class="p">(</span><span class="n">sigma</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    :param sigma: The 1-sigma uncertainty.</span>
<span class="sd">    :returns: The weight corresponding to the 1-sigma uncertainty &#39;sigma&#39;</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="mf">1.</span> <span class="o">/</span> <span class="n">sigma</span> <span class="o">**</span> <span class="mi">2</span></div>


<div class="viewcode-block" id="york"><a class="viewcode-back" href="../../pycol.html#pycol.analyze.york">[docs]</a><span class="k">def</span> <span class="nf">york</span><span class="p">(</span><span class="n">x</span><span class="p">:</span> <span class="n">array_iter</span><span class="p">,</span> <span class="n">y</span><span class="p">:</span> <span class="n">array_iter</span><span class="p">,</span> <span class="n">sigma_x</span><span class="p">:</span> <span class="n">array_iter</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">sigma_y</span><span class="p">:</span> <span class="n">array_iter</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
         <span class="n">corr</span><span class="p">:</span> <span class="n">array_iter</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">iter_max</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">200</span><span class="p">,</span> <span class="n">report</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span> <span class="n">show</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    A linear regression algorithm to find the best straight line, given normally distributed errors for x and y</span>
<span class="sd">    and correlation coefficients between errors in x and y. The algorithm is described in</span>
<span class="sd">    [&#39;Unified equations for the slope, intercept, and standard errors of the best straight line&#39;,</span>
<span class="sd">    York et al., American Journal of Physics 72, 367 (2004)]. See the comments to compare the individual steps.</span>

<span class="sd">    :param x: The x data.</span>
<span class="sd">    :param y: The y data.</span>
<span class="sd">    :param sigma_x: The 1-sigma uncertainties of the x data.</span>
<span class="sd">    :param sigma_y: The 1-sigma uncertainties of the y data.</span>
<span class="sd">    :param corr: The correlation coefficients between the x and y data.</span>
<span class="sd">    :param iter_max: The maximum number of iterations to find the best slope.</span>
<span class="sd">    :param report: Whether to print the result of the fit.</span>
<span class="sd">    :param show: Whether to plot the fit result.</span>
<span class="sd">    :returns: a, b, sigma_a, sigma_b, corr_ab. The best y-intercept and slope,</span>
<span class="sd">     their respective 1-sigma uncertainties and their correlation coefficient.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">x</span><span class="p">,</span> <span class="n">y</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="n">x</span><span class="p">),</span> <span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="n">y</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">sigma_x</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">sigma_x</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">full_like</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="mf">1.</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">report</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">No uncertainties for </span><span class="se">\&#39;</span><span class="s1">x</span><span class="se">\&#39;</span><span class="s1"> were given. Assuming </span><span class="se">\&#39;</span><span class="s1">sigma_x</span><span class="se">\&#39;</span><span class="s1">=1.&#39;</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">sigma_y</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">sigma_y</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">full_like</span><span class="p">(</span><span class="n">y</span><span class="p">,</span> <span class="mf">1.</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">report</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">No uncertainties for </span><span class="se">\&#39;</span><span class="s1">y</span><span class="se">\&#39;</span><span class="s1"> were given. Assuming </span><span class="se">\&#39;</span><span class="s1">sigma_y</span><span class="se">\&#39;</span><span class="s1">=1.&#39;</span><span class="p">)</span>
    <span class="n">sigma_2d</span> <span class="o">=</span> <span class="kc">True</span>
    <span class="k">if</span> <span class="n">corr</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">sigma_2d</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="n">corr</span> <span class="o">=</span> <span class="mf">0.</span>

    <span class="n">sigma_x</span><span class="p">,</span> <span class="n">sigma_y</span><span class="p">,</span> <span class="n">corr</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="n">sigma_x</span><span class="p">),</span> <span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="n">sigma_y</span><span class="p">),</span> <span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="n">corr</span><span class="p">)</span>

    <span class="n">p_opt</span><span class="p">,</span> <span class="n">_</span> <span class="o">=</span> <span class="n">so</span><span class="o">.</span><span class="n">curve_fit</span><span class="p">(</span><span class="n">straight</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">p0</span><span class="o">=</span><span class="p">[</span><span class="mf">0.</span><span class="p">,</span> <span class="mf">1.</span><span class="p">],</span> <span class="n">sigma</span><span class="o">=</span><span class="n">sigma_y</span><span class="p">)</span>  <span class="c1"># (1)</span>
    <span class="n">b_init</span> <span class="o">=</span> <span class="n">p_opt</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
    <span class="n">b</span> <span class="o">=</span> <span class="n">b_init</span>

    <span class="n">w_x</span><span class="p">,</span> <span class="n">w_y</span> <span class="o">=</span> <span class="n">weight</span><span class="p">(</span><span class="n">sigma_x</span><span class="p">),</span> <span class="n">weight</span><span class="p">(</span><span class="n">sigma_y</span><span class="p">)</span>  <span class="c1"># w(X_i), w(Y_i), (2)</span>
    <span class="n">alpha</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">w_x</span> <span class="o">*</span> <span class="n">w_y</span><span class="p">)</span>

    <span class="n">n</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="n">r_tol</span> <span class="o">=</span> <span class="mf">1e-15</span>
    <span class="n">tol</span> <span class="o">=</span> <span class="mf">1.</span>
    <span class="n">mod_w</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="n">x_bar</span><span class="p">,</span> <span class="n">y_bar</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="kc">None</span>
    <span class="n">beta</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="k">while</span> <span class="n">tol</span> <span class="o">&gt;</span> <span class="n">r_tol</span> <span class="ow">and</span> <span class="n">n</span> <span class="o">&lt;</span> <span class="n">iter_max</span><span class="p">:</span>  <span class="c1"># (6)</span>
        <span class="n">b_init</span> <span class="o">=</span> <span class="n">b</span>
        <span class="n">mod_w</span> <span class="o">=</span> <span class="n">w_x</span> <span class="o">*</span> <span class="n">w_y</span> <span class="o">/</span> <span class="p">(</span><span class="n">w_x</span> <span class="o">+</span> <span class="n">b_init</span> <span class="o">**</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">w_y</span> <span class="o">-</span> <span class="mf">2.</span> <span class="o">*</span> <span class="n">b_init</span> <span class="o">*</span> <span class="n">corr</span> <span class="o">*</span> <span class="n">alpha</span><span class="p">)</span>  <span class="c1"># W_i, (3)</span>
        <span class="n">x_bar</span><span class="p">,</span> <span class="n">y_bar</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">average</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">weights</span><span class="o">=</span><span class="n">mod_w</span><span class="p">),</span> <span class="n">np</span><span class="o">.</span><span class="n">average</span><span class="p">(</span><span class="n">y</span><span class="p">,</span> <span class="n">weights</span><span class="o">=</span><span class="n">mod_w</span><span class="p">)</span>  <span class="c1"># (4)</span>
        <span class="n">u</span> <span class="o">=</span> <span class="n">x</span> <span class="o">-</span> <span class="n">x_bar</span>
        <span class="n">v</span> <span class="o">=</span> <span class="n">y</span> <span class="o">-</span> <span class="n">y_bar</span>
        <span class="n">beta</span> <span class="o">=</span> <span class="n">mod_w</span> <span class="o">*</span> <span class="p">(</span><span class="n">u</span> <span class="o">/</span> <span class="n">w_y</span> <span class="o">+</span> <span class="n">v</span> <span class="o">*</span> <span class="n">b_init</span> <span class="o">/</span> <span class="n">w_x</span> <span class="o">-</span> <span class="n">straight</span><span class="p">(</span><span class="n">u</span><span class="p">,</span> <span class="n">v</span><span class="p">,</span> <span class="n">b_init</span><span class="p">)</span> <span class="o">*</span> <span class="n">corr</span> <span class="o">/</span> <span class="n">alpha</span><span class="p">)</span>
        <span class="n">b</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">mod_w</span> <span class="o">*</span> <span class="n">beta</span> <span class="o">*</span> <span class="n">v</span><span class="p">)</span> <span class="o">/</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">mod_w</span> <span class="o">*</span> <span class="n">beta</span> <span class="o">*</span> <span class="n">u</span><span class="p">)</span>  <span class="c1"># (5)</span>
        <span class="n">tol</span> <span class="o">=</span> <span class="nb">abs</span><span class="p">((</span><span class="n">b</span> <span class="o">-</span> <span class="n">b_init</span><span class="p">)</span> <span class="o">/</span> <span class="n">b</span><span class="p">)</span>
        <span class="n">n</span> <span class="o">+=</span> <span class="mi">1</span>  <span class="c1"># (6)</span>

    <span class="n">a</span> <span class="o">=</span> <span class="n">y_bar</span> <span class="o">-</span> <span class="n">b</span> <span class="o">*</span> <span class="n">x_bar</span>  <span class="c1"># (7)</span>
    <span class="n">x_i</span> <span class="o">=</span> <span class="n">x_bar</span> <span class="o">+</span> <span class="n">beta</span>  <span class="c1"># (8)</span>
    <span class="n">x_bar</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">average</span><span class="p">(</span><span class="n">x_i</span><span class="p">,</span> <span class="n">weights</span><span class="o">=</span><span class="n">mod_w</span><span class="p">)</span>  <span class="c1"># (9)</span>
    <span class="n">u</span> <span class="o">=</span> <span class="n">x_i</span> <span class="o">-</span> <span class="n">x_bar</span>
    <span class="n">sigma_b</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="mf">1.</span> <span class="o">/</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">mod_w</span> <span class="o">*</span> <span class="n">u</span> <span class="o">**</span> <span class="mi">2</span><span class="p">))</span>  <span class="c1"># (10)</span>
    <span class="n">sigma_a</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="mf">1.</span> <span class="o">/</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">mod_w</span><span class="p">)</span> <span class="o">+</span> <span class="n">x_bar</span> <span class="o">**</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">sigma_b</span> <span class="o">**</span> <span class="mi">2</span><span class="p">)</span>
    <span class="n">corr_ab</span> <span class="o">=</span> <span class="o">-</span><span class="n">x_bar</span> <span class="o">*</span> <span class="n">sigma_b</span> <span class="o">/</span> <span class="n">sigma_a</span>
    <span class="n">chi2</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">mod_w</span> <span class="o">*</span> <span class="p">(</span><span class="n">y</span> <span class="o">-</span> <span class="n">b</span> <span class="o">*</span> <span class="n">x</span> <span class="o">-</span> <span class="n">a</span><span class="p">)</span> <span class="o">**</span> <span class="mi">2</span><span class="p">)</span> <span class="o">/</span> <span class="p">(</span><span class="n">x</span><span class="o">.</span><span class="n">size</span> <span class="o">-</span> <span class="mi">2</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">report</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">n</span> <span class="o">==</span> <span class="n">iter_max</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">Maximum number of iterations (</span><span class="si">{}</span><span class="s1">) was reached.&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">iter_max</span><span class="p">))</span>
        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">Fit result:</span><span class="se">\n</span><span class="s1">a: </span><span class="si">{}</span><span class="s1"> +- </span><span class="si">{}</span><span class="se">\n</span><span class="s1">b: </span><span class="si">{}</span><span class="s1"> +- </span><span class="si">{}</span><span class="se">\n</span><span class="s1">corr_ab: </span><span class="si">{}</span><span class="se">\n</span><span class="s1">chi2: </span><span class="si">{}</span><span class="s1">&#39;</span>
              <span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="n">sigma_a</span><span class="p">,</span> <span class="n">b</span><span class="p">,</span> <span class="n">sigma_b</span><span class="p">,</span> <span class="n">corr_ab</span><span class="p">,</span> <span class="n">chi2</span><span class="p">))</span>
    <span class="k">if</span> <span class="n">show</span><span class="p">:</span>
        <span class="n">x_cont</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">min</span><span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="o">-</span> <span class="mf">0.1</span> <span class="o">*</span> <span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="o">-</span> <span class="n">np</span><span class="o">.</span><span class="n">min</span><span class="p">(</span><span class="n">x</span><span class="p">)),</span> <span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="o">+</span> <span class="mf">0.1</span> <span class="o">*</span> <span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="o">-</span> <span class="n">np</span><span class="o">.</span><span class="n">min</span><span class="p">(</span><span class="n">x</span><span class="p">)),</span> <span class="mi">1001</span><span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s1">&#39;x&#39;</span><span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s1">&#39;y&#39;</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">sigma_2d</span><span class="p">:</span>
            <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="s1">&#39;k.&#39;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;Data&#39;</span><span class="p">)</span>
            <span class="n">draw_sigma2d</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">sigma_x</span><span class="p">,</span> <span class="n">sigma_y</span><span class="p">,</span> <span class="n">corr</span><span class="p">,</span> <span class="n">n</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">plt</span><span class="o">.</span><span class="n">errorbar</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">xerr</span><span class="o">=</span><span class="n">sigma_x</span><span class="p">,</span> <span class="n">yerr</span><span class="o">=</span><span class="n">sigma_y</span><span class="p">,</span> <span class="n">fmt</span><span class="o">=</span><span class="s1">&#39;k.&#39;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;Data&#39;</span><span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">x_cont</span><span class="p">,</span> <span class="n">straight</span><span class="p">(</span><span class="n">x_cont</span><span class="p">,</span> <span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">),</span> <span class="s1">&#39;b-&#39;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;Fit&#39;</span><span class="p">)</span>
        <span class="n">y_min</span> <span class="o">=</span> <span class="n">straight</span><span class="p">(</span><span class="n">x_cont</span><span class="p">,</span> <span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">)</span> <span class="o">-</span> <span class="n">straight_std</span><span class="p">(</span><span class="n">x_cont</span><span class="p">,</span> <span class="n">sigma_a</span><span class="p">,</span> <span class="n">sigma_b</span><span class="p">,</span> <span class="n">corr_ab</span><span class="p">)</span>
        <span class="n">y_max</span> <span class="o">=</span> <span class="n">straight</span><span class="p">(</span><span class="n">x_cont</span><span class="p">,</span> <span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">)</span> <span class="o">+</span> <span class="n">straight_std</span><span class="p">(</span><span class="n">x_cont</span><span class="p">,</span> <span class="n">sigma_a</span><span class="p">,</span> <span class="n">sigma_b</span><span class="p">,</span> <span class="n">corr_ab</span><span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">fill_between</span><span class="p">(</span><span class="n">x_cont</span><span class="p">,</span> <span class="n">y_min</span><span class="p">,</span> <span class="n">y_max</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;b&#39;</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.3</span><span class="p">,</span> <span class="n">antialiased</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span><span class="n">loc</span><span class="o">=</span><span class="s1">&#39;best&#39;</span><span class="p">,</span> <span class="n">numpoints</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>

    <span class="k">return</span> <span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">,</span> <span class="n">sigma_a</span><span class="p">,</span> <span class="n">sigma_b</span><span class="p">,</span> <span class="n">corr_ab</span></div>


<div class="viewcode-block" id="linear_monte_carlo"><a class="viewcode-back" href="../../pycol.html#pycol.analyze.linear_monte_carlo">[docs]</a><span class="k">def</span> <span class="nf">linear_monte_carlo</span><span class="p">(</span><span class="n">x</span><span class="p">:</span> <span class="n">array_iter</span><span class="p">,</span> <span class="n">y</span><span class="p">:</span> <span class="n">array_iter</span><span class="p">,</span> <span class="n">sigma_x</span><span class="p">:</span> <span class="n">array_iter</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">sigma_y</span><span class="p">:</span> <span class="n">array_iter</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
                       <span class="n">corr</span><span class="p">:</span> <span class="n">array_iter</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">n</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">1000000</span><span class="p">,</span> <span class="n">report</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span> <span class="n">show</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    :param x: The x data.</span>
<span class="sd">    :param y: The y data.</span>
<span class="sd">    :param sigma_x: The 1-sigma uncertainties of the x data.</span>
<span class="sd">    :param sigma_y: The 1-sigma uncertainties of the y data.</span>
<span class="sd">    :param corr: The correlation coefficients between the x and y data.</span>
<span class="sd">    :param n: The number of samples generated for each data point.</span>
<span class="sd">    :param report: Whether to print the result of the fit.</span>
<span class="sd">    :param show: Whether to plot the fit result.</span>
<span class="sd">    :returns: a, b, sigma_a, sigma_b, corr_ab. The best y-intercept and slope,</span>
<span class="sd">     their respective 1-sigma uncertainties and their correlation coefficient.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="n">sigma_x</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">sigma_x</span> <span class="o">=</span> <span class="p">[</span><span class="mf">1.</span><span class="p">,</span> <span class="p">]</span> <span class="o">*</span> <span class="nb">len</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">report</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">No uncertainties for </span><span class="se">\&#39;</span><span class="s1">x</span><span class="se">\&#39;</span><span class="s1"> were given. Assuming </span><span class="se">\&#39;</span><span class="s1">sigma_x</span><span class="se">\&#39;</span><span class="s1">=1.&#39;</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">sigma_y</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">sigma_y</span> <span class="o">=</span> <span class="p">[</span><span class="mf">1.</span><span class="p">,</span> <span class="p">]</span> <span class="o">*</span> <span class="nb">len</span><span class="p">(</span><span class="n">y</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">report</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">No uncertainties for </span><span class="se">\&#39;</span><span class="s1">y</span><span class="se">\&#39;</span><span class="s1"> were given. Assuming </span><span class="se">\&#39;</span><span class="s1">sigma_y</span><span class="se">\&#39;</span><span class="s1">=1.&#39;</span><span class="p">)</span>
    <span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">sigma_x</span><span class="p">,</span> <span class="n">sigma_y</span><span class="p">,</span> <span class="n">corr</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="n">x</span><span class="p">),</span> <span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="n">y</span><span class="p">),</span>\
        <span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="n">sigma_x</span><span class="p">),</span> <span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="n">sigma_y</span><span class="p">),</span> <span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="n">corr</span><span class="p">)</span>
    <span class="n">tools</span><span class="o">.</span><span class="n">check_shape_like</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">sigma_x</span><span class="p">,</span> <span class="n">sigma_y</span><span class="p">,</span> <span class="n">corr</span><span class="p">,</span> <span class="n">allow_scalar</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
    <span class="n">tools</span><span class="o">.</span><span class="n">check_dimension</span><span class="p">(</span><span class="n">x</span><span class="o">.</span><span class="n">size</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">sigma_x</span><span class="p">,</span> <span class="n">sigma_y</span><span class="p">,</span> <span class="n">corr</span><span class="p">)</span>
    <span class="n">mean</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">concatenate</span><span class="p">((</span><span class="n">np</span><span class="o">.</span><span class="n">expand_dims</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">),</span> <span class="n">np</span><span class="o">.</span><span class="n">expand_dims</span><span class="p">(</span><span class="n">y</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)),</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
    <span class="n">cov</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([[[</span><span class="n">s_x</span> <span class="o">**</span> <span class="mi">2</span><span class="p">,</span> <span class="n">r</span> <span class="o">*</span> <span class="n">s_x</span> <span class="o">*</span> <span class="n">s_y</span><span class="p">],</span>
                     <span class="p">[</span><span class="n">r</span> <span class="o">*</span> <span class="n">s_y</span> <span class="o">*</span> <span class="n">s_x</span><span class="p">,</span> <span class="n">s_y</span> <span class="o">**</span> <span class="mi">2</span><span class="p">]]</span> <span class="k">for</span> <span class="n">s_x</span><span class="p">,</span> <span class="n">s_y</span><span class="p">,</span> <span class="n">r</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">sigma_x</span><span class="p">,</span> <span class="n">sigma_y</span><span class="p">,</span> <span class="n">corr</span><span class="p">)])</span>
    <span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">,</span> <span class="n">sigma_a</span><span class="p">,</span> <span class="n">sigma_b</span><span class="p">,</span> <span class="n">corr_ab</span> <span class="o">=</span> <span class="n">linear_monte_carlo_nd</span><span class="p">(</span><span class="n">mean</span><span class="p">,</span> <span class="n">cov</span><span class="o">=</span><span class="n">cov</span><span class="p">,</span> <span class="n">p_axis</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">n</span><span class="o">=</span><span class="n">n</span><span class="p">,</span> <span class="n">report</span><span class="o">=</span><span class="n">report</span><span class="p">,</span> <span class="n">show</span><span class="o">=</span><span class="n">show</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">a</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">b</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">sigma_a</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">sigma_b</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">corr_ab</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">]</span></div>


<span class="k">def</span> <span class="nf">_test_order_linear_monte_carlo_nd</span><span class="p">(</span><span class="n">x</span><span class="p">:</span> <span class="n">ndarray</span><span class="p">,</span> <span class="n">cov</span><span class="p">:</span> <span class="n">ndarray</span><span class="p">,</span> <span class="n">n</span><span class="p">:</span> <span class="nb">int</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    :param x: The x data. &#39;x&#39; is a numpy array of vectors with arbitrary but fixed dimension.</span>
<span class="sd">    :param cov: The covariance matrices of the x data vectors. Must have shape (x.shape[0], x.shape[1], x.shape[1]).</span>
<span class="sd">    :param n: The number of samples generated for each data point.</span>
<span class="sd">    :returns: The order of axis 0 of &#39;x&#39; which yields the most accepted samples.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">indices</span> <span class="o">=</span> <span class="p">[(</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">)</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">x</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span> <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">x</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span> <span class="k">if</span> <span class="n">j</span> <span class="o">&gt;</span> <span class="n">i</span><span class="p">]</span>
    <span class="n">best_n</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="n">best_order</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="n">x</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">dtype</span><span class="o">=</span><span class="nb">int</span><span class="p">)</span>
    <span class="k">for</span> <span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">)</span> <span class="ow">in</span> <span class="n">indices</span><span class="p">:</span>
        <span class="n">order</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">i</span><span class="p">,</span> <span class="p">]</span> <span class="o">+</span> <span class="p">[</span><span class="n">k</span> <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">x</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span> <span class="k">if</span> <span class="n">k</span> <span class="o">!=</span> <span class="n">i</span> <span class="ow">and</span> <span class="n">k</span> <span class="o">!=</span> <span class="n">j</span><span class="p">]</span> <span class="o">+</span> <span class="p">[</span><span class="n">j</span><span class="p">,</span> <span class="p">])</span>
        <span class="n">n_accepted</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">_generate_collinear_points</span><span class="p">(</span><span class="n">x</span><span class="p">[</span><span class="n">order</span><span class="p">],</span> <span class="n">cov</span><span class="p">[</span><span class="n">order</span><span class="p">],</span> <span class="n">n</span><span class="p">)[</span><span class="mi">2</span><span class="p">])</span>
        <span class="c1"># print(n_accepted)</span>
        <span class="k">if</span> <span class="n">n_accepted</span> <span class="o">&gt;</span> <span class="n">best_n</span><span class="p">:</span>
            <span class="n">best_n</span> <span class="o">=</span> <span class="n">n_accepted</span>
            <span class="n">best_order</span> <span class="o">=</span> <span class="n">order</span>
    <span class="c1"># print(best_n, best_order)</span>
    <span class="k">return</span> <span class="n">best_order</span>


<span class="k">def</span> <span class="nf">_generate_collinear_points</span><span class="p">(</span><span class="n">x</span><span class="p">:</span> <span class="n">ndarray</span><span class="p">,</span> <span class="n">cov</span><span class="p">:</span> <span class="n">ndarray</span><span class="p">,</span> <span class="n">n</span><span class="p">:</span> <span class="nb">int</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    :param x: The x data. &#39;x&#39; is a numpy array of vectors with arbitrary but fixed dimension.</span>
<span class="sd">    :param cov: The covariance matrices of the x data vectors. Must have shape (x.shape[0], x.shape[1], x.shape[1]).</span>
<span class="sd">    :param n: The number of samples generated for each data point.</span>
<span class="sd">    :returns: The randomly generated data vectors p [shape=(n, )+ x.shape] aligned along a straight line,</span>
<span class="sd">     the unit vectors dr [shape=(n, x.shape[1])] in the directions of the straight lines</span>
<span class="sd">     and a mask of the accepted samples. The accepted samples are p[accepted] and dr[accepted].</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">p_0</span> <span class="o">=</span> <span class="n">st</span><span class="o">.</span><span class="n">multivariate_normal</span><span class="o">.</span><span class="n">rvs</span><span class="p">(</span><span class="n">mean</span><span class="o">=</span><span class="n">x</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">cov</span><span class="o">=</span><span class="n">cov</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">size</span><span class="o">=</span><span class="n">n</span><span class="p">)</span>
    <span class="n">p_1</span> <span class="o">=</span> <span class="n">st</span><span class="o">.</span><span class="n">multivariate_normal</span><span class="o">.</span><span class="n">rvs</span><span class="p">(</span><span class="n">mean</span><span class="o">=</span><span class="n">x</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">],</span> <span class="n">cov</span><span class="o">=</span><span class="n">cov</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">],</span> <span class="n">size</span><span class="o">=</span><span class="n">n</span><span class="p">)</span>
    <span class="n">dr</span> <span class="o">=</span> <span class="n">straight_slope</span><span class="p">(</span><span class="n">p_0</span><span class="p">,</span> <span class="n">p_1</span><span class="p">,</span> <span class="n">axis</span><span class="o">=-</span><span class="mi">1</span><span class="p">)</span>

    <span class="n">t_0</span> <span class="o">=</span> <span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">einsum</span><span class="p">(</span><span class="s1">&#39;ij,ij-&gt;i&#39;</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">expand_dims</span><span class="p">(</span><span class="n">x_i</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span> <span class="o">-</span> <span class="n">p_0</span><span class="p">,</span> <span class="n">dr</span><span class="p">)</span> <span class="k">for</span> <span class="n">x_i</span> <span class="ow">in</span> <span class="n">x</span><span class="p">[</span><span class="mi">1</span><span class="p">:</span><span class="o">-</span><span class="mi">1</span><span class="p">]]</span>
    <span class="n">t</span> <span class="o">=</span> <span class="p">[</span><span class="n">st</span><span class="o">.</span><span class="n">norm</span><span class="o">.</span><span class="n">rvs</span><span class="p">(</span><span class="n">loc</span><span class="o">=</span><span class="n">t_0_i</span><span class="p">,</span> <span class="n">scale</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">min</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">diag</span><span class="p">(</span><span class="n">cov_i</span><span class="p">))))</span> <span class="k">for</span> <span class="n">t_0_i</span><span class="p">,</span> <span class="n">cov_i</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">t_0</span><span class="p">,</span> <span class="n">cov</span><span class="p">[</span><span class="mi">1</span><span class="p">:</span><span class="o">-</span><span class="mi">1</span><span class="p">])]</span>

    <span class="n">p_new</span> <span class="o">=</span> <span class="p">[</span><span class="n">p_0</span> <span class="o">+</span> <span class="n">np</span><span class="o">.</span><span class="n">expand_dims</span><span class="p">(</span><span class="n">t_i</span><span class="p">,</span> <span class="n">axis</span><span class="o">=-</span><span class="mi">1</span><span class="p">)</span> <span class="o">*</span> <span class="n">dr</span> <span class="k">for</span> <span class="n">t_i</span> <span class="ow">in</span> <span class="n">t</span><span class="p">]</span>
    <span class="n">f</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">prod</span><span class="p">([</span><span class="n">st</span><span class="o">.</span><span class="n">multivariate_normal</span><span class="o">.</span><span class="n">pdf</span><span class="p">(</span><span class="n">p_i</span><span class="p">,</span> <span class="n">mean</span><span class="o">=</span><span class="n">x_i</span><span class="p">,</span> <span class="n">cov</span><span class="o">=</span><span class="n">cov_i</span><span class="p">)</span>
                 <span class="k">for</span> <span class="n">p_i</span><span class="p">,</span> <span class="n">x_i</span><span class="p">,</span> <span class="n">cov_i</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">p_new</span><span class="p">,</span> <span class="n">x</span><span class="p">[</span><span class="mi">1</span><span class="p">:</span><span class="o">-</span><span class="mi">1</span><span class="p">],</span> <span class="n">cov</span><span class="p">[</span><span class="mi">1</span><span class="p">:</span><span class="o">-</span><span class="mi">1</span><span class="p">])],</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>

    <span class="n">g</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">prod</span><span class="p">([</span><span class="n">st</span><span class="o">.</span><span class="n">norm</span><span class="o">.</span><span class="n">pdf</span><span class="p">(</span><span class="n">t_i</span><span class="p">,</span> <span class="n">loc</span><span class="o">=</span><span class="n">t_0_i</span><span class="p">,</span> <span class="n">scale</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">diag</span><span class="p">(</span><span class="n">cov_i</span><span class="p">))))</span>
                 <span class="k">for</span> <span class="n">t_i</span><span class="p">,</span> <span class="n">t_0_i</span><span class="p">,</span> <span class="n">cov_i</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">t</span><span class="p">,</span> <span class="n">t_0</span><span class="p">,</span> <span class="n">cov</span><span class="p">[</span><span class="mi">1</span><span class="p">:</span><span class="o">-</span><span class="mi">1</span><span class="p">])],</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">p_new</span><span class="p">:</span>
        <span class="n">u</span> <span class="o">=</span> <span class="n">f</span> <span class="o">/</span> <span class="n">g</span>
        <span class="n">u</span> <span class="o">/=</span> <span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">u</span><span class="p">)</span>
        <span class="n">accepted</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">random</span><span class="p">(</span><span class="n">size</span><span class="o">=</span><span class="n">n</span><span class="p">)</span> <span class="o">&lt;</span> <span class="n">u</span>
        <span class="n">p</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">concatenate</span><span class="p">((</span><span class="n">np</span><span class="o">.</span><span class="n">expand_dims</span><span class="p">(</span><span class="n">p_0</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span> <span class="n">p_new</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">expand_dims</span><span class="p">(</span><span class="n">p_1</span><span class="p">,</span> <span class="mi">0</span><span class="p">)),</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">accepted</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">full</span><span class="p">(</span><span class="n">n</span><span class="p">,</span> <span class="kc">True</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="nb">bool</span><span class="p">)</span>
        <span class="n">p</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">concatenate</span><span class="p">((</span><span class="n">np</span><span class="o">.</span><span class="n">expand_dims</span><span class="p">(</span><span class="n">p_0</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span> <span class="n">np</span><span class="o">.</span><span class="n">expand_dims</span><span class="p">(</span><span class="n">p_1</span><span class="p">,</span> <span class="mi">0</span><span class="p">)),</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
    <span class="n">p</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">transpose</span><span class="p">(</span><span class="n">p</span><span class="p">,</span> <span class="n">axes</span><span class="o">=</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">2</span><span class="p">])</span>
    <span class="k">return</span> <span class="n">p</span><span class="p">,</span> <span class="n">dr</span><span class="p">,</span> <span class="n">accepted</span>


<div class="viewcode-block" id="linear_monte_carlo_nd"><a class="viewcode-back" href="../../pycol.html#pycol.analyze.linear_monte_carlo_nd">[docs]</a><span class="k">def</span> <span class="nf">linear_monte_carlo_nd</span><span class="p">(</span><span class="n">x</span><span class="p">:</span> <span class="n">array_iter</span><span class="p">,</span> <span class="n">cov</span><span class="p">:</span> <span class="n">array_iter</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">p_axis</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
                          <span class="n">n</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">1000000</span><span class="p">,</span> <span class="n">full_output</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span> <span class="n">report</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span> <span class="n">show</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    A Monte-Carlo fitter that finds a straight line in n-dimensional space.</span>

<span class="sd">    :param x: The x data. &#39;x&#39; is an iterable of vectors with arbitrary but fixed dimension.</span>
<span class="sd">    :param cov: The covariance matrices of the x data vectors. Must have shape (x.shape[0], x.shape[1], x.shape[1]).</span>
<span class="sd">    :param p_axis: The axis to use for the parametrization. If None, the directional vector is normalized.</span>
<span class="sd">    :param n: The number of samples generated for each data point.</span>
<span class="sd">    :param full_output: Whether to also return the generated points &#39;p&#39; and a mask for the &#39;accepted&#39; points.</span>
<span class="sd">     The accepted points are p[accepted]. p has shape (n, x.shape).</span>
<span class="sd">    :param report: Whether to print the result of the fit.</span>
<span class="sd">    :param show: Whether to plot the fit result.</span>
<span class="sd">    :returns: A list of (a, b, sigma_a, sigma_b, corr_ab). The best y-intercepts and slopes,</span>
<span class="sd">     their respective 1-sigma uncertainties and their correlation matrix.</span>
<span class="sd">     The y-intercepts and slopes are defined through &#39;p_axis&#39; by a(x[p_axis] == 0)</span>
<span class="sd">     and b(dx[i != p_axis] / dx[p_axis]), respectively.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">x</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">x</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span> <span class="o">!=</span> <span class="mi">2</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s1">&#39;x must be an iterable of vectors with arbitrary but fixed dimension.&#39;</span>
                         <span class="s1">&#39; Hence, len(x.shape) =: 2, but is </span><span class="si">{}</span><span class="s1">.&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">x</span><span class="o">.</span><span class="n">shape</span><span class="p">)))</span>
    <span class="k">if</span> <span class="n">cov</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">cov</span> <span class="o">=</span> <span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">identity</span><span class="p">(</span><span class="n">x</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">]),</span> <span class="p">]</span> <span class="o">*</span> <span class="n">x</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
    <span class="n">cov</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="n">cov</span><span class="p">)</span>
    <span class="n">tools</span><span class="o">.</span><span class="n">check_shape</span><span class="p">((</span><span class="n">x</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">x</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">x</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">]),</span> <span class="n">cov</span><span class="p">,</span> <span class="n">allow_scalar</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
    <span class="n">order</span> <span class="o">=</span> <span class="n">_test_order_linear_monte_carlo_nd</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">cov</span><span class="p">,</span> <span class="mi">100000</span><span class="p">)</span>
    <span class="n">inverse_order</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="nb">int</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">order</span> <span class="o">==</span> <span class="n">i</span><span class="p">)[</span><span class="mi">0</span><span class="p">])</span>
                              <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">order</span><span class="o">.</span><span class="n">size</span><span class="p">)])</span>  <span class="c1"># Invert the order for later.</span>
    <span class="n">p</span><span class="p">,</span> <span class="n">dr</span><span class="p">,</span> <span class="n">accepted</span> <span class="o">=</span> <span class="n">_generate_collinear_points</span><span class="p">(</span><span class="n">x</span><span class="p">[</span><span class="n">order</span><span class="p">],</span> <span class="n">cov</span><span class="p">[</span><span class="n">order</span><span class="p">],</span> <span class="n">n</span><span class="p">)</span>
    <span class="n">p</span> <span class="o">=</span> <span class="n">p</span><span class="p">[:,</span> <span class="n">inverse_order</span><span class="p">,</span> <span class="p">:]</span>
    <span class="n">n_accepted</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">accepted</span><span class="p">)</span>
    <span class="n">p_0</span> <span class="o">=</span> <span class="n">p</span><span class="p">[</span><span class="n">accepted</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="p">:]</span>
    <span class="n">dr</span> <span class="o">=</span> <span class="n">dr</span><span class="p">[</span><span class="n">accepted</span><span class="p">]</span>

    <span class="k">if</span> <span class="n">show</span><span class="p">:</span>
        <span class="k">for</span> <span class="n">sample</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="nb">int</span><span class="p">(</span><span class="n">n_accepted</span><span class="p">),</span> <span class="nb">int</span><span class="p">(</span><span class="n">n_accepted</span> <span class="o">/</span> <span class="mi">10</span><span class="p">)):</span>
            <span class="n">x_plot</span> <span class="o">=</span> <span class="n">p</span><span class="p">[</span><span class="n">accepted</span><span class="p">][</span><span class="n">sample</span><span class="p">,</span> <span class="p">:,</span> <span class="mi">0</span><span class="p">]</span>
            <span class="n">y_plot</span> <span class="o">=</span> <span class="n">p</span><span class="p">[</span><span class="n">accepted</span><span class="p">][</span><span class="n">sample</span><span class="p">,</span> <span class="p">:,</span> <span class="mi">1</span><span class="p">]</span>
            <span class="n">plot_order</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">argsort</span><span class="p">(</span><span class="n">x_plot</span><span class="p">)</span>
            <span class="n">x_plot</span> <span class="o">=</span> <span class="n">x_plot</span><span class="p">[</span><span class="n">plot_order</span><span class="p">]</span>
            <span class="n">y_plot</span> <span class="o">=</span> <span class="n">y_plot</span><span class="p">[</span><span class="n">plot_order</span><span class="p">]</span>
            <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">([</span><span class="n">x_plot</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">x_plot</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]],</span> <span class="p">[</span><span class="n">y_plot</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">y_plot</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]],</span> <span class="s1">&#39;C0-&#39;</span><span class="p">)</span>
            <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">x_plot</span><span class="p">,</span> <span class="n">y_plot</span><span class="p">,</span> <span class="s1">&#39;C1.&#39;</span><span class="p">)</span>
        <span class="c1"># plt.errorbar(x[:, 0], x[:, 1], xerr=np.sqrt(cov[:, 0, 0]), yerr=np.sqrt(cov[:, 1, 1]), fmt=&#39;k.&#39;)</span>
        <span class="n">draw_sigma2d</span><span class="p">(</span><span class="n">x</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">],</span> <span class="n">x</span><span class="p">[:,</span> <span class="mi">1</span><span class="p">],</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">cov</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">]),</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">cov</span><span class="p">[:,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">]),</span>
                     <span class="n">cov</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">]</span> <span class="o">/</span> <span class="p">(</span><span class="n">cov</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span> <span class="o">*</span> <span class="n">cov</span><span class="p">[:,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">]),</span> <span class="n">n</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>
        <span class="c1"># plt.gca().set_aspect(&#39;equal&#39;)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>

    <span class="n">mask</span> <span class="o">=</span> <span class="p">[</span><span class="kc">True</span><span class="p">,</span> <span class="p">]</span> <span class="o">*</span> <span class="n">x</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
    <span class="k">if</span> <span class="n">p_axis</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">p_axis</span> <span class="o">==</span> <span class="o">-</span><span class="mi">1</span><span class="p">:</span>
            <span class="n">p_axis</span> <span class="o">=</span> <span class="n">x</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="mi">1</span>
        <span class="n">mask</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="n">x</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span> <span class="o">!=</span> <span class="n">p_axis</span>
        <span class="n">t</span> <span class="o">=</span> <span class="o">-</span><span class="n">p_0</span><span class="p">[:,</span> <span class="n">p_axis</span><span class="p">]</span> <span class="o">/</span> <span class="n">dr</span><span class="p">[:,</span> <span class="n">p_axis</span><span class="p">]</span>
        <span class="n">p_0</span> <span class="o">=</span> <span class="n">p_0</span> <span class="o">+</span> <span class="n">np</span><span class="o">.</span><span class="n">expand_dims</span><span class="p">(</span><span class="n">t</span><span class="p">,</span> <span class="n">axis</span><span class="o">=-</span><span class="mi">1</span><span class="p">)</span> <span class="o">*</span> <span class="n">dr</span>
        <span class="n">dr</span> <span class="o">=</span> <span class="n">dr</span> <span class="o">/</span> <span class="n">dr</span><span class="p">[:,</span> <span class="p">[</span><span class="n">p_axis</span><span class="p">]]</span>
    <span class="n">a</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">p_0</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)[</span><span class="n">mask</span><span class="p">]</span>
    <span class="n">b</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">dr</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)[</span><span class="n">mask</span><span class="p">]</span>
    <span class="n">sigma_a</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">std</span><span class="p">(</span><span class="n">p_0</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">ddof</span><span class="o">=</span><span class="mi">1</span><span class="p">)[</span><span class="n">mask</span><span class="p">]</span>
    <span class="n">sigma_b</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">std</span><span class="p">(</span><span class="n">dr</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">ddof</span><span class="o">=</span><span class="mi">1</span><span class="p">)[</span><span class="n">mask</span><span class="p">]</span>
    <span class="n">corr_ab</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">corrcoef</span><span class="p">(</span><span class="n">p_0</span><span class="o">.</span><span class="n">T</span><span class="p">[</span><span class="n">mask</span><span class="p">],</span> <span class="n">dr</span><span class="o">.</span><span class="n">T</span><span class="p">[</span><span class="n">mask</span><span class="p">])</span>
    <span class="c1"># print(dr.shape)</span>
    <span class="c1"># plt.plot(p[accepted, :, 0], dr[:, 1], &#39;.&#39;)</span>
    <span class="c1"># plt.show()</span>
    <span class="k">if</span> <span class="n">report</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">Fit result:</span><span class="se">\n</span><span class="s1">Accepted samples: </span><span class="si">{}</span><span class="s1"> / </span><span class="si">{}</span><span class="s1"> (</span><span class="si">{}</span><span class="s1">%)</span><span class="se">\n</span><span class="s1">a: </span><span class="si">{}</span><span class="s1"> +- </span><span class="si">{}</span><span class="se">\n</span><span class="s1">b: </span><span class="si">{}</span><span class="s1"> +- </span><span class="si">{}</span><span class="se">\n</span><span class="s1">corr_ab:</span><span class="se">\n</span><span class="si">{}</span><span class="s1">&#39;</span>
              <span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">n_accepted</span><span class="p">,</span> <span class="n">n</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">around</span><span class="p">(</span><span class="n">n_accepted</span> <span class="o">/</span> <span class="n">n</span> <span class="o">*</span> <span class="mi">100</span><span class="p">,</span> <span class="n">decimals</span><span class="o">=</span><span class="mi">2</span><span class="p">),</span>
                      <span class="n">a</span><span class="p">,</span> <span class="n">sigma_a</span><span class="p">,</span> <span class="n">b</span><span class="p">,</span> <span class="n">sigma_b</span><span class="p">,</span> <span class="n">corr_ab</span><span class="p">))</span>
    <span class="k">if</span> <span class="n">full_output</span><span class="p">:</span>
        <span class="k">return</span> <span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">,</span> <span class="n">sigma_a</span><span class="p">,</span> <span class="n">sigma_b</span><span class="p">,</span> <span class="n">corr_ab</span><span class="p">),</span> <span class="p">(</span><span class="n">p</span><span class="p">[</span><span class="n">accepted</span><span class="p">],</span> <span class="n">p_0</span><span class="p">,</span> <span class="n">dr</span><span class="p">,</span> <span class="n">accepted</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">,</span> <span class="n">sigma_a</span><span class="p">,</span> <span class="n">sigma_b</span><span class="p">,</span> <span class="n">corr_ab</span></div>


<div class="viewcode-block" id="linear_alpha"><a class="viewcode-back" href="../../pycol.html#pycol.analyze.linear_alpha">[docs]</a><span class="k">def</span> <span class="nf">linear_alpha</span><span class="p">(</span><span class="n">x</span><span class="p">:</span> <span class="n">array_iter</span><span class="p">,</span> <span class="n">y</span><span class="p">:</span> <span class="n">array_iter</span><span class="p">,</span> <span class="n">sigma_x</span><span class="p">:</span> <span class="n">array_like</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">sigma_y</span><span class="p">:</span> <span class="n">array_like</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
                 <span class="n">corr</span><span class="p">:</span> <span class="n">array_iter</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">func</span><span class="p">:</span> <span class="n">Callable</span> <span class="o">=</span> <span class="n">york</span><span class="p">,</span> <span class="n">alpha</span><span class="p">:</span> <span class="n">scalar</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span> <span class="n">find_alpha</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
                 <span class="n">report</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span> <span class="n">show</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    :param x: The x data.</span>
<span class="sd">    :param y: The y data.</span>
<span class="sd">    :param sigma_x: The 1-sigma uncertainty of the x data.</span>
<span class="sd">    :param sigma_y: The 1-sigma uncertainty of the y data.</span>
<span class="sd">    :param corr: The correlation coefficients between the x and y data.</span>
<span class="sd">    :param func: The fitting routine.</span>
<span class="sd">    :param alpha: An x-axis offset to reduce the correlation coefficient between the y-intercept and the slope.</span>
<span class="sd">    :param find_alpha: Whether to search for the best &#39;alpha&#39;. Uses the given &#39;alpha&#39; as a starting point.</span>
<span class="sd">     May not give the desired result if &#39;alpha&#39; was initialized to far from its optimal value.</span>
<span class="sd">    :param report: Whether to print the result of the fit.</span>
<span class="sd">    :param show: Whether to plot the fit result.</span>
<span class="sd">    :param kwargs: Additional keyword arguments are passed to the fitting routine.</span>
<span class="sd">    :returns: a, b, sigma_a, sigma_b, corr_ab, alpha. The best y-intercept and slope,</span>
<span class="sd">     their respective 1-sigma uncertainties, their correlation coefficient and the used alpha.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">n</span> <span class="o">=</span> <span class="n">tools</span><span class="o">.</span><span class="n">floor_log10</span><span class="p">(</span><span class="n">alpha</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">cost</span><span class="p">(</span><span class="n">x0</span><span class="p">):</span>
        <span class="n">_</span><span class="p">,</span> <span class="n">_</span><span class="p">,</span> <span class="n">_</span><span class="p">,</span> <span class="n">_</span><span class="p">,</span> <span class="n">c</span> <span class="o">=</span> <span class="n">func</span><span class="p">(</span><span class="n">x</span> <span class="o">-</span> <span class="n">x0</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">y</span><span class="p">,</span> <span class="n">sigma_x</span><span class="o">=</span><span class="n">sigma_x</span><span class="p">,</span> <span class="n">sigma_y</span><span class="o">=</span><span class="n">sigma_y</span><span class="p">,</span> <span class="n">corr</span><span class="o">=</span><span class="n">corr</span><span class="p">,</span>
                             <span class="n">report</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">show</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;alpha: </span><span class="si">{}</span><span class="s1">(1.), </span><span class="se">\t</span><span class="s1">cost: </span><span class="si">{}</span><span class="s1">(</span><span class="si">{}</span><span class="s1">)&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">x0</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">c</span> <span class="o">**</span> <span class="mi">2</span> <span class="o">*</span> <span class="mf">10.</span> <span class="o">**</span> <span class="p">(</span><span class="n">n</span> <span class="o">+</span> <span class="mi">1</span><span class="p">),</span> <span class="mf">10.</span> <span class="o">**</span> <span class="p">(</span><span class="n">n</span> <span class="o">-</span> <span class="mi">3</span><span class="p">)))</span>
        <span class="k">return</span> <span class="n">c</span> <span class="o">**</span> <span class="mi">2</span> <span class="o">*</span> <span class="mf">10.</span> <span class="o">**</span> <span class="p">(</span><span class="n">n</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">find_alpha</span><span class="p">:</span>
        <span class="n">alpha</span> <span class="o">=</span> <span class="n">so</span><span class="o">.</span><span class="n">minimize</span><span class="p">(</span><span class="n">cost</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">alpha</span><span class="p">]),</span> <span class="n">method</span><span class="o">=</span><span class="s1">&#39;Nelder-Mead&#39;</span><span class="p">,</span>
                            <span class="n">options</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;xatol&#39;</span><span class="p">:</span> <span class="mf">1.</span><span class="p">,</span> <span class="s1">&#39;fatol&#39;</span><span class="p">:</span> <span class="mf">0.01</span> <span class="o">**</span> <span class="mi">2</span> <span class="o">*</span> <span class="mf">10.</span> <span class="o">**</span> <span class="p">(</span><span class="n">n</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)})</span><span class="o">.</span><span class="n">x</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>

    <span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">,</span> <span class="n">sigma_a</span><span class="p">,</span> <span class="n">sigma_b</span><span class="p">,</span> <span class="n">corr_ab</span> <span class="o">=</span>\
        <span class="n">func</span><span class="p">(</span><span class="n">x</span> <span class="o">-</span> <span class="n">alpha</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">sigma_x</span><span class="o">=</span><span class="n">sigma_x</span><span class="p">,</span> <span class="n">sigma_y</span><span class="o">=</span><span class="n">sigma_y</span><span class="p">,</span> <span class="n">corr</span><span class="o">=</span><span class="n">corr</span><span class="p">,</span>
             <span class="n">report</span><span class="o">=</span><span class="n">report</span><span class="p">,</span> <span class="n">show</span><span class="o">=</span><span class="n">show</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">report</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;alpha: </span><span class="si">{}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">alpha</span><span class="p">))</span>
    <span class="k">return</span> <span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">,</span> <span class="n">sigma_a</span><span class="p">,</span> <span class="n">sigma_b</span><span class="p">,</span> <span class="n">corr_ab</span><span class="p">,</span> <span class="n">alpha</span></div>


<div class="viewcode-block" id="curve_fit"><a class="viewcode-back" href="../../pycol.html#pycol.analyze.curve_fit">[docs]</a><span class="k">def</span> <span class="nf">curve_fit</span><span class="p">(</span><span class="n">f</span><span class="p">:</span> <span class="n">Callable</span><span class="p">,</span> <span class="n">x</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="n">array_like</span><span class="p">,</span> <span class="nb">object</span><span class="p">],</span> <span class="n">y</span><span class="p">:</span> <span class="n">array_like</span><span class="p">,</span> <span class="n">p0</span><span class="p">:</span> <span class="n">array_iter</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
              <span class="n">p0_fixed</span><span class="p">:</span> <span class="n">array_iter</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">sigma</span><span class="p">:</span> <span class="n">array_iter</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">absolute_sigma</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
              <span class="n">check_finite</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span> <span class="n">bounds</span><span class="p">:</span> <span class="p">(</span><span class="n">ndarray</span><span class="p">,</span> <span class="n">ndarray</span><span class="p">)</span> <span class="o">=</span> <span class="p">(</span><span class="o">-</span><span class="n">np</span><span class="o">.</span><span class="n">inf</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">inf</span><span class="p">),</span> <span class="n">method</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
              <span class="n">jac</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="n">Callable</span><span class="p">,</span> <span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="p">(</span><span class="n">ndarray</span><span class="p">,</span> <span class="n">ndarray</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    :param f: The model function to fit to the data.</span>
<span class="sd">    :param x: The x data.</span>
<span class="sd">    :param y: The y data.</span>
<span class="sd">    :param p0: A numpy array or an Iterable of the initial guesses for the parameters.</span>
<span class="sd">     Must have at least the same length as the minimum number of parameters required by the function &#39;f&#39;.</span>
<span class="sd">     If &#39;p0&#39; is None, 1 is taken as an initial guess for all non-keyword parameters.</span>
<span class="sd">    :param p0_fixed: A numpy array or an Iterable of bool values specifying, whether to fix a parameter.</span>
<span class="sd">     Must have the same length as p0.</span>
<span class="sd">    :param sigma: The 1-sigma uncertainty of the y data.</span>
<span class="sd">    :param absolute_sigma: See scipy.optimize.curve_fit.</span>
<span class="sd">    :param check_finite: See scipy.optimize.curve_fit.</span>
<span class="sd">    :param bounds: See scipy.optimize.curve_fit.</span>
<span class="sd">    :param method: See scipy.optimize.curve_fit.</span>
<span class="sd">    :param jac: See scipy.optimize.curve_fit.</span>
<span class="sd">    :param kwargs: See scipy.optimize.curve_fit.</span>
<span class="sd">    :returns: popt, pcov. The optimal parameters and their covariance matrix.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="n">p0_fixed</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">or</span> <span class="nb">all</span><span class="p">(</span><span class="ow">not</span> <span class="n">p</span> <span class="k">for</span> <span class="n">p</span> <span class="ow">in</span> <span class="n">p0_fixed</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">so</span><span class="o">.</span><span class="n">curve_fit</span><span class="p">(</span><span class="n">f</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">p0</span><span class="o">=</span><span class="n">p0</span><span class="p">,</span> <span class="n">sigma</span><span class="o">=</span><span class="n">sigma</span><span class="p">,</span> <span class="n">absolute_sigma</span><span class="o">=</span><span class="n">absolute_sigma</span><span class="p">,</span>
                            <span class="n">check_finite</span><span class="o">=</span><span class="n">check_finite</span><span class="p">,</span> <span class="n">bounds</span><span class="o">=</span><span class="n">bounds</span><span class="p">,</span> <span class="n">method</span><span class="o">=</span><span class="n">method</span><span class="p">,</span> <span class="n">jac</span><span class="o">=</span><span class="n">jac</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">p0</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s1">&#39;Please specify the initial parameters when any of the parameters shall be fixed.&#39;</span><span class="p">)</span>
    <span class="c1"># noinspection PyTypeChecker</span>
    <span class="n">p0</span><span class="p">,</span> <span class="n">p0_fixed</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="n">p0</span><span class="p">),</span> <span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="n">p0_fixed</span><span class="p">)</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">bool</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">p0_fixed</span><span class="o">.</span><span class="n">shape</span> <span class="o">!=</span> <span class="n">p0</span><span class="o">.</span><span class="n">shape</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\&#39;</span><span class="s1">p0_fixed</span><span class="se">\&#39;</span><span class="s1"> must have the same shape as </span><span class="se">\&#39;</span><span class="s1">p0</span><span class="se">\&#39;</span><span class="s1">.&#39;</span><span class="p">)</span>
    <span class="n">_p0</span> <span class="o">=</span> <span class="n">p0</span><span class="p">[</span><span class="o">~</span><span class="n">p0_fixed</span><span class="p">]</span>
    <span class="n">_bounds</span> <span class="o">=</span> <span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="n">bounds</span><span class="p">[</span><span class="mi">0</span><span class="p">]),</span> <span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="n">bounds</span><span class="p">[</span><span class="mi">1</span><span class="p">]))</span>
    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">_bounds</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span> <span class="ow">and</span> <span class="n">_bounds</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">size</span> <span class="o">==</span> <span class="n">p0</span><span class="o">.</span><span class="n">size</span><span class="p">:</span>
        <span class="n">_bounds</span> <span class="o">=</span> <span class="p">(</span><span class="n">_bounds</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="o">~</span><span class="n">p0_fixed</span><span class="p">],</span> <span class="n">_bounds</span><span class="p">[</span><span class="mi">1</span><span class="p">][</span><span class="o">~</span><span class="n">p0_fixed</span><span class="p">])</span>

    <span class="k">def</span> <span class="nf">_f</span><span class="p">(</span><span class="n">_x</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">):</span>
        <span class="n">_args</span> <span class="o">=</span> <span class="n">p0</span>
        <span class="n">_args</span><span class="p">[</span><span class="o">~</span><span class="n">p0_fixed</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="n">args</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">f</span><span class="p">(</span><span class="n">_x</span><span class="p">,</span> <span class="o">*</span><span class="n">_args</span><span class="p">)</span>

    <span class="n">popt</span><span class="p">,</span> <span class="n">pcov</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">ones_like</span><span class="p">(</span><span class="n">p0</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="nb">float</span><span class="p">),</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="n">p0</span><span class="o">.</span><span class="n">size</span><span class="p">,</span> <span class="n">p0</span><span class="o">.</span><span class="n">size</span><span class="p">),</span> <span class="n">dtype</span><span class="o">=</span><span class="nb">float</span><span class="p">)</span>
    <span class="n">pcov_mask</span> <span class="o">=</span> <span class="o">~</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">expand_dims</span><span class="p">(</span><span class="n">p0_fixed</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span> <span class="o">+</span> <span class="n">np</span><span class="o">.</span><span class="n">expand_dims</span><span class="p">(</span><span class="n">p0_fixed</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">))</span>
    <span class="n">popt</span><span class="p">[</span><span class="n">p0_fixed</span><span class="p">]</span> <span class="o">=</span> <span class="n">p0</span><span class="p">[</span><span class="n">p0_fixed</span><span class="p">]</span>
    <span class="n">_popt</span><span class="p">,</span> <span class="n">_pcov</span> <span class="o">=</span> <span class="n">so</span><span class="o">.</span><span class="n">curve_fit</span><span class="p">(</span><span class="n">_f</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">p0</span><span class="o">=</span><span class="n">_p0</span><span class="p">,</span> <span class="n">sigma</span><span class="o">=</span><span class="n">sigma</span><span class="p">,</span> <span class="n">absolute_sigma</span><span class="o">=</span><span class="n">absolute_sigma</span><span class="p">,</span>
                                <span class="n">check_finite</span><span class="o">=</span><span class="n">check_finite</span><span class="p">,</span> <span class="n">bounds</span><span class="o">=</span><span class="n">_bounds</span><span class="p">,</span> <span class="n">method</span><span class="o">=</span><span class="n">method</span><span class="p">,</span> <span class="n">jac</span><span class="o">=</span><span class="n">jac</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
    <span class="n">popt</span><span class="p">[</span><span class="o">~</span><span class="n">p0_fixed</span><span class="p">]</span> <span class="o">=</span> <span class="n">_popt</span>
    <span class="c1"># noinspection PyUnresolvedReferences</span>
    <span class="n">pcov</span><span class="p">[</span><span class="n">pcov_mask</span><span class="p">]</span> <span class="o">=</span> <span class="n">_pcov</span><span class="o">.</span><span class="n">flatten</span><span class="p">()</span>
    <span class="k">return</span> <span class="n">popt</span><span class="p">,</span> <span class="n">pcov</span></div>


<div class="viewcode-block" id="odr_fit"><a class="viewcode-back" href="../../pycol.html#pycol.analyze.odr_fit">[docs]</a><span class="k">def</span> <span class="nf">odr_fit</span><span class="p">(</span><span class="n">f</span><span class="p">:</span> <span class="n">Callable</span><span class="p">,</span> <span class="n">x</span><span class="p">:</span> <span class="n">array_iter</span><span class="p">,</span> <span class="n">y</span><span class="p">:</span> <span class="n">array_iter</span><span class="p">,</span> <span class="n">sigma_x</span><span class="p">:</span> <span class="n">array_iter</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">sigma_y</span><span class="p">:</span> <span class="n">array_iter</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
            <span class="n">p0</span><span class="p">:</span> <span class="n">array_iter</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">p0_d</span><span class="p">:</span> <span class="n">array_iter</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">p0_fixed</span><span class="p">:</span> <span class="n">array_iter</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span> \
        <span class="o">-&gt;</span> <span class="p">(</span><span class="n">ndarray</span><span class="p">,</span> <span class="n">ndarray</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    :param f: The model function to fit to the data.</span>
<span class="sd">    :param x: The x data.</span>
<span class="sd">    :param y: The y data.</span>
<span class="sd">    :param sigma_x: The 1-sigma uncertainty of the x data.</span>
<span class="sd">    :param sigma_y: The 1-sigma uncertainty of the y data.</span>
<span class="sd">    :param p0: A numpy array or an Iterable of the initial guesses for the parameters.</span>
<span class="sd">     Must have at least the same length as the minimum number of parameters required by the function &#39;f&#39;.</span>
<span class="sd">     If &#39;p0&#39; is None, 1 is taken as an initial guess for all non-keyword parameters.</span>
<span class="sd">    :param p0_d: A numpy array or an Iterable of the uncertainties of the initial guesses for the parameters.</span>
<span class="sd">     Must have the same length as p0.</span>
<span class="sd">    :param p0_fixed: A numpy array or an Iterable of bool values specifying, whether to fix a parameter.</span>
<span class="sd">     Must have the same length as p0.</span>
<span class="sd">    :param kwargs: Keyword arguments passed to odr.ODR.</span>
<span class="sd">    :returns: popt, pcov. The optimal parameters and their covariance matrix.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">x</span><span class="p">,</span> <span class="n">y</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="n">x</span><span class="p">),</span> <span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="n">y</span><span class="p">)</span>
    <span class="n">sx</span><span class="p">,</span> <span class="n">sy</span><span class="p">,</span> <span class="n">covx</span><span class="p">,</span> <span class="n">covy</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="kc">None</span><span class="p">,</span> <span class="kc">None</span><span class="p">,</span> <span class="kc">None</span>
    <span class="k">if</span> <span class="n">sigma_x</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">sx</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="n">sigma_x</span><span class="p">)</span>
        <span class="c1"># if sigma_x.shape == (x.size, x.size):</span>
        <span class="c1">#     covx = sigma_x</span>
        <span class="c1">#     sy = None</span>
    <span class="k">if</span> <span class="n">sigma_y</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">sy</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="n">sigma_y</span><span class="p">)</span>
        <span class="c1"># if sigma_y.shape == (y.size, y.size):</span>
        <span class="c1">#     covy = sigma_y</span>
        <span class="c1">#     sy = None</span>
    <span class="k">if</span> <span class="n">p0</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">arg_spec</span> <span class="o">=</span> <span class="n">inspect</span><span class="o">.</span><span class="n">getfullargspec</span><span class="p">(</span><span class="n">f</span><span class="p">)</span>
        <span class="n">n</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">arg_spec</span><span class="o">.</span><span class="n">args</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">n</span> <span class="o">&lt;</span> <span class="mi">1</span> <span class="ow">and</span> <span class="n">arg_spec</span><span class="o">.</span><span class="n">defaults</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">)</span> <span class="ow">or</span> <span class="p">(</span><span class="n">arg_spec</span><span class="o">.</span><span class="n">defaults</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">n</span> <span class="o">-</span> <span class="nb">len</span><span class="p">(</span><span class="n">arg_spec</span><span class="o">.</span><span class="n">defaults</span><span class="p">)</span> <span class="o">&lt;</span> <span class="mi">1</span><span class="p">):</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\&#39;</span><span class="s1">f</span><span class="se">\&#39;</span><span class="s1"> must have at least one parameter that can be optimized.&#39;</span><span class="p">)</span>
        <span class="n">p0</span> <span class="o">=</span> <span class="p">[</span><span class="mf">1.</span><span class="p">,</span> <span class="p">]</span> <span class="o">*</span> <span class="n">n</span>
        <span class="k">if</span> <span class="n">arg_spec</span><span class="o">.</span><span class="n">defaults</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">p0</span> <span class="o">=</span> <span class="p">[</span><span class="mf">1.</span><span class="p">,</span> <span class="p">]</span> <span class="o">*</span> <span class="p">(</span><span class="n">n</span> <span class="o">-</span> <span class="nb">len</span><span class="p">(</span><span class="n">arg_spec</span><span class="o">.</span><span class="n">defaults</span><span class="p">))</span>
    <span class="n">p0</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="n">p0</span><span class="p">)</span>

    <span class="n">ifixb</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="k">if</span> <span class="n">p0_fixed</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">ifixb</span> <span class="o">=</span> <span class="p">(</span><span class="o">~</span><span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="n">p0_fixed</span><span class="p">))</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">int</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">ifixb</span><span class="o">.</span><span class="n">shape</span> <span class="o">!=</span> <span class="n">p0</span><span class="o">.</span><span class="n">shape</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\&#39;</span><span class="s1">p0_fixed</span><span class="se">\&#39;</span><span class="s1"> must have the same shape as </span><span class="se">\&#39;</span><span class="s1">p0</span><span class="se">\&#39;</span><span class="s1">.&#39;</span><span class="p">)</span>

    <span class="n">data</span> <span class="o">=</span> <span class="n">odr</span><span class="o">.</span><span class="n">RealData</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">sx</span><span class="o">=</span><span class="n">sx</span><span class="p">,</span> <span class="n">sy</span><span class="o">=</span><span class="n">sy</span><span class="p">,</span> <span class="n">covx</span><span class="o">=</span><span class="n">covx</span><span class="p">,</span> <span class="n">covy</span><span class="o">=</span><span class="n">covy</span><span class="p">)</span>
    <span class="c1"># noinspection PyTypeChecker</span>
    <span class="n">model</span> <span class="o">=</span> <span class="n">odr</span><span class="o">.</span><span class="n">Model</span><span class="p">(</span><span class="k">lambda</span> <span class="n">beta</span><span class="p">,</span> <span class="n">x_i</span><span class="p">:</span> <span class="n">f</span><span class="p">(</span><span class="n">x_i</span><span class="p">,</span> <span class="o">*</span><span class="n">beta</span><span class="p">))</span>
    <span class="n">odr_i</span> <span class="o">=</span> <span class="n">odr</span><span class="o">.</span><span class="n">ODR</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">model</span><span class="p">,</span> <span class="n">beta0</span><span class="o">=</span><span class="n">p0</span><span class="p">,</span> <span class="n">delta0</span><span class="o">=</span><span class="n">p0_d</span><span class="p">,</span> <span class="n">ifixb</span><span class="o">=</span><span class="n">ifixb</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
    <span class="n">out</span> <span class="o">=</span> <span class="n">odr_i</span><span class="o">.</span><span class="n">run</span><span class="p">()</span>
    <span class="k">return</span> <span class="n">out</span><span class="o">.</span><span class="n">beta</span><span class="p">,</span> <span class="n">out</span><span class="o">.</span><span class="n">cov_beta</span></div>


<div class="viewcode-block" id="Element"><a class="viewcode-back" href="../../pycol.html#pycol.analyze.Element">[docs]</a><span class="k">class</span> <span class="nc">Element</span><span class="p">:</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Class representing a single chemical element. The user can define an electronic transition</span>
<span class="sd">     to extract all spectroscopy data for that transition available in the users &#39;AtomicDatabase.db&#39; database.</span>
<span class="sd">     The transition frequencies and isotope shifts are stored inside a nested dictionary</span>
<span class="sd">     with isotopes and the user-defined line labels as keys.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">label</span><span class="p">,</span> <span class="n">decimals</span><span class="o">=</span><span class="mi">3</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        :param label: The label of a chemical element.</span>
<span class="sd">        :param decimals: The number of decimal places (sub-MHz places) to use for frequency values.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">label</span> <span class="o">=</span> <span class="n">label</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">decimals</span> <span class="o">=</span> <span class="n">decimals</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">isotopes</span> <span class="o">=</span> <span class="p">{</span><span class="n">iso</span><span class="p">[</span><span class="s1">&#39;A&#39;</span><span class="p">]:</span> <span class="n">iso</span> <span class="k">for</span> <span class="n">iso</span> <span class="ow">in</span> <span class="n">dat</span><span class="o">.</span><span class="n">get_table_entries</span><span class="p">(</span><span class="s1">&#39;Isotopes&#39;</span><span class="p">,</span> <span class="p">{</span><span class="s1">&#39;element&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">label</span><span class="p">})}</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lines</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">a_ref</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">f_ref</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">df_ref</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">f</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">refs_f</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">df</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">refs_df</span> <span class="o">=</span> <span class="p">{}</span>

<div class="viewcode-block" id="Element.check_ref_args"><a class="viewcode-back" href="../../pycol.html#pycol.analyze.Element.check_ref_args">[docs]</a>    <span class="k">def</span> <span class="nf">check_ref_args</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">references</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="n">array_iter</span><span class="p">,</span> <span class="nb">dict</span><span class="p">,</span> <span class="nb">str</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="n">Union</span><span class="p">[</span><span class="nb">dict</span><span class="p">,</span> <span class="kc">None</span><span class="p">]:</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        :param references: A reference str, iterable of reference str&#39;s</span>
<span class="sd">         or a dictionary of these with isotopes or lines as keys.</span>
<span class="sd">        :returns: A dictionary of the specified references which has the structure {a: {line: [references, ]}}.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">references</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">return</span> <span class="kc">None</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">references</span><span class="p">,</span> <span class="nb">dict</span><span class="p">):</span>
            <span class="k">if</span> <span class="nb">any</span><span class="p">(</span><span class="n">a</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">isotopes</span><span class="o">.</span><span class="n">keys</span><span class="p">()</span> <span class="k">for</span> <span class="n">a</span> <span class="ow">in</span> <span class="n">references</span><span class="o">.</span><span class="n">keys</span><span class="p">()):</span>
                <span class="k">if</span> <span class="nb">any</span><span class="p">(</span><span class="n">line</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">lines</span><span class="o">.</span><span class="n">keys</span><span class="p">()</span> <span class="k">for</span> <span class="n">line</span> <span class="ow">in</span> <span class="n">references</span><span class="o">.</span><span class="n">keys</span><span class="p">()):</span>
                    <span class="k">return</span> <span class="kc">None</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="k">if</span> <span class="ow">not</span> <span class="nb">all</span><span class="p">(</span><span class="nb">isinstance</span><span class="p">(</span><span class="n">iso_dict</span><span class="p">,</span> <span class="nb">dict</span><span class="p">)</span> <span class="k">for</span> <span class="n">iso_dict</span> <span class="ow">in</span> <span class="n">references</span><span class="o">.</span><span class="n">values</span><span class="p">()):</span>
                        <span class="n">refs</span> <span class="o">=</span> <span class="p">{</span><span class="n">a</span><span class="p">:</span> <span class="p">{</span><span class="n">line</span><span class="p">:</span> <span class="n">tools</span><span class="o">.</span><span class="n">check_iterable</span><span class="p">(</span><span class="n">references</span><span class="p">[</span><span class="n">line</span><span class="p">])</span> <span class="k">if</span> <span class="n">line</span> <span class="ow">in</span> <span class="n">references</span><span class="o">.</span><span class="n">keys</span><span class="p">()</span> <span class="k">else</span> <span class="p">[]</span>
                                    <span class="k">for</span> <span class="n">line</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">lines</span><span class="o">.</span><span class="n">keys</span><span class="p">()}</span>
                                <span class="k">for</span> <span class="n">a</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">isotopes</span><span class="o">.</span><span class="n">keys</span><span class="p">()}</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="n">refs</span> <span class="o">=</span> <span class="p">{</span><span class="n">a</span><span class="p">:</span> <span class="p">{</span><span class="n">line</span><span class="p">:</span> <span class="n">tools</span><span class="o">.</span><span class="n">check_iterable</span><span class="p">(</span><span class="n">references</span><span class="p">[</span><span class="n">line</span><span class="p">][</span><span class="n">a</span><span class="p">])</span>
                                    <span class="k">if</span> <span class="n">line</span> <span class="ow">in</span> <span class="n">references</span><span class="o">.</span><span class="n">keys</span><span class="p">()</span> <span class="ow">and</span> <span class="n">a</span> <span class="ow">in</span> <span class="n">references</span><span class="p">[</span><span class="n">line</span><span class="p">]</span><span class="o">.</span><span class="n">keys</span><span class="p">()</span> <span class="k">else</span> <span class="p">[]</span>
                                    <span class="k">for</span> <span class="n">line</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">lines</span><span class="o">.</span><span class="n">keys</span><span class="p">()}</span>
                                <span class="k">for</span> <span class="n">a</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">isotopes</span><span class="o">.</span><span class="n">keys</span><span class="p">()}</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">if</span> <span class="ow">not</span> <span class="nb">all</span><span class="p">(</span><span class="nb">isinstance</span><span class="p">(</span><span class="n">line_dict</span><span class="p">,</span> <span class="nb">dict</span><span class="p">)</span> <span class="k">for</span> <span class="n">line_dict</span> <span class="ow">in</span> <span class="n">references</span><span class="o">.</span><span class="n">values</span><span class="p">()):</span>
                    <span class="n">refs</span> <span class="o">=</span> <span class="p">{</span><span class="n">a</span><span class="p">:</span> <span class="p">{</span><span class="n">line</span><span class="p">:</span> <span class="n">tools</span><span class="o">.</span><span class="n">check_iterable</span><span class="p">(</span><span class="n">references</span><span class="p">[</span><span class="n">a</span><span class="p">])</span> <span class="k">if</span> <span class="n">a</span> <span class="ow">in</span> <span class="n">references</span><span class="o">.</span><span class="n">keys</span><span class="p">()</span> <span class="k">else</span> <span class="p">[]</span>
                                <span class="k">for</span> <span class="n">line</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">lines</span><span class="o">.</span><span class="n">keys</span><span class="p">()}</span>
                            <span class="k">for</span> <span class="n">a</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">isotopes</span><span class="o">.</span><span class="n">keys</span><span class="p">()}</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">refs</span> <span class="o">=</span> <span class="p">{</span><span class="n">a</span><span class="p">:</span> <span class="p">{</span><span class="n">line</span><span class="p">:</span> <span class="n">tools</span><span class="o">.</span><span class="n">check_iterable</span><span class="p">(</span><span class="n">references</span><span class="p">[</span><span class="n">a</span><span class="p">][</span><span class="n">line</span><span class="p">])</span>
                                <span class="k">if</span> <span class="n">a</span> <span class="ow">in</span> <span class="n">references</span><span class="o">.</span><span class="n">keys</span><span class="p">()</span> <span class="ow">and</span> <span class="n">line</span> <span class="ow">in</span> <span class="n">references</span><span class="p">[</span><span class="n">a</span><span class="p">]</span><span class="o">.</span><span class="n">keys</span><span class="p">()</span> <span class="k">else</span> <span class="p">[]</span>
                                <span class="k">for</span> <span class="n">line</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">lines</span><span class="o">.</span><span class="n">keys</span><span class="p">()}</span>
                            <span class="k">for</span> <span class="n">a</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">isotopes</span><span class="o">.</span><span class="n">keys</span><span class="p">()}</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">refs</span> <span class="o">=</span> <span class="p">{</span><span class="n">a</span><span class="p">:</span> <span class="p">{</span><span class="n">line</span><span class="p">:</span> <span class="n">tools</span><span class="o">.</span><span class="n">check_iterable</span><span class="p">(</span><span class="n">references</span><span class="p">)</span> <span class="k">for</span> <span class="n">line</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">lines</span><span class="o">.</span><span class="n">keys</span><span class="p">()}</span>
                    <span class="k">for</span> <span class="n">a</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">isotopes</span><span class="o">.</span><span class="n">keys</span><span class="p">()}</span>
        <span class="k">return</span> <span class="n">refs</span></div>

<div class="viewcode-block" id="Element.define_line"><a class="viewcode-back" href="../../pycol.html#pycol.analyze.Element.define_line">[docs]</a>    <span class="k">def</span> <span class="nf">define_line</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">label</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">q</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span>
                    <span class="n">config_l</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">multiplet_l</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span> <span class="n">l_l</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span> <span class="n">j_l</span><span class="p">:</span> <span class="nb">float</span><span class="p">,</span>
                    <span class="n">config_u</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">multiplet_u</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span> <span class="n">l_u</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span> <span class="n">j_u</span><span class="p">:</span> <span class="nb">float</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        :param label: The user-defined name of the line.</span>
<span class="sd">        :param q: The charge state of the isotope (e).</span>
<span class="sd">        :param config_l: The electronic configuration of the lower state.</span>
<span class="sd">        :param multiplet_l: The spin multiplet of the lower state.</span>
<span class="sd">        :param l_l: The angular momentum quantum number L of the lower state.</span>
<span class="sd">        :param j_l: The total angular momentum quantum number J of the lower state.</span>
<span class="sd">        :param config_u: The electronic configuration of the upper state.</span>
<span class="sd">        :param multiplet_u: The spin multiplet of the upper state.</span>
<span class="sd">        :param l_u: The angular momentum quantum number L of the upper state.</span>
<span class="sd">        :param j_u: The total angular momentum quantum number J of the upper state.</span>
<span class="sd">        :returns: None. Extracts the available electronic transition/isotope shift entries for the specified line</span>
<span class="sd">         and stores them in &#39;self.f&#39; and &#39;self.df&#39;, respectively. The definition of the line is stored in &#39;self.lines&#39;.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">conditions</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;q&#39;</span><span class="p">:</span> <span class="n">q</span><span class="p">,</span> <span class="s1">&#39;config_l&#39;</span><span class="p">:</span> <span class="n">config_l</span><span class="p">,</span> <span class="s1">&#39;multiplet_l&#39;</span><span class="p">:</span> <span class="n">multiplet_l</span><span class="p">,</span> <span class="s1">&#39;L_l&#39;</span><span class="p">:</span> <span class="n">l_l</span><span class="p">,</span> <span class="s1">&#39;J_l&#39;</span><span class="p">:</span> <span class="n">j_l</span><span class="p">,</span>
                      <span class="s1">&#39;config_u&#39;</span><span class="p">:</span> <span class="n">config_u</span><span class="p">,</span> <span class="s1">&#39;multiplet_u&#39;</span><span class="p">:</span> <span class="n">multiplet_u</span><span class="p">,</span> <span class="s1">&#39;L_u&#39;</span><span class="p">:</span> <span class="n">l_u</span><span class="p">,</span> <span class="s1">&#39;J_u&#39;</span><span class="p">:</span> <span class="n">j_u</span><span class="p">}</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lines</span><span class="p">[</span><span class="n">label</span><span class="p">]</span> <span class="o">=</span> <span class="n">conditions</span>

        <span class="n">transitions</span> <span class="o">=</span> <span class="n">dat</span><span class="o">.</span><span class="n">get_table_entries</span><span class="p">(</span><span class="s1">&#39;Lines&#39;</span><span class="p">,</span> <span class="n">conditions</span><span class="p">)</span>
        <span class="n">shifts</span> <span class="o">=</span> <span class="n">dat</span><span class="o">.</span><span class="n">get_table_entries</span><span class="p">(</span><span class="s1">&#39;IsotopeShifts&#39;</span><span class="p">,</span> <span class="n">conditions</span><span class="p">)</span>

        <span class="k">for</span> <span class="n">tr</span> <span class="ow">in</span> <span class="n">transitions</span><span class="p">:</span>
            <span class="n">tools</span><span class="o">.</span><span class="n">add_nested_key</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">f_ref</span><span class="p">,</span> <span class="p">[</span><span class="n">tr</span><span class="p">[</span><span class="s1">&#39;A&#39;</span><span class="p">],</span> <span class="n">label</span><span class="p">,</span> <span class="n">tr</span><span class="p">[</span><span class="s1">&#39;reference&#39;</span><span class="p">]],</span> <span class="p">[</span><span class="n">tr</span><span class="p">[</span><span class="s1">&#39;f&#39;</span><span class="p">],</span> <span class="n">tr</span><span class="p">[</span><span class="s1">&#39;f_d&#39;</span><span class="p">]])</span>
        <span class="c1"># self.choose_f()</span>

        <span class="k">if</span> <span class="n">shifts</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">shift</span> <span class="ow">in</span> <span class="n">shifts</span><span class="p">:</span>
                <span class="n">tools</span><span class="o">.</span><span class="n">add_nested_key</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">df_ref</span><span class="p">,</span> <span class="p">[</span><span class="s1">&#39;</span><span class="si">{0}</span><span class="s1">-</span><span class="si">{1}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">shift</span><span class="p">[</span><span class="s1">&#39;A&#39;</span><span class="p">],</span> <span class="n">shift</span><span class="p">[</span><span class="s1">&#39;ARef&#39;</span><span class="p">]),</span> <span class="n">label</span><span class="p">,</span>
                                                   <span class="n">shift</span><span class="p">[</span><span class="s1">&#39;reference&#39;</span><span class="p">]],</span> <span class="p">[</span><span class="n">shift</span><span class="p">[</span><span class="s1">&#39;df&#39;</span><span class="p">],</span> <span class="n">shift</span><span class="p">[</span><span class="s1">&#39;df_d&#39;</span><span class="p">]])</span></div>
            <span class="c1"># self.choose_df(min([shift[&#39;ARef&#39;] for shift in shifts]))</span>

<div class="viewcode-block" id="Element.choose_f"><a class="viewcode-back" href="../../pycol.html#pycol.analyze.Element.choose_f">[docs]</a>    <span class="k">def</span> <span class="nf">choose_f</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">references</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="n">array_iter</span><span class="p">,</span> <span class="nb">dict</span><span class="p">,</span> <span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
                 <span class="n">exclude</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="n">array_iter</span><span class="p">,</span> <span class="nb">dict</span><span class="p">,</span> <span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        :param references: A reference str, iterable of reference str&#39;s,</span>
<span class="sd">         or a dictionary of these with isotopes or lines as keys.</span>
<span class="sd">         The most accurate frequency values will be determined from the specified references.</span>
<span class="sd">        :param exclude: A reference str, iterable of reference str&#39;s,</span>
<span class="sd">         or a dictionary of these with isotopes or lines as keys.</span>
<span class="sd">         The specified references will be excluded when choosing frequency values.</span>
<span class="sd">        :returns: None. Fills the dictionary self.f and self.refs_f</span>
<span class="sd">         with the chosen transition frequencies and references.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">f</span><span class="p">,</span> <span class="n">refs_f</span> <span class="o">=</span> <span class="p">{},</span> <span class="p">{}</span>
        <span class="k">if</span> <span class="n">exclude</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">exclude</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">refs</span><span class="p">,</span> <span class="n">exc</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">check_ref_args</span><span class="p">(</span><span class="n">references</span><span class="p">),</span> <span class="bp">self</span><span class="o">.</span><span class="n">check_ref_args</span><span class="p">(</span><span class="n">exclude</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">refs</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">refs</span> <span class="o">=</span> <span class="p">{</span><span class="n">a</span><span class="p">:</span> <span class="p">{</span><span class="n">line</span><span class="p">:</span> <span class="p">[</span><span class="n">ref</span> <span class="k">for</span> <span class="n">ref</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">f_ref</span><span class="p">[</span><span class="n">a</span><span class="p">][</span><span class="n">line</span><span class="p">]</span><span class="o">.</span><span class="n">keys</span><span class="p">()]</span>
                        <span class="k">for</span> <span class="n">line</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">lines</span><span class="o">.</span><span class="n">keys</span><span class="p">()}</span>
                    <span class="k">for</span> <span class="n">a</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">isotopes</span><span class="o">.</span><span class="n">keys</span><span class="p">()</span> <span class="k">if</span> <span class="n">a</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">f_ref</span><span class="o">.</span><span class="n">keys</span><span class="p">()}</span>
        <span class="k">for</span> <span class="n">a</span><span class="p">,</span> <span class="n">line_dict</span> <span class="ow">in</span> <span class="n">refs</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="n">f</span><span class="p">[</span><span class="n">a</span><span class="p">],</span> <span class="n">refs_f</span><span class="p">[</span><span class="n">a</span><span class="p">]</span> <span class="o">=</span> <span class="p">{},</span> <span class="p">{}</span>
            <span class="k">for</span> <span class="n">line</span><span class="p">,</span> <span class="n">ref_list</span> <span class="ow">in</span> <span class="n">line_dict</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
                <span class="n">uncertainties</span> <span class="o">=</span> <span class="p">[[</span><span class="n">ref</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">f_ref</span><span class="p">[</span><span class="n">a</span><span class="p">][</span><span class="n">line</span><span class="p">][</span><span class="n">ref</span><span class="p">][</span><span class="mi">1</span><span class="p">]]</span> <span class="k">for</span> <span class="n">ref</span> <span class="ow">in</span> <span class="n">ref_list</span>
                                 <span class="k">if</span> <span class="n">a</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">f_ref</span><span class="o">.</span><span class="n">keys</span><span class="p">()</span> <span class="ow">and</span> <span class="n">line</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">f_ref</span><span class="p">[</span><span class="n">a</span><span class="p">]</span><span class="o">.</span><span class="n">keys</span><span class="p">()</span>
                                 <span class="ow">and</span> <span class="n">ref</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">f_ref</span><span class="p">[</span><span class="n">a</span><span class="p">][</span><span class="n">line</span><span class="p">]</span><span class="o">.</span><span class="n">keys</span><span class="p">()</span> <span class="ow">and</span> <span class="n">ref</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">exc</span><span class="p">[</span><span class="n">a</span><span class="p">][</span><span class="n">line</span><span class="p">]]</span>
                <span class="k">if</span> <span class="ow">not</span> <span class="n">uncertainties</span><span class="p">:</span>
                    <span class="k">continue</span>
                <span class="n">i_min</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">argmin</span><span class="p">([</span><span class="n">unc</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="k">for</span> <span class="n">unc</span> <span class="ow">in</span> <span class="n">uncertainties</span><span class="p">]))</span>
                <span class="n">ref_min</span> <span class="o">=</span> <span class="n">uncertainties</span><span class="p">[</span><span class="n">i_min</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span>
                <span class="n">f</span><span class="p">[</span><span class="n">a</span><span class="p">][</span><span class="n">line</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">f_ref</span><span class="p">[</span><span class="n">a</span><span class="p">][</span><span class="n">line</span><span class="p">][</span><span class="n">ref_min</span><span class="p">]</span>
                <span class="n">refs_f</span><span class="p">[</span><span class="n">a</span><span class="p">][</span><span class="n">line</span><span class="p">]</span> <span class="o">=</span> <span class="n">ref_min</span>
        <span class="k">for</span> <span class="n">a</span> <span class="ow">in</span> <span class="n">refs</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
            <span class="k">if</span> <span class="n">f</span><span class="p">[</span><span class="n">a</span><span class="p">]</span> <span class="o">==</span> <span class="p">{}:</span>
                <span class="k">del</span> <span class="n">f</span><span class="p">[</span><span class="n">a</span><span class="p">]</span>
                <span class="k">del</span> <span class="n">refs_f</span><span class="p">[</span><span class="n">a</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">f</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">refs_f</span> <span class="o">=</span> <span class="n">f</span><span class="p">,</span> <span class="n">refs_f</span></div>

<div class="viewcode-block" id="Element.choose_df"><a class="viewcode-back" href="../../pycol.html#pycol.analyze.Element.choose_df">[docs]</a>    <span class="k">def</span> <span class="nf">choose_df</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">a_ref</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span> <span class="n">references</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="n">array_iter</span><span class="p">,</span> <span class="nb">dict</span><span class="p">,</span> <span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
                  <span class="n">exclude</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="n">array_iter</span><span class="p">,</span> <span class="nb">dict</span><span class="p">,</span> <span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        :param a_ref: The mass number of the reference isotope.</span>
<span class="sd">        :param references: A reference str, iterable of reference str&#39;s,</span>
<span class="sd">         or a dictionary of these with isotopes or lines as keys.</span>
<span class="sd">         The most accurate frequency values will be determined from the specified references.</span>
<span class="sd">        :param exclude: A reference str, iterable of reference str&#39;s,</span>
<span class="sd">         or a dictionary of these with isotopes or lines as keys.</span>
<span class="sd">         The specified references will be excluded when choosing frequency values.</span>
<span class="sd">        :returns: None. Fills the dictionary self.df and self.refs_df with the chosen isotope shifts and references.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">a_ref</span> <span class="o">=</span> <span class="n">a_ref</span>
        <span class="n">df</span><span class="p">,</span> <span class="n">refs_df</span> <span class="o">=</span> <span class="p">{},</span> <span class="p">{}</span>
        <span class="k">if</span> <span class="n">exclude</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">exclude</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">refs</span><span class="p">,</span> <span class="n">exc</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">check_ref_args</span><span class="p">(</span><span class="n">references</span><span class="p">),</span> <span class="bp">self</span><span class="o">.</span><span class="n">check_ref_args</span><span class="p">(</span><span class="n">exclude</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">refs</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">refs</span> <span class="o">=</span> <span class="p">{</span><span class="n">a</span><span class="p">:</span> <span class="p">{</span><span class="n">line</span><span class="p">:</span> <span class="p">[</span><span class="n">ref</span> <span class="k">for</span> <span class="n">ref</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">df_ref</span><span class="p">[</span><span class="s1">&#39;</span><span class="si">{0}</span><span class="s1">-</span><span class="si">{1}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="n">a_ref</span><span class="p">)][</span><span class="n">line</span><span class="p">]</span><span class="o">.</span><span class="n">keys</span><span class="p">()]</span>
                        <span class="k">for</span> <span class="n">line</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">lines</span><span class="o">.</span><span class="n">keys</span><span class="p">()}</span>
                    <span class="k">for</span> <span class="n">a</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">isotopes</span><span class="o">.</span><span class="n">keys</span><span class="p">()</span> <span class="k">if</span> <span class="s1">&#39;</span><span class="si">{0}</span><span class="s1">-</span><span class="si">{1}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="n">a_ref</span><span class="p">)</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">df_ref</span><span class="o">.</span><span class="n">keys</span><span class="p">()}</span>
        <span class="k">for</span> <span class="n">a</span><span class="p">,</span> <span class="n">line_dict</span> <span class="ow">in</span> <span class="n">refs</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="k">if</span> <span class="n">a</span> <span class="o">==</span> <span class="n">a_ref</span><span class="p">:</span>
                <span class="k">continue</span>
            <span class="n">df</span><span class="p">[</span><span class="n">a</span><span class="p">],</span> <span class="n">refs_df</span><span class="p">[</span><span class="n">a</span><span class="p">]</span> <span class="o">=</span> <span class="p">{},</span> <span class="p">{}</span>
            <span class="k">for</span> <span class="n">line</span><span class="p">,</span> <span class="n">ref_list</span> <span class="ow">in</span> <span class="n">line_dict</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
                <span class="n">uncertainties</span> <span class="o">=</span> <span class="p">[[</span><span class="n">ref</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">df_ref</span><span class="p">[</span><span class="s1">&#39;</span><span class="si">{0}</span><span class="s1">-</span><span class="si">{1}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="n">a_ref</span><span class="p">)][</span><span class="n">line</span><span class="p">][</span><span class="n">ref</span><span class="p">][</span><span class="mi">1</span><span class="p">]]</span>
                                 <span class="k">for</span> <span class="n">ref</span> <span class="ow">in</span> <span class="n">ref_list</span> <span class="k">if</span> <span class="s1">&#39;</span><span class="si">{0}</span><span class="s1">-</span><span class="si">{1}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="n">a_ref</span><span class="p">)</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">df_ref</span><span class="o">.</span><span class="n">keys</span><span class="p">()</span>
                                 <span class="ow">and</span> <span class="n">line</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">df_ref</span><span class="p">[</span><span class="s1">&#39;</span><span class="si">{0}</span><span class="s1">-</span><span class="si">{1}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="n">a_ref</span><span class="p">)]</span><span class="o">.</span><span class="n">keys</span><span class="p">()</span>
                                 <span class="ow">and</span> <span class="n">ref</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">df_ref</span><span class="p">[</span><span class="s1">&#39;</span><span class="si">{0}</span><span class="s1">-</span><span class="si">{1}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="n">a_ref</span><span class="p">)][</span><span class="n">line</span><span class="p">]</span><span class="o">.</span><span class="n">keys</span><span class="p">()</span>
                                 <span class="ow">and</span> <span class="n">ref</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">exc</span><span class="p">[</span><span class="n">a</span><span class="p">][</span><span class="n">line</span><span class="p">]]</span>
                <span class="k">if</span> <span class="ow">not</span> <span class="n">uncertainties</span><span class="p">:</span>
                    <span class="k">continue</span>
                <span class="n">i_min</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">argmin</span><span class="p">([</span><span class="n">unc</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="k">for</span> <span class="n">unc</span> <span class="ow">in</span> <span class="n">uncertainties</span><span class="p">]))</span>
                <span class="n">ref_min</span> <span class="o">=</span> <span class="n">uncertainties</span><span class="p">[</span><span class="n">i_min</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span>
                <span class="n">df</span><span class="p">[</span><span class="n">a</span><span class="p">][</span><span class="n">line</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">df_ref</span><span class="p">[</span><span class="s1">&#39;</span><span class="si">{0}</span><span class="s1">-</span><span class="si">{1}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="n">a_ref</span><span class="p">)][</span><span class="n">line</span><span class="p">][</span><span class="n">ref_min</span><span class="p">]</span>
                <span class="n">refs_df</span><span class="p">[</span><span class="n">a</span><span class="p">][</span><span class="n">line</span><span class="p">]</span> <span class="o">=</span> <span class="n">ref_min</span>
        <span class="k">for</span> <span class="n">a</span> <span class="ow">in</span> <span class="n">refs</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
            <span class="k">if</span> <span class="n">a</span> <span class="o">==</span> <span class="n">a_ref</span><span class="p">:</span>
                <span class="k">continue</span>
            <span class="k">if</span> <span class="n">df</span><span class="p">[</span><span class="n">a</span><span class="p">]</span> <span class="o">==</span> <span class="p">{}:</span>
                <span class="k">del</span> <span class="n">df</span><span class="p">[</span><span class="n">a</span><span class="p">]</span>
                <span class="k">del</span> <span class="n">refs_df</span><span class="p">[</span><span class="n">a</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">df</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">refs_df</span> <span class="o">=</span> <span class="n">df</span><span class="p">,</span> <span class="n">refs_df</span></div>

<div class="viewcode-block" id="Element.get_gamma"><a class="viewcode-back" href="../../pycol.html#pycol.analyze.Element.get_gamma">[docs]</a>    <span class="k">def</span> <span class="nf">get_gamma</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">line</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">tuple</span><span class="p">:</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        :param line: The label of the user-defined electronic transition.</span>
<span class="sd">        :returns: The natural linewidth of the electronic transition and its uncertainty (MHz).</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">conditions</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">lines</span><span class="p">[</span><span class="n">line</span><span class="p">]</span>
        <span class="k">except</span> <span class="ne">KeyError</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;WARNING: The specified line was not defined.&#39;</span><span class="p">)</span>
            <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">nan</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">nan</span>
        <span class="n">entries</span> <span class="o">=</span> <span class="n">dat</span><span class="o">.</span><span class="n">get_table_entries</span><span class="p">(</span><span class="s1">&#39;Lines&#39;</span><span class="p">,</span> <span class="n">conditions</span><span class="p">)</span>
        <span class="n">gamma</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([[</span><span class="n">entry</span><span class="p">[</span><span class="s1">&#39;Gamma&#39;</span><span class="p">],</span> <span class="n">entry</span><span class="p">[</span><span class="s1">&#39;Gamma_d&#39;</span><span class="p">]]</span> <span class="k">for</span> <span class="n">entry</span> <span class="ow">in</span> <span class="n">entries</span><span class="p">])</span>
        <span class="n">gamma</span> <span class="o">=</span> <span class="n">gamma</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">argmin</span><span class="p">(</span><span class="n">gamma</span><span class="p">[:,</span> <span class="mi">1</span><span class="p">]),</span> <span class="p">:]</span>
        <span class="k">return</span> <span class="nb">tuple</span><span class="p">(</span><span class="n">gamma</span><span class="p">)</span></div>

<div class="viewcode-block" id="Element.get_hyperfine_constants"><a class="viewcode-back" href="../../pycol.html#pycol.analyze.Element.get_hyperfine_constants">[docs]</a>    <span class="k">def</span> <span class="nf">get_hyperfine_constants</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">a</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span> <span class="n">line</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">tuple</span><span class="p">:</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        :param a: The mass number of the isotope.</span>
<span class="sd">        :param line: The label of the user-defined electronic transition.</span>
<span class="sd">        :returns: The natural linewidth of the electronic transition and its uncertainty (MHz).</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">conditions</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">lines</span><span class="p">[</span><span class="n">line</span><span class="p">]</span>
        <span class="k">except</span> <span class="ne">KeyError</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;WARNING: The specified line was not defined.&#39;</span><span class="p">)</span>
            <span class="k">return</span> <span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">nan</span><span class="p">,</span> <span class="p">]</span> <span class="o">*</span> <span class="mi">4</span><span class="p">,</span> <span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">nan</span><span class="p">,</span> <span class="p">]</span> <span class="o">*</span> <span class="mi">4</span>
        <span class="n">tools</span><span class="o">.</span><span class="n">merge_dicts</span><span class="p">(</span><span class="n">conditions</span><span class="p">,</span> <span class="p">{</span><span class="s1">&#39;A&#39;</span><span class="p">:</span> <span class="n">a</span><span class="p">})</span>
        <span class="n">entries</span> <span class="o">=</span> <span class="n">dat</span><span class="o">.</span><span class="n">get_table_entries</span><span class="p">(</span><span class="s1">&#39;Lines&#39;</span><span class="p">,</span> <span class="n">conditions</span><span class="p">)</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">entries</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;WARNING: There are no entries for the specified mass number (</span><span class="si">{}</span><span class="s1">) and line (</span><span class="si">{}</span><span class="s1">).&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="n">line</span><span class="p">))</span>
            <span class="k">return</span> <span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">nan</span><span class="p">,</span> <span class="p">]</span> <span class="o">*</span> <span class="mi">4</span><span class="p">,</span> <span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">nan</span><span class="p">,</span> <span class="p">]</span> <span class="o">*</span> <span class="mi">4</span>
        <span class="n">ret1</span><span class="p">,</span> <span class="n">ret2</span> <span class="o">=</span> <span class="p">[],</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">const</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;A_l&#39;</span><span class="p">,</span> <span class="s1">&#39;B_l&#39;</span><span class="p">,</span> <span class="s1">&#39;A_u&#39;</span><span class="p">,</span> <span class="s1">&#39;B_u&#39;</span><span class="p">]:</span>
            <span class="n">val</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([[</span><span class="n">entry</span><span class="p">[</span><span class="n">const</span><span class="p">],</span> <span class="n">entry</span><span class="p">[</span><span class="n">const</span> <span class="o">+</span> <span class="s1">&#39;_d&#39;</span><span class="p">]]</span> <span class="k">for</span> <span class="n">entry</span> <span class="ow">in</span> <span class="n">entries</span><span class="p">])</span>
            <span class="n">val</span> <span class="o">=</span> <span class="n">val</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">argmin</span><span class="p">(</span><span class="n">val</span><span class="p">[:,</span> <span class="mi">1</span><span class="p">]),</span> <span class="p">:]</span>
            <span class="n">ret1</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">nan</span> <span class="k">if</span> <span class="n">val</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="ow">is</span> <span class="kc">None</span> <span class="k">else</span> <span class="n">val</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
            <span class="n">ret2</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">nan</span> <span class="k">if</span> <span class="n">val</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="ow">is</span> <span class="kc">None</span> <span class="k">else</span> <span class="n">val</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
        <span class="k">return</span> <span class="n">ret1</span><span class="p">,</span> <span class="n">ret2</span></div>

<div class="viewcode-block" id="Element.spectroscopy_info"><a class="viewcode-back" href="../../pycol.html#pycol.analyze.Element.spectroscopy_info">[docs]</a>    <span class="k">def</span> <span class="nf">spectroscopy_info</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">e_kin</span><span class="p">:</span> <span class="nb">float</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">dict</span><span class="p">:</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        :param e_kin: Kinetic energy of the isotopes (eV).</span>
<span class="sd">        :returns: A dictionary of information for collinear laser spectroscopy with keys &#39;E&#39;, &#39;U&#39;, &#39;v&#39;, &#39;col&#39; and &#39;acol&#39;</span>
<span class="sd">         for the kinetic energy (eV), the required voltage (V), the velocity of isotopes</span>
<span class="sd">         with an initial velocity of 0 m/s (m/s), as well as the resonant laser frequencies</span>
<span class="sd">         in collinear and anticollinear geometry (MHz).</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">info</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="k">for</span> <span class="n">a</span><span class="p">,</span> <span class="n">line_dict</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">f</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="n">info</span><span class="p">[</span><span class="n">a</span><span class="p">]</span> <span class="o">=</span> <span class="p">{}</span>
            <span class="k">for</span> <span class="n">line</span><span class="p">,</span> <span class="n">f</span> <span class="ow">in</span> <span class="n">line_dict</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
                <span class="n">v</span> <span class="o">=</span> <span class="n">ph</span><span class="o">.</span><span class="n">v_e</span><span class="p">(</span><span class="n">e_kin</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">isotopes</span><span class="p">[</span><span class="n">a</span><span class="p">][</span><span class="s1">&#39;mass&#39;</span><span class="p">],</span> <span class="mf">0.</span><span class="p">)</span>
                <span class="n">col</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">around</span><span class="p">(</span><span class="n">ph</span><span class="o">.</span><span class="n">doppler</span><span class="p">(</span><span class="n">f</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">v</span><span class="p">,</span> <span class="mf">0.</span><span class="p">,</span> <span class="n">return_frame</span><span class="o">=</span><span class="s1">&#39;lab&#39;</span><span class="p">),</span> <span class="n">decimals</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">decimals</span><span class="p">)</span>
                <span class="n">acol</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">around</span><span class="p">(</span><span class="n">ph</span><span class="o">.</span><span class="n">doppler</span><span class="p">(</span><span class="n">f</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">v</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="p">,</span> <span class="n">return_frame</span><span class="o">=</span><span class="s1">&#39;lab&#39;</span><span class="p">),</span> <span class="n">decimals</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">decimals</span><span class="p">)</span>
                <span class="n">info</span><span class="p">[</span><span class="n">a</span><span class="p">][</span><span class="n">line</span><span class="p">]</span> <span class="o">=</span> \
                    <span class="p">{</span><span class="s1">&#39;E&#39;</span><span class="p">:</span> <span class="n">e_kin</span><span class="p">,</span> <span class="s1">&#39;U&#39;</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">nan</span> <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">lines</span><span class="p">[</span><span class="n">line</span><span class="p">][</span><span class="s1">&#39;q&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="mi">0</span> <span class="k">else</span> <span class="n">e_kin</span> <span class="o">/</span> <span class="bp">self</span><span class="o">.</span><span class="n">lines</span><span class="p">[</span><span class="n">line</span><span class="p">][</span><span class="s1">&#39;q&#39;</span><span class="p">],</span>
                     <span class="s1">&#39;v&#39;</span><span class="p">:</span> <span class="n">v</span><span class="p">,</span> <span class="s1">&#39;col&#39;</span><span class="p">:</span> <span class="n">col</span><span class="p">,</span> <span class="s1">&#39;acol&#39;</span><span class="p">:</span> <span class="n">acol</span><span class="p">}</span>
        <span class="k">return</span> <span class="n">info</span></div>

<div class="viewcode-block" id="Element.get_f"><a class="viewcode-back" href="../../pycol.html#pycol.analyze.Element.get_f">[docs]</a>    <span class="k">def</span> <span class="nf">get_f</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">a</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="n">Iterable</span><span class="p">[</span><span class="nb">int</span><span class="p">]],</span> <span class="n">line</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Iterable</span><span class="p">[</span><span class="nb">str</span><span class="p">]],</span>
              <span class="n">rtype</span><span class="p">:</span> <span class="nb">type</span> <span class="o">=</span> <span class="n">ndarray</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Union</span><span class="p">[</span><span class="n">ndarray</span><span class="p">,</span> <span class="nb">dict</span><span class="p">,</span> <span class="ne">ValueError</span><span class="p">]:</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        :param a: The mass number or an Iterable of mass numbers.</span>
<span class="sd">        :param line: A line or an Iterable of previously defined lines.</span>
<span class="sd">        :param rtype: The type in which the results will be returned. Currently supported special types are [dict, ].</span>
<span class="sd">         The standard &#39;rtype&#39; is a numpy array.</span>
<span class="sd">        :returns: A subset of the dictionary &#39;self.f&#39; as a dictionary or a numpy array.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="n">_get_rtype2</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">f</span><span class="p">,</span> <span class="n">a</span><span class="p">,</span> <span class="n">line</span><span class="p">,</span> <span class="n">rtype</span><span class="o">=</span><span class="n">rtype</span><span class="p">)</span></div>

<div class="viewcode-block" id="Element.get_df"><a class="viewcode-back" href="../../pycol.html#pycol.analyze.Element.get_df">[docs]</a>    <span class="k">def</span> <span class="nf">get_df</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">a</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="n">Iterable</span><span class="p">[</span><span class="nb">int</span><span class="p">]],</span> <span class="n">line</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Iterable</span><span class="p">[</span><span class="nb">str</span><span class="p">]],</span> <span class="n">rtype</span><span class="p">:</span> <span class="nb">type</span> <span class="o">=</span> <span class="n">ndarray</span><span class="p">)</span> \
            <span class="o">-&gt;</span> <span class="n">Union</span><span class="p">[</span><span class="n">ndarray</span><span class="p">,</span> <span class="nb">dict</span><span class="p">,</span> <span class="ne">ValueError</span><span class="p">]:</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        :param a: The mass number or an Iterable of mass numbers.</span>
<span class="sd">        :param line: A line or an Iterable of previously defined lines.</span>
<span class="sd">        :param rtype: The type in which the results will be returned. Currently supported special types are [dict, ].</span>
<span class="sd">         The standard &#39;rtype&#39; is a numpy array.</span>
<span class="sd">        :returns: A subset of the dictionary &#39;self.df&#39; as a dictionary or a numpy array.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="n">_get_rtype2</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">df</span><span class="p">,</span> <span class="n">a</span><span class="p">,</span> <span class="n">line</span><span class="p">,</span> <span class="n">rtype</span><span class="o">=</span><span class="n">rtype</span><span class="p">)</span></div>
    
<div class="viewcode-block" id="Element.calc_df"><a class="viewcode-back" href="../../pycol.html#pycol.analyze.Element.calc_df">[docs]</a>    <span class="k">def</span> <span class="nf">calc_df</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">a</span><span class="p">:</span> <span class="n">Iterable</span><span class="p">[</span><span class="nb">int</span><span class="p">],</span> <span class="n">a_ref</span><span class="p">:</span> <span class="n">Iterable</span><span class="p">[</span><span class="nb">int</span><span class="p">],</span> <span class="n">line</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Iterable</span><span class="p">[</span><span class="nb">str</span><span class="p">]],</span>
                <span class="n">rtype</span><span class="p">:</span> <span class="nb">type</span> <span class="o">=</span> <span class="n">ndarray</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Union</span><span class="p">[</span><span class="n">ndarray</span><span class="p">,</span> <span class="nb">dict</span><span class="p">,</span> <span class="ne">ValueError</span><span class="p">]:</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        :param a: An Iterable of the mass numbers of the isotopes.</span>
<span class="sd">        :param a_ref: An Iterable of the mass numbers of the reference isotopes</span>
<span class="sd">        :param line: A line or an Iterable of previously defined lines.</span>
<span class="sd">        :param rtype: The type in which the results will be returned. Currently supported special types are [dict, ].</span>
<span class="sd">         The standard &#39;rtype&#39; is a numpy array.</span>
<span class="sd">        :returns: Differences of transition frequencies and their uncertainties calculated from the &#39;self.f&#39; dictionary</span>
<span class="sd">         according to the lists &#39;a&#39; and &#39;a_ref&#39;. The output has shape (len(a), 2)</span>
<span class="sd">         or shape (len(a), len(line), 2) if line is a list.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">line</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
            <span class="n">a_dict</span> <span class="o">=</span> <span class="p">{</span><span class="n">k</span><span class="p">:</span> <span class="n">v</span><span class="p">[</span><span class="n">line</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span> <span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">f</span><span class="o">.</span><span class="n">items</span><span class="p">()}</span>
            <span class="n">a_d_dict</span> <span class="o">=</span> <span class="p">{</span><span class="n">k</span><span class="p">:</span>  <span class="n">v</span><span class="p">[</span><span class="n">line</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span> <span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">f</span><span class="o">.</span><span class="n">items</span><span class="p">()}</span>
            <span class="n">v_dict</span> <span class="o">=</span> <span class="n">tools</span><span class="o">.</span><span class="n">convolve_dict</span><span class="p">(</span><span class="n">a_dict</span><span class="p">,</span> <span class="n">a</span><span class="p">,</span> <span class="n">a_ref</span><span class="p">,</span> <span class="n">operator</span><span class="o">=</span><span class="s1">&#39;-&#39;</span><span class="p">)</span>
            <span class="n">v_d_dict</span> <span class="o">=</span> <span class="n">tools</span><span class="o">.</span><span class="n">convolve_dict</span><span class="p">(</span><span class="n">a_d_dict</span><span class="p">,</span> <span class="n">a</span><span class="p">,</span> <span class="n">a_ref</span><span class="p">,</span> <span class="n">operator</span><span class="o">=</span><span class="s1">&#39;gauss&#39;</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">rtype</span> <span class="o">==</span> <span class="nb">dict</span><span class="p">:</span>
                <span class="k">return</span> <span class="p">{</span><span class="n">a_i</span><span class="p">:</span> <span class="p">[</span><span class="nb">round</span><span class="p">(</span><span class="n">v_dict</span><span class="p">[</span><span class="n">a_i</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">decimals</span><span class="p">),</span> <span class="nb">round</span><span class="p">(</span><span class="n">v_d_dict</span><span class="p">[</span><span class="n">a_i</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">decimals</span><span class="p">)]</span> <span class="k">for</span> <span class="n">a_i</span> <span class="ow">in</span> <span class="n">a</span><span class="p">}</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([[</span><span class="nb">round</span><span class="p">(</span><span class="n">v_dict</span><span class="p">[</span><span class="n">a_i</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">decimals</span><span class="p">),</span> <span class="nb">round</span><span class="p">(</span><span class="n">v_d_dict</span><span class="p">[</span><span class="n">a_i</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">decimals</span><span class="p">)]</span> <span class="k">for</span> <span class="n">a_i</span> <span class="ow">in</span> <span class="n">a</span><span class="p">])</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">a_dict</span> <span class="o">=</span> <span class="p">{</span><span class="n">k</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">v</span><span class="p">[</span><span class="n">ll</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span> <span class="k">for</span> <span class="n">ll</span> <span class="ow">in</span> <span class="n">line</span><span class="p">])</span> <span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">f</span><span class="o">.</span><span class="n">items</span><span class="p">()}</span>
            <span class="n">a_d_dict</span> <span class="o">=</span> <span class="p">{</span><span class="n">k</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">v</span><span class="p">[</span><span class="n">ll</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span> <span class="k">for</span> <span class="n">ll</span> <span class="ow">in</span> <span class="n">line</span><span class="p">])</span> <span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">f</span><span class="o">.</span><span class="n">items</span><span class="p">()}</span>
            <span class="n">v_dict</span> <span class="o">=</span> <span class="n">tools</span><span class="o">.</span><span class="n">convolve_dict</span><span class="p">(</span><span class="n">a_dict</span><span class="p">,</span> <span class="n">a</span><span class="p">,</span> <span class="n">a_ref</span><span class="p">,</span> <span class="n">operator</span><span class="o">=</span><span class="s1">&#39;-&#39;</span><span class="p">)</span>
            <span class="n">v_d_dict</span> <span class="o">=</span> <span class="n">tools</span><span class="o">.</span><span class="n">convolve_dict</span><span class="p">(</span><span class="n">a_d_dict</span><span class="p">,</span> <span class="n">a</span><span class="p">,</span> <span class="n">a_ref</span><span class="p">,</span> <span class="n">operator</span><span class="o">=</span><span class="s1">&#39;gauss&#39;</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">rtype</span> <span class="o">==</span> <span class="nb">dict</span><span class="p">:</span>
                <span class="ne">ValueError</span><span class="p">(</span><span class="s1">&#39;rtype=dict not implemented for list of lines yet.&#39;</span><span class="p">)</span>
                <span class="k">pass</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">np</span><span class="o">.</span><span class="n">around</span><span class="p">(</span><span class="n">v_dict</span><span class="p">[</span><span class="n">a_i</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">decimals</span><span class="p">),</span>
                                           <span class="n">np</span><span class="o">.</span><span class="n">around</span><span class="p">(</span><span class="n">v_d_dict</span><span class="p">[</span><span class="n">a_i</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">decimals</span><span class="p">)])</span><span class="o">.</span><span class="n">T</span> <span class="k">for</span> <span class="n">a_i</span> <span class="ow">in</span> <span class="n">a</span><span class="p">])</span></div>

    <span class="k">def</span> <span class="nf">_calc_f</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">a</span><span class="p">:</span> <span class="n">Iterable</span><span class="p">[</span><span class="nb">int</span><span class="p">],</span> <span class="n">a_ref</span><span class="p">:</span> <span class="n">Iterable</span><span class="p">[</span><span class="nb">int</span><span class="p">],</span> <span class="n">line</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
                <span class="n">rtype</span><span class="p">:</span> <span class="nb">type</span> <span class="o">=</span> <span class="n">ndarray</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Union</span><span class="p">[</span><span class="n">ndarray</span><span class="p">,</span> <span class="nb">dict</span><span class="p">,</span> <span class="ne">ValueError</span><span class="p">]:</span>
        <span class="c1"># TODO?: Calculation of lines.</span>
        <span class="k">pass</span>

<div class="viewcode-block" id="Element.get_masses"><a class="viewcode-back" href="../../pycol.html#pycol.analyze.Element.get_masses">[docs]</a>    <span class="k">def</span> <span class="nf">get_masses</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">a</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="n">Iterable</span><span class="p">[</span><span class="nb">int</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">rtype</span><span class="p">:</span> <span class="nb">type</span> <span class="o">=</span> <span class="n">ndarray</span><span class="p">)</span> \
            <span class="o">-&gt;</span> <span class="n">Union</span><span class="p">[</span><span class="n">ndarray</span><span class="p">,</span> <span class="nb">dict</span><span class="p">,</span> <span class="ne">ValueError</span><span class="p">]:</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        :param a: An Iterable of the mass numbers of the isotopes to be returned.</span>
<span class="sd">        :param rtype: The type in which the results will be returned. Currently supported special types are [dict, ].</span>
<span class="sd">         The standard &#39;rtype&#39; is a numpy array.</span>
<span class="sd">        :returns: The masses and their uncertainties of the specified mass numbers.</span>
<span class="sd">         The output has shape (2, ) if a is an int value and shape (len(a), 2) if a is an Iterable.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">a</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">a</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">isotopes</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span>
        <span class="n">a_arr</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="n">a</span><span class="p">)</span>
        <span class="n">a_dim</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">a_arr</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">a_dim</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">rtype</span> <span class="o">==</span> <span class="nb">dict</span><span class="p">:</span>
                <span class="k">return</span> <span class="p">{</span><span class="n">a</span><span class="p">:</span> <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">isotopes</span><span class="p">[</span><span class="n">a</span><span class="p">][</span><span class="s1">&#39;mass&#39;</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">isotopes</span><span class="p">[</span><span class="n">a</span><span class="p">][</span><span class="s1">&#39;mass_d&#39;</span><span class="p">]]}</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="bp">self</span><span class="o">.</span><span class="n">isotopes</span><span class="p">[</span><span class="n">a</span><span class="p">][</span><span class="s1">&#39;mass&#39;</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">isotopes</span><span class="p">[</span><span class="n">a</span><span class="p">][</span><span class="s1">&#39;mass_d&#39;</span><span class="p">]])</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">rtype</span> <span class="o">==</span> <span class="nb">dict</span><span class="p">:</span>
                <span class="k">return</span> <span class="p">{</span><span class="n">a_i</span><span class="p">:</span> <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">isotopes</span><span class="p">[</span><span class="n">a_i</span><span class="p">][</span><span class="s1">&#39;mass&#39;</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">isotopes</span><span class="p">[</span><span class="n">a_i</span><span class="p">][</span><span class="s1">&#39;mass_d&#39;</span><span class="p">]]</span> <span class="k">for</span> <span class="n">a_i</span> <span class="ow">in</span> <span class="n">a</span><span class="p">}</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([[</span><span class="bp">self</span><span class="o">.</span><span class="n">isotopes</span><span class="p">[</span><span class="n">a_i</span><span class="p">][</span><span class="s1">&#39;mass&#39;</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">isotopes</span><span class="p">[</span><span class="n">a_i</span><span class="p">][</span><span class="s1">&#39;mass_d&#39;</span><span class="p">]]</span> <span class="k">for</span> <span class="n">a_i</span> <span class="ow">in</span> <span class="n">a</span><span class="p">])</span></div>

<div class="viewcode-block" id="Element.get_radii"><a class="viewcode-back" href="../../pycol.html#pycol.analyze.Element.get_radii">[docs]</a>    <span class="k">def</span> <span class="nf">get_radii</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        :returns: The default &#39;Radii&#39; object for this element.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="n">Radii</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">label</span><span class="p">)</span></div>

<div class="viewcode-block" id="Element.get_king"><a class="viewcode-back" href="../../pycol.html#pycol.analyze.Element.get_king">[docs]</a>    <span class="k">def</span> <span class="nf">get_king</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        :returns: A &#39;King&#39; object including all isotopes available in &#39;AtomicDatabase.db&#39;.</span>
<span class="sd">         The number of subtracted electrons in the &#39;King&#39; object is equal to the charge number Z of the element.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">a</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">isotopes</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span>
        <span class="k">return</span> <span class="n">King</span><span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_masses</span><span class="p">(</span><span class="n">a</span><span class="p">),</span> <span class="n">subtract_electrons</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">isotopes</span><span class="p">[</span><span class="n">a</span><span class="p">[</span><span class="mi">0</span><span class="p">]][</span><span class="s1">&#39;Z&#39;</span><span class="p">],</span> <span class="n">element_label</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">label</span><span class="p">)</span></div></div>


<div class="viewcode-block" id="Radii"><a class="viewcode-back" href="../../pycol.html#pycol.analyze.Radii">[docs]</a><span class="k">class</span> <span class="nc">Radii</span><span class="p">:</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    A class which holds the information about nuclear charge radii from muonic atom spectroscopy</span>
<span class="sd">     and elastic electron scattering. Differences of the even moments of nuclear charge radii</span>
<span class="sd">     as well as the Lambda parameter can be returned in a dict or an array format</span>
<span class="sd">     in the specified combination of mass numbers and reference mass numbers.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">element</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">a</span><span class="p">:</span> <span class="n">array_iter</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">barrett</span><span class="p">:</span> <span class="n">array_iter</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
                 <span class="n">vn</span><span class="p">:</span> <span class="n">array_like</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">seltzer</span><span class="p">:</span> <span class="n">array_iter</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">decimals</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">4</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        :param a: An iterable of mass numbers.</span>
<span class="sd">        :param barrett: An iterable of Barrett radii. Must have shape (len(a), 2) and include the values in the first</span>
<span class="sd">         and the uncertainties in the second column.</span>
<span class="sd">        :param vn: An iterable of Vn factors. Must have either shape (3, ) or (1, 3)</span>
<span class="sd">         in which case the same Vn factors are used for all specified mass numbers or shape (len(a), 3)</span>
<span class="sd">         in which case individual Vn factors are used for every mass number.</span>
<span class="sd">        :param seltzer: An iterable of the two Seltzer coefficients [C2/C1, C3/C1].</span>
<span class="sd">        :param decimals: The number of decimal places (sub-square-fm places) to use for radial values.</span>
<span class="sd">        Any of the parameters which is None is exported from the database &#39;NuclearChargeRadii.db&#39;.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">element</span> <span class="o">=</span> <span class="n">element</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">conditions</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;element&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">element</span><span class="p">}</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">decimals</span> <span class="o">=</span> <span class="n">decimals</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">a</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="k">if</span> <span class="n">a</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">a</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="nb">object</span><span class="p">,</span> <span class="nb">list</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="nb">int</span><span class="p">)</span><span class="o">.</span><span class="n">tolist</span><span class="p">()</span>

        <span class="k">if</span> <span class="n">barrett</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">barrett_ref</span> <span class="o">=</span> <span class="n">dat</span><span class="o">.</span><span class="n">get_table_entries</span><span class="p">(</span><span class="s1">&#39;BarrettRadii&#39;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">conditions</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">a</span> <span class="o">=</span> <span class="nb">list</span><span class="p">({</span><span class="n">entry</span><span class="p">[</span><span class="s1">&#39;A&#39;</span><span class="p">]</span> <span class="k">for</span> <span class="n">entry</span> <span class="ow">in</span> <span class="n">barrett_ref</span><span class="p">})</span>
            <span class="n">references</span> <span class="o">=</span> <span class="p">{</span><span class="n">entry</span><span class="p">[</span><span class="s1">&#39;reference&#39;</span><span class="p">]</span> <span class="k">for</span> <span class="n">entry</span> <span class="ow">in</span> <span class="n">barrett_ref</span><span class="p">}</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">barrett_ref</span> <span class="o">=</span> <span class="p">{</span><span class="n">ref</span><span class="p">:</span> <span class="p">{</span><span class="n">entry</span><span class="p">[</span><span class="s1">&#39;A&#39;</span><span class="p">]:</span> <span class="p">[</span><span class="n">entry</span><span class="p">[</span><span class="s1">&#39;val&#39;</span><span class="p">],</span> <span class="n">entry</span><span class="p">[</span><span class="s1">&#39;StatErr&#39;</span><span class="p">]</span> <span class="o">+</span> <span class="n">entry</span><span class="p">[</span><span class="s1">&#39;SysErr&#39;</span><span class="p">]]</span>
                                      <span class="k">for</span> <span class="n">entry</span> <span class="ow">in</span> <span class="n">barrett_ref</span> <span class="k">if</span> <span class="n">entry</span><span class="p">[</span><span class="s1">&#39;reference&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="n">ref</span>
                                      <span class="ow">and</span> <span class="p">(</span><span class="n">a</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">or</span> <span class="n">entry</span><span class="p">[</span><span class="s1">&#39;A&#39;</span><span class="p">]</span> <span class="ow">in</span> <span class="n">a</span><span class="p">)}</span> <span class="k">for</span> <span class="n">ref</span> <span class="ow">in</span> <span class="n">references</span><span class="p">}</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">ref_barrett</span> <span class="o">=</span> <span class="kc">None</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">choose_barrett</span><span class="p">()</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">a</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\&#39;</span><span class="s1">a</span><span class="se">\&#39;</span><span class="s1"> is not specified and therefore </span><span class="se">\&#39;</span><span class="s1">barrett</span><span class="se">\&#39;</span><span class="s1"> cannot be &#39;</span>
                                 <span class="s1">&#39;related to mass numbers unambiguously.&#39;</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">barrett</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="n">barrett</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">vn</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">vn</span> <span class="o">=</span> <span class="p">{</span><span class="n">entry</span><span class="p">[</span><span class="s1">&#39;A&#39;</span><span class="p">]:</span> <span class="n">entry</span> <span class="k">for</span> <span class="n">entry</span> <span class="ow">in</span> <span class="n">dat</span><span class="o">.</span><span class="n">get_table_entries</span><span class="p">(</span><span class="s1">&#39;Vn&#39;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">conditions</span><span class="p">)}</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">vn</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([[</span><span class="bp">self</span><span class="o">.</span><span class="n">vn</span><span class="p">[</span><span class="n">a_i</span><span class="p">][</span><span class="s1">&#39;V2&#39;</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">vn</span><span class="p">[</span><span class="n">a_i</span><span class="p">][</span><span class="s1">&#39;V4&#39;</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">vn</span><span class="p">[</span><span class="n">a_i</span><span class="p">][</span><span class="s1">&#39;V6&#39;</span><span class="p">]]</span> <span class="k">if</span> <span class="n">a_i</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">vn</span><span class="o">.</span><span class="n">keys</span><span class="p">()</span>
                                <span class="k">else</span> <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">vn</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">][</span><span class="s1">&#39;V2&#39;</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">vn</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">][</span><span class="s1">&#39;V4&#39;</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">vn</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">][</span><span class="s1">&#39;V6&#39;</span><span class="p">]]</span>
                                <span class="k">for</span> <span class="n">a_i</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">a</span><span class="p">])</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">vn</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="n">vn</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">a</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">vn</span><span class="o">.</span><span class="n">shape</span> <span class="ow">not</span> <span class="ow">in</span> <span class="p">[(</span><span class="mi">3</span><span class="p">,</span> <span class="p">),</span> <span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">3</span><span class="p">)]:</span>
                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\&#39;</span><span class="s1">a</span><span class="se">\&#39;</span><span class="s1"> is not specified and therefore </span><span class="se">\&#39;</span><span class="s1">vn</span><span class="se">\&#39;</span><span class="s1"> cannot be &#39;</span>
                                 <span class="s1">&#39;related to mass numbers unambiguously.&#39;</span><span class="p">)</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">vn</span><span class="o">.</span><span class="n">shape</span> <span class="o">==</span> <span class="p">(</span><span class="mi">3</span><span class="p">,</span> <span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">vn</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">expand_dims</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">vn</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">vn</span><span class="o">.</span><span class="n">shape</span> <span class="o">==</span> <span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">3</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">vn</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="bp">self</span><span class="o">.</span><span class="n">vn</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="p">]</span> <span class="o">*</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">a</span><span class="p">))</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">seltzer</span> <span class="o">=</span> <span class="n">seltzer</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">seltzer</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">seltzer</span> <span class="o">=</span> <span class="n">dat</span><span class="o">.</span><span class="n">get_table_entries</span><span class="p">(</span><span class="s1">&#39;SeltzerCoefficients&#39;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">conditions</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">seltzer</span> <span class="o">=</span> <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">seltzer</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="s1">&#39;C2C1&#39;</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">seltzer</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="s1">&#39;C3C1&#39;</span><span class="p">]]</span>

<div class="viewcode-block" id="Radii.choose_barrett"><a class="viewcode-back" href="../../pycol.html#pycol.analyze.Radii.choose_barrett">[docs]</a>    <span class="k">def</span> <span class="nf">choose_barrett</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">references</span><span class="p">:</span> <span class="n">Iterable</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">mode</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s1">&#39;mean&#39;</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        :param references: An Iterable of references to consider.</span>
<span class="sd">        :param mode: The mode how to choose the Barret radii from multiple references.</span>
<span class="sd">         The Currently supported modes are {&#39;minErr&#39;, mean}.</span>
<span class="sd">        :returns: None. Sets the instance variables &#39;barrett&#39; and &#39;used_references&#39;.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">modes</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;minUnc&#39;</span><span class="p">,</span> <span class="s1">&#39;mean&#39;</span><span class="p">]</span>
        <span class="n">barrett</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">ref_barrett</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">if</span> <span class="n">mode</span> <span class="o">==</span> <span class="s1">&#39;minUnc&#39;</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">a</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">a</span><span class="p">:</span>
                <span class="n">uncertainties</span> <span class="o">=</span> <span class="p">[[</span><span class="n">ref</span><span class="p">,</span> <span class="n">r</span><span class="p">[</span><span class="n">a</span><span class="p">][</span><span class="mi">1</span><span class="p">]]</span>
                                 <span class="k">for</span> <span class="n">ref</span><span class="p">,</span> <span class="n">r</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">barrett_ref</span><span class="o">.</span><span class="n">items</span><span class="p">()</span>
                                 <span class="k">if</span> <span class="n">ref</span> <span class="ow">in</span> <span class="n">references</span> <span class="ow">and</span> <span class="n">a</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">barrett_ref</span><span class="p">[</span><span class="n">ref</span><span class="p">]</span><span class="o">.</span><span class="n">keys</span><span class="p">()]</span>
                <span class="n">i_min</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">argmin</span><span class="p">([</span><span class="n">unc</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="k">for</span> <span class="n">unc</span> <span class="ow">in</span> <span class="n">uncertainties</span><span class="p">]))</span>
                <span class="n">ref_min</span> <span class="o">=</span> <span class="n">uncertainties</span><span class="p">[</span><span class="n">i_min</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span>
                <span class="n">barrett</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">barrett_ref</span><span class="p">[</span><span class="n">ref_min</span><span class="p">][</span><span class="n">a</span><span class="p">])</span>
                <span class="n">ref_barrett</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">ref_min</span><span class="p">)</span>
        <span class="k">elif</span> <span class="n">mode</span> <span class="o">==</span> <span class="s1">&#39;mean&#39;</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">a</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">a</span><span class="p">:</span>
                <span class="n">r</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([[</span><span class="n">r</span><span class="p">[</span><span class="n">a</span><span class="p">][</span><span class="mi">0</span><span class="p">],</span> <span class="n">r</span><span class="p">[</span><span class="n">a</span><span class="p">][</span><span class="mi">1</span><span class="p">]]</span> <span class="k">for</span> <span class="n">ref</span><span class="p">,</span> <span class="n">r</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">barrett_ref</span><span class="o">.</span><span class="n">items</span><span class="p">()</span>
                              <span class="k">if</span> <span class="n">a</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">barrett_ref</span><span class="p">[</span><span class="n">ref</span><span class="p">]</span><span class="o">.</span><span class="n">keys</span><span class="p">()])</span>
                <span class="n">cov</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">expand_dims</span><span class="p">(</span><span class="n">r</span><span class="p">[:,</span> <span class="mi">1</span><span class="p">],</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">expand_dims</span><span class="p">(</span><span class="n">r</span><span class="p">[:,</span> <span class="mi">1</span><span class="p">],</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
                <span class="n">barrett</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="n">average</span><span class="p">(</span><span class="n">r</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">],</span> <span class="n">cov</span><span class="o">=</span><span class="n">cov</span><span class="p">)))</span>
            <span class="n">ref_barrett</span> <span class="o">=</span> <span class="s1">&#39;mean&#39;</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s1">&#39;Mode </span><span class="se">\&#39;</span><span class="si">{}</span><span class="se">\&#39;</span><span class="s1"> is not supported. Choose from </span><span class="si">{}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">mode</span><span class="p">,</span> <span class="n">modes</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">barrett</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">ref_barrett</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">around</span><span class="p">(</span><span class="n">barrett</span><span class="p">,</span> <span class="n">decimals</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">decimals</span><span class="p">),</span> <span class="n">ref_barrett</span></div>
    
<div class="viewcode-block" id="Radii.get_rn"><a class="viewcode-back" href="../../pycol.html#pycol.analyze.Radii.get_rn">[docs]</a>    <span class="k">def</span> <span class="nf">get_rn</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">n</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span> <span class="n">a</span><span class="p">:</span> <span class="n">array_like</span><span class="p">,</span> <span class="n">a_ref</span><span class="p">:</span> <span class="n">array_like</span><span class="p">,</span> <span class="n">delta_barrett</span><span class="p">:</span> <span class="n">array_iter</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
               <span class="n">decimals</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">4</span><span class="p">,</span> <span class="n">rtype</span><span class="p">:</span> <span class="nb">type</span> <span class="o">=</span> <span class="n">ndarray</span><span class="p">,</span> <span class="n">key_format</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="kc">None</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Union</span><span class="p">[</span><span class="n">ndarray</span><span class="p">,</span> <span class="nb">dict</span><span class="p">,</span> <span class="ne">ValueError</span><span class="p">]:</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        :param n: The moment to return. Currently supported moments are [2, 4, 6].</span>
<span class="sd">        :param a: The mass numbers of the moments to return.</span>
<span class="sd">        :param a_ref: The reference mass numbers of the moments to return.</span>
<span class="sd">        :param delta_barrett: The differences of Barrett radii with uncertainties.</span>
<span class="sd">         If specified, it must have shape (len(a), 2) and include the values in the first</span>
<span class="sd">         and the uncertainties in the second column.</span>
<span class="sd">        :param decimals: The number of decimal places to return.</span>
<span class="sd">        :param rtype: The type in which the results will be returned. Currently supported special types are [dict, ].</span>
<span class="sd">         The standard &#39;rtype&#39; is a numpy array.</span>
<span class="sd">        :param key_format: If &#39;rtype&#39; is dict, The key format is used to build the dictionary keys in str format.</span>
<span class="sd">         The mass number is inserted into the first, the reference mass number into the second &#39;{}&#39; bracket.</span>
<span class="sd">         Use numbers {1}(...){0} to change the order of the mass numbers.</span>
<span class="sd">         If None, the mass numbers are used as integer keys.</span>
<span class="sd">        :returns: Differences of the specified moment of nuclear charge radii for different mass</span>
<span class="sd">         and reference mass numbers.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">n</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">n</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">n</span> <span class="ow">not</span> <span class="ow">in</span> <span class="p">[</span><span class="mi">2</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">6</span><span class="p">]:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s1">&#39;n must be in [2, 4, 6] but is </span><span class="si">{}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">n</span><span class="p">))</span>
        <span class="n">a</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="nb">object</span><span class="p">,</span> <span class="nb">list</span><span class="p">,</span> <span class="nb">int</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="nb">int</span><span class="p">)</span><span class="o">.</span><span class="n">tolist</span><span class="p">()</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="nb">int</span><span class="p">):</span>
            <span class="n">a</span> <span class="o">=</span> <span class="p">[</span><span class="n">a</span><span class="p">,</span> <span class="p">]</span>
        <span class="n">a_ref</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="nb">object</span><span class="p">,</span> <span class="nb">list</span><span class="p">,</span> <span class="nb">int</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="n">a_ref</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="nb">int</span><span class="p">)</span><span class="o">.</span><span class="n">tolist</span><span class="p">()</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">a_ref</span><span class="p">,</span> <span class="nb">int</span><span class="p">):</span>
            <span class="n">a_ref</span> <span class="o">=</span> <span class="p">[</span><span class="n">a_ref</span><span class="p">,</span> <span class="p">]</span> <span class="o">*</span> <span class="nb">len</span><span class="p">(</span><span class="n">a</span><span class="p">)</span>
        <span class="n">i</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="bp">self</span><span class="o">.</span><span class="n">a</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="n">a_i</span><span class="p">)</span> <span class="k">for</span> <span class="n">a_i</span> <span class="ow">in</span> <span class="n">a</span><span class="p">])</span>
        <span class="n">i_ref</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="bp">self</span><span class="o">.</span><span class="n">a</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="n">a_i</span><span class="p">)</span> <span class="k">for</span> <span class="n">a_i</span> <span class="ow">in</span> <span class="n">a_ref</span><span class="p">])</span>
        <span class="k">if</span> <span class="n">delta_barrett</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">delta_barrett</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="bp">self</span><span class="o">.</span><span class="n">barrett</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">barrett</span><span class="p">[</span><span class="n">i_ref</span><span class="p">,</span> <span class="mi">0</span><span class="p">],</span>
                                      <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">barrett</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="mi">1</span><span class="p">]</span> <span class="o">**</span> <span class="mi">2</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">barrett</span><span class="p">[</span><span class="n">i_ref</span><span class="p">,</span> <span class="mi">1</span><span class="p">]</span> <span class="o">**</span> <span class="mi">2</span><span class="p">)])</span><span class="o">.</span><span class="n">T</span>
        <span class="n">delta_barrett</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="n">delta_barrett</span><span class="p">)</span>
        <span class="n">rn</span> <span class="o">=</span> <span class="nb">eval</span><span class="p">(</span><span class="s1">&#39;ph.delta_r</span><span class="si">{}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">n</span><span class="p">))(</span><span class="bp">self</span><span class="o">.</span><span class="n">barrett</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="mi">0</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">barrett</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="mi">1</span><span class="p">],</span>
                                            <span class="bp">self</span><span class="o">.</span><span class="n">barrett</span><span class="p">[</span><span class="n">i_ref</span><span class="p">,</span> <span class="mi">0</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">barrett</span><span class="p">[</span><span class="n">i_ref</span><span class="p">,</span> <span class="mi">1</span><span class="p">],</span>
                                            <span class="n">delta_barrett</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">],</span> <span class="n">delta_barrett</span><span class="p">[:,</span> <span class="mi">1</span><span class="p">],</span>
                                            <span class="bp">self</span><span class="o">.</span><span class="n">vn</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="nb">int</span><span class="p">(</span><span class="n">n</span> <span class="o">/</span> <span class="mi">2</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)],</span> <span class="bp">self</span><span class="o">.</span><span class="n">vn</span><span class="p">[</span><span class="n">i_ref</span><span class="p">,</span> <span class="nb">int</span><span class="p">(</span><span class="n">n</span> <span class="o">/</span> <span class="mi">2</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)])</span>
        <span class="n">rn</span> <span class="o">=</span> <span class="p">[[</span><span class="n">np</span><span class="o">.</span><span class="n">around</span><span class="p">(</span><span class="n">rn</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="n">j</span><span class="p">],</span> <span class="n">decimals</span><span class="o">=</span><span class="n">decimals</span><span class="p">),</span> <span class="n">np</span><span class="o">.</span><span class="n">around</span><span class="p">(</span><span class="n">rn</span><span class="p">[</span><span class="mi">1</span><span class="p">][</span><span class="n">j</span><span class="p">],</span> <span class="n">decimals</span><span class="o">=</span><span class="n">decimals</span><span class="p">)]</span>
              <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">rn</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">size</span><span class="p">)]</span>
        <span class="k">if</span> <span class="n">rtype</span> <span class="o">==</span> <span class="nb">dict</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">key_format</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                <span class="k">return</span> <span class="p">{</span><span class="n">a_i</span><span class="p">:</span> <span class="n">r</span> <span class="k">for</span> <span class="n">a_i</span><span class="p">,</span> <span class="n">r</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="n">rn</span><span class="p">)}</span>
            <span class="k">elif</span> <span class="n">key_format</span><span class="o">.</span><span class="n">count</span><span class="p">(</span><span class="s1">&#39;</span><span class="si">{}</span><span class="s1">&#39;</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1</span> <span class="ow">and</span> <span class="n">key_format</span><span class="o">.</span><span class="n">count</span><span class="p">(</span><span class="s1">&#39;{&#39;</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1</span> <span class="ow">and</span> <span class="n">key_format</span><span class="o">.</span><span class="n">count</span><span class="p">(</span><span class="s1">&#39;}&#39;</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
                <span class="k">return</span> <span class="p">{</span><span class="n">key_format</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">a_i</span><span class="p">):</span> <span class="n">r</span> <span class="k">for</span> <span class="n">a_i</span><span class="p">,</span> <span class="n">r</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="n">rn</span><span class="p">)}</span>
            <span class="k">elif</span> <span class="n">key_format</span><span class="o">.</span><span class="n">count</span><span class="p">(</span><span class="s1">&#39;</span><span class="si">{}</span><span class="s1">&#39;</span><span class="p">)</span> <span class="o">==</span> <span class="mi">2</span> <span class="ow">or</span> <span class="p">(</span><span class="s1">&#39;</span><span class="si">{0}</span><span class="s1">&#39;</span> <span class="ow">in</span> <span class="n">key_format</span> <span class="ow">and</span> <span class="s1">&#39;</span><span class="si">{1}</span><span class="s1">&#39;</span> <span class="ow">in</span> <span class="n">key_format</span><span class="p">)</span> \
                    <span class="ow">and</span> <span class="n">key_format</span><span class="o">.</span><span class="n">count</span><span class="p">(</span><span class="s1">&#39;{&#39;</span><span class="p">)</span> <span class="o">==</span> <span class="mi">2</span> <span class="ow">and</span> <span class="n">key_format</span><span class="o">.</span><span class="n">count</span><span class="p">(</span><span class="s1">&#39;}&#39;</span><span class="p">)</span> <span class="o">==</span> <span class="mi">2</span><span class="p">:</span>
                <span class="k">return</span> <span class="p">{</span><span class="n">key_format</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">a_i</span><span class="p">,</span> <span class="n">a_ref_i</span><span class="p">):</span> <span class="n">r</span> <span class="k">for</span> <span class="n">a_i</span><span class="p">,</span> <span class="n">a_ref_i</span><span class="p">,</span> <span class="n">r</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="n">a_ref</span><span class="p">,</span> <span class="n">rn</span><span class="p">)}</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s1">&#39;Specified key_format (</span><span class="si">{}</span><span class="s1">) not supported.&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">key_format</span><span class="p">))</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">rn</span><span class="p">)</span></div>

<div class="viewcode-block" id="Radii.get_lambda"><a class="viewcode-back" href="../../pycol.html#pycol.analyze.Radii.get_lambda">[docs]</a>    <span class="k">def</span> <span class="nf">get_lambda</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">a</span><span class="p">:</span> <span class="n">array_like</span><span class="p">,</span> <span class="n">a_ref</span><span class="p">:</span> <span class="n">array_like</span><span class="p">,</span> <span class="n">delta_barrett</span><span class="p">:</span> <span class="n">array_iter</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
                   <span class="n">decimals</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">4</span><span class="p">,</span> <span class="n">rtype</span><span class="p">:</span> <span class="nb">type</span> <span class="o">=</span> <span class="n">ndarray</span><span class="p">,</span> <span class="n">key_format</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="kc">None</span><span class="p">)</span> \
            <span class="o">-&gt;</span> <span class="n">Union</span><span class="p">[</span><span class="n">ndarray</span><span class="p">,</span> <span class="nb">dict</span><span class="p">,</span> <span class="ne">ValueError</span><span class="p">]:</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        :param a: The mass numbers of the moments to return.</span>
<span class="sd">        :param a_ref: The reference mass numbers of the moments to return.</span>
<span class="sd">        :param delta_barrett: The differences of Barrett radii with uncertainties.</span>
<span class="sd">         If specified, it must have shape (len(a), 2) and include the values in the first</span>
<span class="sd">         and the uncertainties in the second column.</span>
<span class="sd">        :param decimals: The number of decimal places to return.</span>
<span class="sd">        :param rtype: The type in which the results will be returned. Currently supported special types are [dict, ].</span>
<span class="sd">         The standard &#39;rtype&#39; is a numpy array.</span>
<span class="sd">        :param key_format: If &#39;rtype&#39; is dict, The key format is used to build the dictionary keys in str format.</span>
<span class="sd">         The mass number is inserted into the first, the reference mass number into the second &#39;{}&#39; bracket.</span>
<span class="sd">         Use numbers {1}(...){0} to change the order of the mass numbers.</span>
<span class="sd">         If None, the mass numbers are used as integer keys.</span>
<span class="sd">        :returns: The Lambda parameter for different mass and reference mass numbers.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">seltzer</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">return</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s1">&#39;Seltzer coefficients were not specified. &#39;</span>
                              <span class="s1">&#39;Please assign the local variable</span><span class="se">\n</span><span class="s1">self.seltzer = [C2/C1, C3/C1]&#39;</span><span class="p">)</span>
        <span class="n">r2</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_rn</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="n">a</span><span class="p">,</span> <span class="n">a_ref</span><span class="p">,</span> <span class="n">delta_barrett</span><span class="o">=</span><span class="n">delta_barrett</span><span class="p">,</span> <span class="n">decimals</span><span class="o">=</span><span class="n">decimals</span> <span class="o">+</span> <span class="mi">2</span><span class="p">,</span> <span class="n">rtype</span><span class="o">=</span><span class="nb">list</span><span class="p">)</span>
        <span class="n">r4</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_rn</span><span class="p">(</span><span class="mi">4</span><span class="p">,</span> <span class="n">a</span><span class="p">,</span> <span class="n">a_ref</span><span class="p">,</span> <span class="n">delta_barrett</span><span class="o">=</span><span class="n">delta_barrett</span><span class="p">,</span> <span class="n">decimals</span><span class="o">=</span><span class="n">decimals</span> <span class="o">+</span> <span class="mi">2</span><span class="p">,</span> <span class="n">rtype</span><span class="o">=</span><span class="nb">list</span><span class="p">)</span>
        <span class="n">r6</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_rn</span><span class="p">(</span><span class="mi">6</span><span class="p">,</span> <span class="n">a</span><span class="p">,</span> <span class="n">a_ref</span><span class="p">,</span> <span class="n">delta_barrett</span><span class="o">=</span><span class="n">delta_barrett</span><span class="p">,</span> <span class="n">decimals</span><span class="o">=</span><span class="n">decimals</span> <span class="o">+</span> <span class="mi">2</span><span class="p">,</span> <span class="n">rtype</span><span class="o">=</span><span class="nb">list</span><span class="p">)</span>
        <span class="n">ll</span> <span class="o">=</span> <span class="n">ph</span><span class="o">.</span><span class="n">lambda_rn</span><span class="p">(</span><span class="n">r2</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">],</span> <span class="n">r2</span><span class="p">[:,</span> <span class="mi">1</span><span class="p">],</span> <span class="n">r4</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">],</span> <span class="n">r4</span><span class="p">[:,</span> <span class="mi">1</span><span class="p">],</span> <span class="n">r6</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">],</span> <span class="n">r6</span><span class="p">[:,</span> <span class="mi">1</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">seltzer</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">seltzer</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
        <span class="n">ll</span> <span class="o">=</span> <span class="p">[[</span><span class="n">np</span><span class="o">.</span><span class="n">around</span><span class="p">(</span><span class="n">ll</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="n">j</span><span class="p">],</span> <span class="n">decimals</span><span class="o">=</span><span class="n">decimals</span><span class="p">),</span> <span class="n">np</span><span class="o">.</span><span class="n">around</span><span class="p">(</span><span class="n">ll</span><span class="p">[</span><span class="mi">1</span><span class="p">][</span><span class="n">j</span><span class="p">],</span> <span class="n">decimals</span><span class="o">=</span><span class="n">decimals</span><span class="p">)]</span>
              <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">ll</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">size</span><span class="p">)]</span>
        <span class="k">if</span> <span class="n">rtype</span> <span class="o">==</span> <span class="nb">dict</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="n">key_format</span><span class="o">.</span><span class="n">count</span><span class="p">(</span><span class="s1">&#39;</span><span class="si">{}</span><span class="s1">&#39;</span><span class="p">))</span>
            <span class="k">if</span> <span class="n">key_format</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                <span class="k">return</span> <span class="p">{</span><span class="n">a_i</span><span class="p">:</span> <span class="n">r</span> <span class="k">for</span> <span class="n">a_i</span><span class="p">,</span> <span class="n">r</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="n">ll</span><span class="p">)}</span>
            <span class="k">elif</span> <span class="n">key_format</span><span class="o">.</span><span class="n">count</span><span class="p">(</span><span class="s1">&#39;</span><span class="si">{}</span><span class="s1">&#39;</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1</span> <span class="ow">and</span> <span class="n">key_format</span><span class="o">.</span><span class="n">count</span><span class="p">(</span><span class="s1">&#39;{&#39;</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1</span> <span class="ow">and</span> <span class="n">key_format</span><span class="o">.</span><span class="n">count</span><span class="p">(</span><span class="s1">&#39;}&#39;</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
                <span class="k">return</span> <span class="p">{</span><span class="n">key_format</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">a_i</span><span class="p">):</span> <span class="n">r</span> <span class="k">for</span> <span class="n">a_i</span><span class="p">,</span> <span class="n">r</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="n">ll</span><span class="p">)}</span>
            <span class="k">elif</span> <span class="n">key_format</span><span class="o">.</span><span class="n">count</span><span class="p">(</span><span class="s1">&#39;</span><span class="si">{}</span><span class="s1">&#39;</span><span class="p">)</span> <span class="o">==</span> <span class="mi">2</span> <span class="ow">or</span> <span class="p">(</span><span class="s1">&#39;</span><span class="si">{0}</span><span class="s1">&#39;</span> <span class="ow">in</span> <span class="n">key_format</span> <span class="ow">and</span> <span class="s1">&#39;</span><span class="si">{1}</span><span class="s1">&#39;</span> <span class="ow">in</span> <span class="n">key_format</span><span class="p">)</span> \
                    <span class="ow">and</span> <span class="n">key_format</span><span class="o">.</span><span class="n">count</span><span class="p">(</span><span class="s1">&#39;{&#39;</span><span class="p">)</span> <span class="o">==</span> <span class="mi">2</span> <span class="ow">and</span> <span class="n">key_format</span><span class="o">.</span><span class="n">count</span><span class="p">(</span><span class="s1">&#39;}&#39;</span><span class="p">)</span> <span class="o">==</span> <span class="mi">2</span><span class="p">:</span>
                <span class="k">return</span> <span class="p">{</span><span class="n">key_format</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">a_i</span><span class="p">,</span> <span class="n">a_ref_i</span><span class="p">):</span> <span class="n">r</span> <span class="k">for</span> <span class="n">a_i</span><span class="p">,</span> <span class="n">a_ref_i</span><span class="p">,</span> <span class="n">r</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="n">a_ref</span><span class="p">,</span> <span class="n">ll</span><span class="p">)}</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s1">&#39;Specified key_format (</span><span class="si">{}</span><span class="s1">) not supported.&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">key_format</span><span class="p">))</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">ll</span><span class="p">)</span></div></div>


<div class="viewcode-block" id="King"><a class="viewcode-back" href="../../pycol.html#pycol.analyze.King">[docs]</a><span class="k">class</span> <span class="nc">King</span><span class="p">:</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">a</span><span class="p">:</span> <span class="n">array_iter</span><span class="p">,</span> <span class="n">m</span><span class="p">:</span> <span class="n">array_iter</span><span class="p">,</span> <span class="n">x_abs</span><span class="p">:</span> <span class="n">array_iter</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">y_abs</span><span class="p">:</span> <span class="n">array_iter</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
                 <span class="n">subtract_electrons</span><span class="p">:</span> <span class="n">scalar</span> <span class="o">=</span> <span class="mf">0.</span><span class="p">,</span> <span class="n">element_label</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="kc">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        :param a: An Iterable of the mass numbers of the used isotopes.</span>
<span class="sd">        :param m: The masses and their uncertainties of the isotopes &#39;a&#39; (amu). &#39;m&#39; must have shape (len(a), 2).</span>
<span class="sd">        :param x_abs: Absolute values of the x-axis corresponding to the mass numbers a.</span>
<span class="sd">         If given, the &#39;x&#39; parameter can be omitted when fitting (in &#39;fit&#39; and &#39;fit_nd&#39;)</span>
<span class="sd">         and is determined automatically as the difference between the mass numbers &#39;a&#39; and &#39;a_ref&#39;.</span>
<span class="sd">         Must have shape (len(a), 2) or (len(a), n, 2) where n is the number of dimensions of the king plot without &#39;y&#39;.</span>
<span class="sd">        :param y_abs: Absolute values of the x-axis corresponding to the mass numbers a.</span>
<span class="sd">         If given, the &#39;y&#39; parameter can be omitted when fitting (in &#39;fit&#39;)</span>
<span class="sd">         and is determined automatically as the difference between the mass numbers &#39;a&#39; and &#39;a_ref&#39;.</span>
<span class="sd">         Must have shape (len(a), 2).</span>
<span class="sd">        :param subtract_electrons: The number of electron masses</span>
<span class="sd">         that should be subtracted from the specified isotope masses. If the ionization energy must be considered,</span>
<span class="sd">         less electrons can be subtracted. &#39;subtract_electrons&#39; does not have to be an integer.</span>
<span class="sd">        :param element_label: The label of the element to enhance the printed and plotted information.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">fontsize</span> <span class="o">=</span> <span class="mf">12.</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">scale_y</span> <span class="o">=</span> <span class="mf">1e-3</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">n</span> <span class="o">=</span> <span class="mi">1000000</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">subtract_electrons</span> <span class="o">=</span> <span class="n">subtract_electrons</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">element_label</span> <span class="o">=</span> <span class="n">element_label</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">element_label</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">element_label</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">a</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="nb">object</span><span class="p">,</span> <span class="nb">list</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="nb">int</span><span class="p">)</span><span class="o">.</span><span class="n">tolist</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">x_abs</span> <span class="o">=</span> <span class="n">x_abs</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">x_abs</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">x_abs</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="n">x_abs</span><span class="p">)</span>
            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">x_abs</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span> <span class="o">&lt;</span> <span class="mi">3</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">x_abs</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">expand_dims</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">x_abs</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">y_abs</span> <span class="o">=</span> <span class="n">y_abs</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">y_abs</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">y_abs</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="n">y_abs</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">m</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="nb">object</span><span class="p">,</span> <span class="nb">list</span><span class="p">,</span> <span class="n">ndarray</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="n">m</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="nb">float</span><span class="p">)</span><span class="o">.</span><span class="n">tolist</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">m</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([[</span><span class="n">m_i</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">subtract_electrons</span> <span class="o">*</span> <span class="n">ph</span><span class="o">.</span><span class="n">m_e_u</span><span class="p">,</span>
                            <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">m_i</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">**</span> <span class="mi">2</span> <span class="o">+</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">subtract_electrons</span> <span class="o">*</span> <span class="n">ph</span><span class="o">.</span><span class="n">m_e_u_d</span><span class="p">)</span> <span class="o">**</span> <span class="mi">2</span><span class="p">)]</span> <span class="k">for</span> <span class="n">m_i</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">m</span><span class="p">])</span>
        <span class="n">tools</span><span class="o">.</span><span class="n">check_shape</span><span class="p">((</span><span class="nb">len</span><span class="p">(</span><span class="n">a</span><span class="p">),</span> <span class="mi">2</span><span class="p">),</span> <span class="bp">self</span><span class="o">.</span><span class="n">m</span><span class="p">,</span> <span class="n">allow_scalar</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">m_mod</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([[</span><span class="nb">list</span><span class="p">(</span><span class="n">ph</span><span class="o">.</span><span class="n">mass_factor</span><span class="p">(</span><span class="n">_m</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">_m_ref</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">m_d</span><span class="o">=</span><span class="n">_m</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">m_ref_d</span><span class="o">=</span><span class="n">_m_ref</span><span class="p">[</span><span class="mi">1</span><span class="p">]))</span>
                                <span class="k">if</span> <span class="n">_i</span> <span class="o">!=</span> <span class="n">_j</span> <span class="k">else</span> <span class="p">[</span><span class="mf">0.</span><span class="p">,</span> <span class="mf">0.</span><span class="p">]</span>
                                <span class="k">for</span> <span class="n">_j</span><span class="p">,</span> <span class="n">_m</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">m</span><span class="p">)]</span> <span class="k">for</span> <span class="n">_i</span><span class="p">,</span> <span class="n">_m_ref</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">m</span><span class="p">)])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">m_sample</span> <span class="o">=</span> <span class="kc">None</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">a_fit</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">a_ref</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">x</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">y</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">x_mod</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">y_mod</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">corr</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">results</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="kc">None</span><span class="p">,</span> <span class="nb">tuple</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">x_nd</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">x_nd_mod</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">cov</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">results_nd</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="kc">None</span><span class="p">,</span> <span class="nb">tuple</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">x_results</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="kc">None</span><span class="p">,</span> <span class="nb">tuple</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">axis</span> <span class="o">=</span> <span class="mi">0</span>

    <span class="k">def</span> <span class="nf">_correlation</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        :returns: None. Sets the correlation coefficients of the modified x- and y-data points by sampling the data.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">i</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="bp">self</span><span class="o">.</span><span class="n">a</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="n">a_i</span><span class="p">)</span> <span class="k">for</span> <span class="n">a_i</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">a_fit</span><span class="p">])</span>
        <span class="n">i_ref</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="bp">self</span><span class="o">.</span><span class="n">a</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="n">a_i</span><span class="p">)</span> <span class="k">for</span> <span class="n">a_i</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">a_ref</span><span class="p">])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">m_sample</span> <span class="o">=</span> <span class="n">st</span><span class="o">.</span><span class="n">norm</span><span class="o">.</span><span class="n">rvs</span><span class="p">(</span><span class="n">loc</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">m</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">],</span> <span class="n">scale</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">m</span><span class="p">[:,</span> <span class="mi">1</span><span class="p">],</span> <span class="n">size</span><span class="o">=</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">n</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">m</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]))</span><span class="o">.</span><span class="n">T</span>
        <span class="n">x</span> <span class="o">=</span> <span class="n">st</span><span class="o">.</span><span class="n">norm</span><span class="o">.</span><span class="n">rvs</span><span class="p">(</span><span class="n">loc</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">x</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">],</span> <span class="n">scale</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">x</span><span class="p">[:,</span> <span class="mi">1</span><span class="p">],</span> <span class="n">size</span><span class="o">=</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">n</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">x</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]))</span><span class="o">.</span><span class="n">T</span>
        <span class="n">y</span> <span class="o">=</span> <span class="n">st</span><span class="o">.</span><span class="n">norm</span><span class="o">.</span><span class="n">rvs</span><span class="p">(</span><span class="n">loc</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">y</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">],</span> <span class="n">scale</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">y</span><span class="p">[:,</span> <span class="mi">1</span><span class="p">],</span> <span class="n">size</span><span class="o">=</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">n</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">y</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]))</span><span class="o">.</span><span class="n">T</span>
        <span class="n">m_mod_sample</span> <span class="o">=</span> <span class="n">ph</span><span class="o">.</span><span class="n">mass_factor</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">m_sample</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">m_sample</span><span class="p">[</span><span class="n">i_ref</span><span class="p">])[</span><span class="mi">0</span><span class="p">]</span>
        <span class="n">x_mod</span> <span class="o">=</span> <span class="n">m_mod_sample</span> <span class="o">*</span> <span class="n">x</span>
        <span class="n">y_mod</span> <span class="o">=</span> <span class="n">m_mod_sample</span> <span class="o">*</span> <span class="n">y</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">corr</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">diag</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">corrcoef</span><span class="p">(</span><span class="n">x_mod</span><span class="p">,</span> <span class="n">y_mod</span><span class="p">)[:</span><span class="n">x_mod</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">x_mod</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]:])</span>

    <span class="k">def</span> <span class="nf">_correlation_nd</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        :returns: None. Sets the correlation coefficients of the modified data by sampling it.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">i</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="bp">self</span><span class="o">.</span><span class="n">a</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="n">a_i</span><span class="p">)</span> <span class="k">for</span> <span class="n">a_i</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">a_fit</span><span class="p">])</span>
        <span class="n">i_ref</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="bp">self</span><span class="o">.</span><span class="n">a</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="n">a_i</span><span class="p">)</span> <span class="k">for</span> <span class="n">a_i</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">a_ref</span><span class="p">])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">m_sample</span> <span class="o">=</span> <span class="n">st</span><span class="o">.</span><span class="n">norm</span><span class="o">.</span><span class="n">rvs</span><span class="p">(</span><span class="n">loc</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">m</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">],</span> <span class="n">scale</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">m</span><span class="p">[:,</span> <span class="mi">1</span><span class="p">],</span> <span class="n">size</span><span class="o">=</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">n</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">m</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]))</span><span class="o">.</span><span class="n">T</span>
        <span class="n">x_nd</span> <span class="o">=</span> <span class="n">st</span><span class="o">.</span><span class="n">norm</span><span class="o">.</span><span class="n">rvs</span><span class="p">(</span><span class="n">loc</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">x_nd</span><span class="p">[:,</span> <span class="p">:,</span> <span class="mi">0</span><span class="p">],</span> <span class="n">scale</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">x_nd</span><span class="p">[:,</span> <span class="p">:,</span> <span class="mi">1</span><span class="p">],</span>
                           <span class="n">size</span><span class="o">=</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">n</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">x_nd</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">x_nd</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">]))</span>
        <span class="n">x_nd</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">transpose</span><span class="p">(</span><span class="n">x_nd</span><span class="p">,</span> <span class="n">axes</span><span class="o">=</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">0</span><span class="p">])</span>
        <span class="n">m_mod_sample</span> <span class="o">=</span> <span class="n">ph</span><span class="o">.</span><span class="n">mass_factor</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">m_sample</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">m_sample</span><span class="p">[</span><span class="n">i_ref</span><span class="p">])[</span><span class="mi">0</span><span class="p">]</span>
        <span class="n">x_mod</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">expand_dims</span><span class="p">(</span><span class="n">m_mod_sample</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span> <span class="o">*</span> <span class="n">x_nd</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">cov</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">np</span><span class="o">.</span><span class="n">cov</span><span class="p">(</span><span class="n">x_mod_i</span><span class="p">)</span> <span class="k">for</span> <span class="n">x_mod_i</span> <span class="ow">in</span> <span class="n">x_mod</span><span class="p">])</span>

<div class="viewcode-block" id="King.fit"><a class="viewcode-back" href="../../pycol.html#pycol.analyze.King.fit">[docs]</a>    <span class="k">def</span> <span class="nf">fit</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">a</span><span class="p">:</span> <span class="n">array_iter</span><span class="p">,</span> <span class="n">a_ref</span><span class="p">:</span> <span class="n">array_iter</span><span class="p">,</span> <span class="n">x</span><span class="p">:</span> <span class="n">array_iter</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">y</span><span class="p">:</span> <span class="n">array_iter</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
            <span class="n">func</span><span class="p">:</span> <span class="n">Callable</span> <span class="o">=</span> <span class="n">york</span><span class="p">,</span> <span class="n">alpha</span><span class="p">:</span> <span class="n">scalar</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span> <span class="n">find_alpha</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span> <span class="n">axis</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span>
            <span class="n">show</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        :param a: An Iterable of the mass numbers of the used isotopes.</span>
<span class="sd">        :param a_ref: An Iterable of the mass numbers of the used reference isotopes.</span>
<span class="sd">        :param x: The x-values and their uncertainties of the King-fit to be performed. If &#39;mode&#39; is &quot;radii&quot;,</span>
<span class="sd">         this must contain the differences of mean square nuclear charge radii or the Lambda-factor.</span>
<span class="sd">         &#39;x&#39; must have shape (len(a), 2). Units: (fm^2) or (MHz).</span>
<span class="sd">        :param y: The isotope shifts and their uncertainties of the King-fit to be performed.</span>
<span class="sd">         &#39;y&#39; must have shape (len(a), 2). If None, &#39;y&#39; is tried to be inherited from &#39;self.f&#39;. Units: (MHz).</span>
<span class="sd">        :param func: The fitting routine.</span>
<span class="sd">        :param alpha: An x-axis offset to reduce the correlation coefficient between the y-intercept and the slope.</span>
<span class="sd">         Unit: (u fm ** 2) or (u MHz).</span>
<span class="sd">        :param find_alpha: Whether to search for the best &#39;alpha&#39;. Uses the given &#39;alpha&#39; as a starting point.</span>
<span class="sd">         May not give the desired result if &#39;alpha&#39; was initialized to far from its optimal value.</span>
<span class="sd">        :param axis: The axis to use if &#39;x_abs&#39; was specified and is multidimensional.</span>
<span class="sd">        :param show: Whether to plot the fit result.</span>
<span class="sd">        :param kwargs: Additional keyword arguments are passed to &#39;self.plot&#39;.</span>
<span class="sd">        :returns: A list of results as defined by the routine &#39;linear_alpha&#39;:</span>
<span class="sd">         a, b, sigma_a, sigma_b, corr_ab, alpha. The best y-intercept and slope,</span>
<span class="sd">         their respective 1-sigma uncertainties, their correlation coefficient and the used alpha.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">a_fit</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">a_ref</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="n">a</span><span class="p">),</span> <span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="n">a_ref</span><span class="p">)</span>
        <span class="n">i</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="bp">self</span><span class="o">.</span><span class="n">a</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="n">a_i</span><span class="p">)</span> <span class="k">for</span> <span class="n">a_i</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">a_fit</span><span class="p">])</span>
        <span class="n">i_ref</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="bp">self</span><span class="o">.</span><span class="n">a</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="n">a_i</span><span class="p">)</span> <span class="k">for</span> <span class="n">a_i</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">a_ref</span><span class="p">])</span>
        <span class="k">if</span> <span class="n">x</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">x</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="bp">self</span><span class="o">.</span><span class="n">a_fit</span><span class="o">.</span><span class="n">size</span><span class="p">,</span> <span class="mi">2</span><span class="p">),</span> <span class="n">dtype</span><span class="o">=</span><span class="nb">float</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">x</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">x_abs</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="n">axis</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">x_abs</span><span class="p">[</span><span class="n">i_ref</span><span class="p">,</span> <span class="n">axis</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">x</span><span class="p">[:,</span> <span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">x_abs</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="n">axis</span><span class="p">,</span> <span class="mi">1</span><span class="p">]</span> <span class="o">**</span> <span class="mi">2</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">x_abs</span><span class="p">[</span><span class="n">i_ref</span><span class="p">,</span> <span class="n">axis</span><span class="p">,</span> <span class="mi">1</span><span class="p">]</span> <span class="o">**</span> <span class="mi">2</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">x</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">y</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">y</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="bp">self</span><span class="o">.</span><span class="n">a_fit</span><span class="o">.</span><span class="n">size</span><span class="p">,</span> <span class="mi">2</span><span class="p">),</span> <span class="n">dtype</span><span class="o">=</span><span class="nb">float</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">y</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">y_abs</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">y_abs</span><span class="p">[</span><span class="n">i_ref</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">y</span><span class="p">[:,</span> <span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">y_abs</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="mi">1</span><span class="p">]</span> <span class="o">**</span> <span class="mi">2</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">y_abs</span><span class="p">[</span><span class="n">i_ref</span><span class="p">,</span> <span class="mi">1</span><span class="p">]</span> <span class="o">**</span> <span class="mi">2</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">y</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="n">y</span><span class="p">)</span>
        <span class="n">m_mod</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">m_mod</span><span class="p">[</span><span class="n">i_ref</span><span class="p">,</span> <span class="n">i</span><span class="p">,</span> <span class="p">:]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">x_mod</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="bp">self</span><span class="o">.</span><span class="n">x</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">]</span> <span class="o">*</span> <span class="n">m_mod</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">],</span>
                               <span class="n">straight_x_std</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">x</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">],</span> <span class="n">m_mod</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">x</span><span class="p">[:,</span> <span class="mi">1</span><span class="p">],</span> <span class="mf">0.</span><span class="p">,</span> <span class="n">m_mod</span><span class="p">[:,</span> <span class="mi">1</span><span class="p">],</span> <span class="mf">0.</span><span class="p">)])</span><span class="o">.</span><span class="n">T</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">y_mod</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="bp">self</span><span class="o">.</span><span class="n">y</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">]</span> <span class="o">*</span> <span class="n">m_mod</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">],</span>
                               <span class="n">straight_x_std</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">y</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">],</span> <span class="n">m_mod</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">y</span><span class="p">[:,</span> <span class="mi">1</span><span class="p">],</span> <span class="mf">0.</span><span class="p">,</span> <span class="n">m_mod</span><span class="p">[:,</span> <span class="mi">1</span><span class="p">],</span> <span class="mf">0.</span><span class="p">)])</span><span class="o">.</span><span class="n">T</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_correlation</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">results</span> <span class="o">=</span> <span class="n">linear_alpha</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">x_mod</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">y_mod</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">],</span>
                                    <span class="n">sigma_x</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">x_mod</span><span class="p">[:,</span> <span class="mi">1</span><span class="p">],</span> <span class="n">sigma_y</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">y_mod</span><span class="p">[:,</span> <span class="mi">1</span><span class="p">],</span>
                                    <span class="n">corr</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">corr</span><span class="p">,</span> <span class="n">func</span><span class="o">=</span><span class="n">func</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="n">alpha</span><span class="p">,</span> <span class="n">find_alpha</span><span class="o">=</span><span class="n">find_alpha</span><span class="p">,</span> <span class="n">show</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">show</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">results</span></div>

<div class="viewcode-block" id="King.fit_nd"><a class="viewcode-back" href="../../pycol.html#pycol.analyze.King.fit_nd">[docs]</a>    <span class="k">def</span> <span class="nf">fit_nd</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">a</span><span class="p">:</span> <span class="n">array_iter</span><span class="p">,</span> <span class="n">a_ref</span><span class="p">:</span> <span class="n">array_iter</span><span class="p">,</span> <span class="n">x</span><span class="p">:</span> <span class="n">array_iter</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
               <span class="n">axis</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span> <span class="n">show</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        :param a: An Iterable of the mass numbers of the used isotopes.</span>
<span class="sd">        :param a_ref: An Iterable of the mass numbers of the used reference isotopes.</span>
<span class="sd">        :param x: The x data. &#39;x&#39; is an iterable of vectors with uncertainties with arbitrary but fixed dimension n_vec.</span>
<span class="sd">         For a set of n_data data points, the shape of x must be (n_data, n_vec, 2).</span>
<span class="sd">        :param axis: The axis to use for the parametrization. For example, a King plot with the isotope shifts</span>
<span class="sd">         of two transitions [&#39;D1&#39;, &#39;D2&#39;], yields the slope F_D2 / F_D1 if &#39;axis&#39; == 0.</span>
<span class="sd">        :param show: Whether to plot the fit result.</span>
<span class="sd">        :param kwargs: Additional keyword arguments are passed to &#39;self.plot_nd&#39;.</span>
<span class="sd">        :returns: A list of results as defined by the routine &#39;linear_alpha&#39;:</span>
<span class="sd">         a, b, sigma_a, sigma_b, corr_ab, (alpha). The best y-intercept and slope,</span>
<span class="sd">         their respective 1-sigma uncertainties, their correlation coefficient( and the used alpha).</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">axis</span> <span class="o">=</span> <span class="n">axis</span>
        <span class="k">if</span> <span class="n">axis</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">axis</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="k">if</span> <span class="n">axis</span> <span class="o">==</span> <span class="o">-</span><span class="mi">1</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">axis</span> <span class="o">=</span> <span class="n">x</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="mi">1</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">a_fit</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">a_ref</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="n">a</span><span class="p">),</span> <span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="n">a_ref</span><span class="p">)</span>
        <span class="n">i</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="bp">self</span><span class="o">.</span><span class="n">a</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="n">a_i</span><span class="p">)</span> <span class="k">for</span> <span class="n">a_i</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">a_fit</span><span class="p">])</span>
        <span class="n">i_ref</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="bp">self</span><span class="o">.</span><span class="n">a</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="n">a_i</span><span class="p">)</span> <span class="k">for</span> <span class="n">a_i</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">a_ref</span><span class="p">])</span>
        <span class="k">if</span> <span class="n">x</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">x_nd</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="bp">self</span><span class="o">.</span><span class="n">a_fit</span><span class="o">.</span><span class="n">size</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">x_abs</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="mi">2</span><span class="p">),</span> <span class="n">dtype</span><span class="o">=</span><span class="nb">float</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">x_nd</span><span class="p">[:,</span> <span class="p">:,</span> <span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">x_abs</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="p">:,</span> <span class="mi">0</span><span class="p">]</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">x_abs</span><span class="p">[</span><span class="n">i_ref</span><span class="p">,</span> <span class="p">:,</span> <span class="mi">0</span><span class="p">]</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">x_nd</span><span class="p">[:,</span> <span class="p">:,</span> <span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">x_abs</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="p">:,</span> <span class="mi">1</span><span class="p">]</span> <span class="o">**</span> <span class="mi">2</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">x_abs</span><span class="p">[</span><span class="n">i_ref</span><span class="p">,</span> <span class="p">:,</span> <span class="mi">1</span><span class="p">]</span> <span class="o">**</span> <span class="mi">2</span><span class="p">)</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">y_abs</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">y_nd</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="bp">self</span><span class="o">.</span><span class="n">a_fit</span><span class="o">.</span><span class="n">size</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">),</span> <span class="n">dtype</span><span class="o">=</span><span class="nb">float</span><span class="p">)</span>
                <span class="n">y_nd</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">y_abs</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">y_abs</span><span class="p">[</span><span class="n">i_ref</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span>
                <span class="n">y_nd</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">y_abs</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="mi">1</span><span class="p">]</span> <span class="o">**</span> <span class="mi">2</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">y_abs</span><span class="p">[</span><span class="n">i_ref</span><span class="p">,</span> <span class="mi">1</span><span class="p">]</span> <span class="o">**</span> <span class="mi">2</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">x_nd</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">concatenate</span><span class="p">((</span><span class="bp">self</span><span class="o">.</span><span class="n">x_nd</span><span class="p">,</span> <span class="n">y_nd</span><span class="p">),</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">x_nd</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
        <span class="n">m_mod</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">expand_dims</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">m_mod</span><span class="p">[</span><span class="n">i_ref</span><span class="p">,</span> <span class="n">i</span><span class="p">,</span> <span class="mi">0</span><span class="p">],</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">x_nd_mod</span> <span class="o">=</span> <span class="n">m_mod</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">x_nd</span><span class="p">[:,</span> <span class="p">:,</span> <span class="mi">0</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_correlation_nd</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">results_nd</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">x_results</span> <span class="o">=</span> <span class="n">linear_monte_carlo_nd</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">x_nd_mod</span><span class="p">,</span> <span class="n">cov</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">cov</span><span class="p">,</span>
                                                                <span class="n">p_axis</span><span class="o">=</span><span class="n">axis</span><span class="p">,</span> <span class="n">full_output</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">show</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
        <span class="c1"># plt.plot(self.x_results[0][self.x_results[1], :, 0], self.x_results[1][self.x_results[1], :, 1], &#39;.&#39;)</span>
        <span class="c1"># plt.show()</span>
        <span class="k">if</span> <span class="n">show</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">plot_nd</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">axis</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">results_nd</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">x_results</span></div>

<div class="viewcode-block" id="King.get_fk"><a class="viewcode-back" href="../../pycol.html#pycol.analyze.King.get_fk">[docs]</a>    <span class="k">def</span> <span class="nf">get_fk</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="p">(</span><span class="n">ndarray</span><span class="p">,</span> <span class="n">ndarray</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        :returns: The slope, y-intercept of the performed fit and their correlation,</span>
<span class="sd">         if alpha was zero (Only changes the y-intercept).</span>
<span class="sd">         This returns the field-shift and mass-shift factors F and K if the x-axis are radii</span>
<span class="sd">         and the field-shift ratio Fy/Fx and the y-intercept Ky - Fy/Fx * Kx if the x-axis are isotope shifts.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">results</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;There are no results yet. Please use one of the fitting options.&#39;</span><span class="p">)</span>
            <span class="k">return</span> <span class="kc">None</span><span class="p">,</span> <span class="kc">None</span>
        <span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">,</span> <span class="n">sigma_a</span><span class="p">,</span> <span class="n">sigma_b</span><span class="p">,</span> <span class="n">corr</span><span class="p">,</span> <span class="n">alpha</span><span class="p">)</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">results</span>
        <span class="n">f</span> <span class="o">=</span> <span class="p">[</span><span class="n">b</span><span class="p">,</span> <span class="n">sigma_b</span><span class="p">]</span>
        <span class="n">k</span> <span class="o">=</span> <span class="p">[</span><span class="n">a</span> <span class="o">-</span> <span class="n">b</span> <span class="o">*</span> <span class="n">alpha</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">sigma_a</span> <span class="o">**</span> <span class="mi">2</span> <span class="o">+</span> <span class="p">(</span><span class="n">alpha</span> <span class="o">*</span> <span class="n">sigma_b</span><span class="p">)</span> <span class="o">**</span> <span class="mi">2</span><span class="p">)]</span>
        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">f</span><span class="se">\t</span><span class="si">{}</span><span class="se">\t</span><span class="si">{}</span><span class="se">\n</span><span class="s1">k</span><span class="se">\t</span><span class="si">{}</span><span class="se">\t</span><span class="si">{}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="o">*</span><span class="n">f</span><span class="p">,</span> <span class="o">*</span><span class="n">k</span><span class="p">))</span>
        <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">f</span><span class="p">),</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">k</span><span class="p">),</span> <span class="n">corr</span></div>

<div class="viewcode-block" id="King.get_fk_nd"><a class="viewcode-back" href="../../pycol.html#pycol.analyze.King.get_fk_nd">[docs]</a>    <span class="k">def</span> <span class="nf">get_fk_nd</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="p">(</span><span class="n">ndarray</span><span class="p">,</span> <span class="n">ndarray</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        :returns: The slopes and y-intercepts of the performed fit.</span>
<span class="sd">         This returns the field-shift and mass-shift factors F and K if the x-axis are radii</span>
<span class="sd">         and the field-shift ratio Fy/Fx and the y-intercept Ky - Fy/Fx * Kx if the x-axis are isotope shifts.</span>
<span class="sd">         The returned arrays f and k have shape (n, 2) were n is number of dimensions of the King-fit.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">results_nd</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;There are no results yet. Please use one of the fitting options.&#39;</span><span class="p">)</span>
            <span class="k">return</span> <span class="kc">None</span><span class="p">,</span> <span class="kc">None</span>
        <span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">,</span> <span class="n">sigma_a</span><span class="p">,</span> <span class="n">sigma_b</span><span class="p">,</span> <span class="n">corr</span><span class="p">)</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">results_nd</span>
        <span class="n">f</span> <span class="o">=</span> <span class="p">[</span><span class="n">b</span><span class="p">,</span> <span class="n">sigma_b</span><span class="p">]</span>
        <span class="n">k</span> <span class="o">=</span> <span class="p">[</span><span class="n">a</span><span class="p">,</span> <span class="n">sigma_a</span><span class="p">]</span>
        <span class="n">r</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">diag</span><span class="p">(</span><span class="n">corr</span><span class="p">[</span><span class="n">a</span><span class="o">.</span><span class="n">size</span><span class="p">:,</span> <span class="p">:</span><span class="n">a</span><span class="o">.</span><span class="n">size</span><span class="p">])</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">b</span><span class="o">.</span><span class="n">size</span><span class="p">):</span>
            <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">f</span><span class="se">\t</span><span class="si">{}</span><span class="se">\t</span><span class="si">{}</span><span class="se">\n</span><span class="s1">k</span><span class="se">\t</span><span class="si">{}</span><span class="se">\t</span><span class="si">{}</span><span class="se">\n</span><span class="s1">corr</span><span class="se">\t</span><span class="si">{}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">f</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="n">i</span><span class="p">],</span> <span class="n">f</span><span class="p">[</span><span class="mi">1</span><span class="p">][</span><span class="n">i</span><span class="p">],</span> <span class="n">k</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="n">i</span><span class="p">],</span> <span class="n">k</span><span class="p">[</span><span class="mi">1</span><span class="p">][</span><span class="n">i</span><span class="p">],</span> <span class="n">r</span><span class="p">[</span><span class="n">i</span><span class="p">]))</span>
        <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">f</span><span class="p">)</span><span class="o">.</span><span class="n">T</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">k</span><span class="p">)</span><span class="o">.</span><span class="n">T</span><span class="p">,</span> <span class="n">r</span></div>

<div class="viewcode-block" id="King.get_unmodified_x"><a class="viewcode-back" href="../../pycol.html#pycol.analyze.King.get_unmodified_x">[docs]</a>    <span class="k">def</span> <span class="nf">get_unmodified_x</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">a</span><span class="p">:</span> <span class="n">array_iter</span><span class="p">,</span> <span class="n">a_ref</span><span class="p">:</span> <span class="n">array_iter</span><span class="p">,</span> <span class="n">y</span><span class="p">:</span> <span class="n">array_iter</span><span class="p">,</span> <span class="n">results</span><span class="p">:</span> <span class="nb">tuple</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
                         <span class="n">show</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Union</span><span class="p">[</span><span class="n">ndarray</span><span class="p">,</span> <span class="kc">None</span><span class="p">]:</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        :param a: An Iterable of mass numbers corresponding to the isotopes of the given &#39;y&#39; values.</span>
<span class="sd">        :param a_ref: An Iterable of mass numbers corresponding to reference isotopes of the given &#39;y&#39; values.</span>
<span class="sd">        :param y: The unmodified y values of the given mass numbers. Must have shape (len(a), 2).</span>
<span class="sd">        :param results: The results of a King plot. Must be a tuple</span>
<span class="sd">         of the shape (a, b, sigma_a, sigma_b, corr_ab, alpha), compare the module-level method &#39;linear_alpha&#39;.</span>
<span class="sd">         If None, the results are derived from &#39;self.results&#39;.</span>
<span class="sd">        :param show: Whether to draw the King plot with the specified values.</span>
<span class="sd">        :param kwargs: Additional keyword arguments are passed to &#39;self.plot&#39;.</span>
<span class="sd">        :returns: The unmodified x values calculated with the fit results and the given &#39;y&#39; values.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">results</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">results</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;There are no results yet. Please use one of the fitting options.&#39;</span><span class="p">)</span>
            <span class="k">return</span>
        <span class="k">if</span> <span class="n">results</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="p">(</span><span class="n">_a</span><span class="p">,</span> <span class="n">b</span><span class="p">,</span> <span class="n">sigma_a</span><span class="p">,</span> <span class="n">sigma_b</span><span class="p">,</span> <span class="n">corr</span><span class="p">,</span> <span class="n">alpha</span><span class="p">)</span> <span class="o">=</span> <span class="n">results</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="p">(</span><span class="n">_a</span><span class="p">,</span> <span class="n">b</span><span class="p">,</span> <span class="n">sigma_a</span><span class="p">,</span> <span class="n">sigma_b</span><span class="p">,</span> <span class="n">corr</span><span class="p">,</span> <span class="n">alpha</span><span class="p">)</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">results</span>
        <span class="n">a</span><span class="p">,</span> <span class="n">a_ref</span><span class="p">,</span> <span class="n">y</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="n">a</span><span class="p">),</span> <span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="n">a_ref</span><span class="p">),</span> <span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="n">y</span><span class="p">)</span>
        <span class="n">i</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="bp">self</span><span class="o">.</span><span class="n">a</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="n">a_i</span><span class="p">)</span> <span class="k">for</span> <span class="n">a_i</span> <span class="ow">in</span> <span class="n">a</span><span class="p">])</span>
        <span class="n">i_ref</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="bp">self</span><span class="o">.</span><span class="n">a</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="n">a_i</span><span class="p">)</span> <span class="k">for</span> <span class="n">a_i</span> <span class="ow">in</span> <span class="n">a_ref</span><span class="p">])</span>
        <span class="n">m_mod</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">m_mod</span><span class="p">[</span><span class="n">i_ref</span><span class="p">,</span> <span class="n">i</span><span class="p">,</span> <span class="p">:]</span>
        <span class="n">y_mod</span> <span class="o">=</span> <span class="n">y</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">]</span> <span class="o">*</span> <span class="n">m_mod</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">]</span>
        <span class="n">y_mod_d</span> <span class="o">=</span> <span class="n">y</span><span class="p">[:,</span> <span class="mi">1</span><span class="p">]</span> <span class="o">*</span> <span class="n">m_mod</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">]</span>
        <span class="n">x_mod</span> <span class="o">=</span> <span class="n">straight</span><span class="p">(</span><span class="n">y_mod</span><span class="p">,</span> <span class="o">-</span><span class="n">_a</span> <span class="o">/</span> <span class="n">b</span><span class="p">,</span> <span class="mf">1.</span> <span class="o">/</span> <span class="n">b</span><span class="p">)</span> <span class="o">+</span> <span class="n">alpha</span>
        <span class="n">x_mod_d</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">((</span><span class="n">y_mod_d</span> <span class="o">/</span> <span class="n">b</span><span class="p">)</span> <span class="o">**</span> <span class="mi">2</span> <span class="o">+</span> <span class="p">(</span><span class="n">sigma_a</span> <span class="o">/</span> <span class="n">b</span><span class="p">)</span> <span class="o">**</span> <span class="mi">2</span> <span class="o">+</span> <span class="p">(</span><span class="n">sigma_b</span> <span class="o">*</span> <span class="p">(</span><span class="n">x_mod</span> <span class="o">-</span> <span class="n">alpha</span><span class="p">)</span> <span class="o">/</span> <span class="n">b</span><span class="p">)</span> <span class="o">**</span> <span class="mi">2</span>
                          <span class="o">+</span> <span class="mf">2.</span> <span class="o">*</span> <span class="p">(</span><span class="n">x_mod</span> <span class="o">-</span> <span class="n">alpha</span><span class="p">)</span> <span class="o">/</span> <span class="p">(</span><span class="n">b</span> <span class="o">**</span> <span class="mi">2</span><span class="p">)</span> <span class="o">*</span> <span class="n">sigma_a</span> <span class="o">*</span> <span class="n">sigma_b</span> <span class="o">*</span> <span class="n">corr</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">show</span><span class="p">:</span>
            <span class="n">add_xy</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">x_mod</span><span class="p">,</span> <span class="n">x_mod_d</span><span class="p">,</span> <span class="n">y_mod</span><span class="p">,</span> <span class="n">y_mod_d</span><span class="p">])</span><span class="o">.</span><span class="n">T</span>
            <span class="n">add_a</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">a</span><span class="p">,</span> <span class="n">a_ref</span><span class="p">])</span><span class="o">.</span><span class="n">T</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">add_xy</span><span class="o">=</span><span class="n">add_xy</span><span class="p">,</span> <span class="n">add_a</span><span class="o">=</span><span class="n">add_a</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">x_mod</span> <span class="o">/</span> <span class="n">m_mod</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">],</span> <span class="n">x_mod_d</span> <span class="o">/</span> <span class="n">m_mod</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">]])</span><span class="o">.</span><span class="n">T</span></div>

<div class="viewcode-block" id="King.get_unmodified_y"><a class="viewcode-back" href="../../pycol.html#pycol.analyze.King.get_unmodified_y">[docs]</a>    <span class="k">def</span> <span class="nf">get_unmodified_y</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">a</span><span class="p">:</span> <span class="n">array_iter</span><span class="p">,</span> <span class="n">a_ref</span><span class="p">:</span> <span class="n">array_iter</span><span class="p">,</span> <span class="n">x</span><span class="p">:</span> <span class="n">array_iter</span><span class="p">,</span> <span class="n">results</span><span class="p">:</span> <span class="nb">tuple</span> <span class="o">=</span> <span class="kc">None</span><span class="p">)</span> \
            <span class="o">-&gt;</span> <span class="n">Union</span><span class="p">[</span><span class="n">ndarray</span><span class="p">,</span> <span class="kc">None</span><span class="p">]:</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        :param a: An Iterable of mass numbers corresponding to the isotopes of the given &#39;x&#39; values.</span>
<span class="sd">        :param a_ref: An Iterable of mass numbers corresponding to reference isotopes of the given &#39;x&#39; values.</span>
<span class="sd">        :param x: The unmodified x values of the given mass numbers. Must have shape (len(a), 2).</span>
<span class="sd">        :param results: The results of a King plot. Must be a tuple</span>
<span class="sd">         of the shape (a, b, sigma_a, sigma_b, corr_ab, alpha), compare the module-level method &#39;linear_alpha&#39;.</span>
<span class="sd">         If None, the results are derived from &#39;self.results&#39;.</span>
<span class="sd">        :returns: The unmodified y values calculated with the fit results and the given &#39;x&#39; values.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">results</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">results</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;There are no results yet. Please use one of the fitting options.&#39;</span><span class="p">)</span>
            <span class="k">return</span>
        <span class="k">if</span> <span class="n">results</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="p">(</span><span class="n">_a</span><span class="p">,</span> <span class="n">b</span><span class="p">,</span> <span class="n">sigma_a</span><span class="p">,</span> <span class="n">sigma_b</span><span class="p">,</span> <span class="n">corr</span><span class="p">,</span> <span class="n">alpha</span><span class="p">)</span> <span class="o">=</span> <span class="n">results</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="p">(</span><span class="n">_a</span><span class="p">,</span> <span class="n">b</span><span class="p">,</span> <span class="n">sigma_a</span><span class="p">,</span> <span class="n">sigma_b</span><span class="p">,</span> <span class="n">corr</span><span class="p">,</span> <span class="n">alpha</span><span class="p">)</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">results</span>
        <span class="n">a</span><span class="p">,</span> <span class="n">a_ref</span><span class="p">,</span> <span class="n">x</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="n">a</span><span class="p">),</span> <span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="n">a_ref</span><span class="p">),</span> <span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
        <span class="n">i</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="bp">self</span><span class="o">.</span><span class="n">a</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="n">a_i</span><span class="p">)</span> <span class="k">for</span> <span class="n">a_i</span> <span class="ow">in</span> <span class="n">a</span><span class="p">])</span>
        <span class="n">i_ref</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="bp">self</span><span class="o">.</span><span class="n">a</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="n">a_i</span><span class="p">)</span> <span class="k">for</span> <span class="n">a_i</span> <span class="ow">in</span> <span class="n">a_ref</span><span class="p">])</span>
        <span class="n">m_mod</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">m_mod</span><span class="p">[</span><span class="n">i_ref</span><span class="p">,</span> <span class="n">i</span><span class="p">,</span> <span class="p">:]</span>
        <span class="n">x_mod</span> <span class="o">=</span> <span class="n">x</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">]</span> <span class="o">*</span> <span class="n">m_mod</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">]</span> <span class="o">-</span> <span class="n">alpha</span>
        <span class="n">x_mod_d</span> <span class="o">=</span> <span class="n">x</span><span class="p">[:,</span> <span class="mi">1</span><span class="p">]</span> <span class="o">*</span> <span class="n">m_mod</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">]</span>
        <span class="n">y_mod</span> <span class="o">=</span> <span class="n">straight</span><span class="p">(</span><span class="n">x_mod</span><span class="p">,</span> <span class="n">_a</span><span class="p">,</span> <span class="n">b</span><span class="p">)</span>
        <span class="n">y_mod_d</span> <span class="o">=</span> <span class="n">straight_x_std</span><span class="p">(</span><span class="n">x_mod</span><span class="p">,</span> <span class="n">b</span><span class="p">,</span> <span class="n">x_mod_d</span><span class="p">,</span> <span class="n">sigma_a</span><span class="p">,</span> <span class="n">sigma_b</span><span class="p">,</span> <span class="n">corr</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">y_mod</span> <span class="o">/</span> <span class="n">m_mod</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">],</span> <span class="n">y_mod_d</span> <span class="o">/</span> <span class="n">m_mod</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">]])</span><span class="o">.</span><span class="n">T</span></div>

<div class="viewcode-block" id="King.get_unmodified_input_x_nd"><a class="viewcode-back" href="../../pycol.html#pycol.analyze.King.get_unmodified_input_x_nd">[docs]</a>    <span class="k">def</span> <span class="nf">get_unmodified_input_x_nd</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Union</span><span class="p">[</span><span class="n">ndarray</span><span class="p">,</span> <span class="kc">None</span><span class="p">]:</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        :returns: The unmodified x values improved by the &#39;fit_nd&#39;.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">x_results</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;There are no results yet. Please use one of the fitting options.&#39;</span><span class="p">)</span>
            <span class="k">return</span> <span class="kc">None</span>
        <span class="n">i</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="bp">self</span><span class="o">.</span><span class="n">a</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="n">a_i</span><span class="p">)</span> <span class="k">for</span> <span class="n">a_i</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">a_fit</span><span class="p">])</span>
        <span class="n">i_ref</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="bp">self</span><span class="o">.</span><span class="n">a</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="n">a_i</span><span class="p">)</span> <span class="k">for</span> <span class="n">a_i</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">a_ref</span><span class="p">])</span>
        <span class="n">m_mod_sample</span> <span class="o">=</span> <span class="n">ph</span><span class="o">.</span><span class="n">mass_factor</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">m_sample</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">m_sample</span><span class="p">[</span><span class="n">i_ref</span><span class="p">])[</span><span class="mi">0</span><span class="p">]</span>
        <span class="n">x</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">x_results</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">/</span> <span class="n">np</span><span class="o">.</span><span class="n">expand_dims</span><span class="p">(</span><span class="n">m_mod_sample</span><span class="o">.</span><span class="n">T</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">x_results</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]],</span> <span class="n">axis</span><span class="o">=-</span><span class="mi">1</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">transpose</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">),</span> <span class="n">np</span><span class="o">.</span><span class="n">std</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">ddof</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)]),</span> <span class="n">axes</span><span class="o">=</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">0</span><span class="p">])</span></div>

<div class="viewcode-block" id="King.get_unmodified_x_nd"><a class="viewcode-back" href="../../pycol.html#pycol.analyze.King.get_unmodified_x_nd">[docs]</a>    <span class="k">def</span> <span class="nf">get_unmodified_x_nd</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">a</span><span class="p">:</span> <span class="n">array_iter</span><span class="p">,</span> <span class="n">a_ref</span><span class="p">:</span> <span class="n">array_iter</span><span class="p">,</span> <span class="n">y</span><span class="p">:</span> <span class="n">array_iter</span><span class="p">,</span> <span class="n">axis</span><span class="p">:</span> <span class="nb">int</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Union</span><span class="p">[</span><span class="n">ndarray</span><span class="p">,</span> <span class="kc">None</span><span class="p">]:</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        :param a: An Iterable of mass numbers corresponding to the isotopes of the given &#39;y&#39; values.</span>
<span class="sd">        :param a_ref: An Iterable of mass numbers corresponding to reference isotopes of the given &#39;y&#39; values.</span>
<span class="sd">        :param y: The unmodified y values of the given mass numbers. Must have shape (len(a), 2).</span>
<span class="sd">        :param axis: The axis of the input values.</span>
<span class="sd">        :returns: The unmodified values improved by &#39;fit_nd&#39;.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">x_results</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;There are no results yet. Please use one of the fitting options.&#39;</span><span class="p">)</span>
            <span class="k">return</span> <span class="kc">None</span>
        <span class="n">_a</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">expand_dims</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">x_results</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
        <span class="n">b</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">expand_dims</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">x_results</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
        <span class="n">a</span><span class="p">,</span> <span class="n">a_ref</span><span class="p">,</span> <span class="n">y</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="n">a</span><span class="p">),</span> <span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="n">a_ref</span><span class="p">),</span> <span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="n">y</span><span class="p">)</span>
        <span class="n">i</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="bp">self</span><span class="o">.</span><span class="n">a</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="n">a_i</span><span class="p">)</span> <span class="k">for</span> <span class="n">a_i</span> <span class="ow">in</span> <span class="n">a</span><span class="p">])</span>
        <span class="n">i_ref</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="bp">self</span><span class="o">.</span><span class="n">a</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="n">a_i</span><span class="p">)</span> <span class="k">for</span> <span class="n">a_i</span> <span class="ow">in</span> <span class="n">a_ref</span><span class="p">])</span>
        <span class="n">m</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">m_sample</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="p">:]</span>
        <span class="n">m</span> <span class="o">=</span> <span class="n">m</span><span class="p">[:,</span> <span class="bp">self</span><span class="o">.</span><span class="n">x_results</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]]</span>
        <span class="n">m_ref</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">m_sample</span><span class="p">[</span><span class="n">i_ref</span><span class="p">,</span> <span class="p">:]</span>
        <span class="n">m_ref</span> <span class="o">=</span> <span class="n">m_ref</span><span class="p">[:,</span> <span class="bp">self</span><span class="o">.</span><span class="n">x_results</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]]</span>
        <span class="n">m_mod_sample</span> <span class="o">=</span> <span class="n">ph</span><span class="o">.</span><span class="n">mass_factor</span><span class="p">(</span><span class="n">m</span><span class="p">,</span> <span class="n">m_ref</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">T</span>
        <span class="n">y_sample</span> <span class="o">=</span> <span class="n">st</span><span class="o">.</span><span class="n">norm</span><span class="o">.</span><span class="n">rvs</span><span class="p">(</span><span class="n">loc</span><span class="o">=</span><span class="n">y</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">],</span> <span class="n">scale</span><span class="o">=</span><span class="n">y</span><span class="p">[:,</span> <span class="mi">1</span><span class="p">],</span> <span class="n">size</span><span class="o">=</span><span class="p">(</span><span class="n">m_mod_sample</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="nb">len</span><span class="p">(</span><span class="n">a</span><span class="p">)))</span>
        <span class="n">y_sample</span> <span class="o">=</span> <span class="n">m_mod_sample</span> <span class="o">*</span> <span class="n">y_sample</span>
        <span class="n">x_sample</span> <span class="o">=</span> <span class="n">straight</span><span class="p">(</span><span class="n">y_sample</span><span class="p">,</span> <span class="o">-</span><span class="n">_a</span><span class="p">[:,</span> <span class="p">:,</span> <span class="n">axis</span><span class="p">]</span> <span class="o">/</span> <span class="n">b</span><span class="p">[:,</span> <span class="p">:,</span> <span class="n">axis</span><span class="p">],</span> <span class="mf">1.</span> <span class="o">/</span> <span class="n">b</span><span class="p">[:,</span> <span class="p">:,</span> <span class="n">axis</span><span class="p">])</span>
        <span class="n">x_sample</span> <span class="o">=</span> <span class="n">straight</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">expand_dims</span><span class="p">(</span><span class="n">x_sample</span><span class="p">,</span> <span class="n">axis</span><span class="o">=-</span><span class="mi">1</span><span class="p">),</span> <span class="n">_a</span><span class="p">,</span> <span class="n">b</span><span class="p">)</span>
        <span class="n">x_sample</span> <span class="o">/=</span> <span class="n">np</span><span class="o">.</span><span class="n">expand_dims</span><span class="p">(</span><span class="n">m_mod_sample</span><span class="p">,</span> <span class="n">axis</span><span class="o">=-</span><span class="mi">1</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">x_sample</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">),</span> <span class="n">np</span><span class="o">.</span><span class="n">std</span><span class="p">(</span><span class="n">x_sample</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">ddof</span><span class="o">=</span><span class="mi">1</span><span class="p">)])</span><span class="o">.</span><span class="n">T</span></div>

<div class="viewcode-block" id="King.plot"><a class="viewcode-back" href="../../pycol.html#pycol.analyze.King.plot">[docs]</a>    <span class="k">def</span> <span class="nf">plot</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">mode</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="n">sigma2d</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span> <span class="n">show</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span> <span class="n">add_xy</span><span class="p">:</span> <span class="n">array_like</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
             <span class="n">add_a</span><span class="p">:</span> <span class="n">array_like</span> <span class="o">=</span> <span class="kc">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        :param mode: The mode of the King-fit. If mode=&#39;radii&#39;, the :math:`x`-axis must contain the differences of</span>
<span class="sd">         mean square nuclear charge radii or the Lambda-factor. For every other value,</span>
<span class="sd">         the :math:`x`-axis is assumed to be an isotope shift such that the slope corresponds to</span>
<span class="sd">         a field-shift ratio :math:`F(y_i) / F(x)`.</span>
<span class="sd">        :param sigma2d: Whether to draw the actual two-dimensional uncertainty bounds or the classical errorbars.</span>
<span class="sd">        :param show: Whether to show the plot.</span>
<span class="sd">        :param add_xy: Additional :math:`x` and :math:`y` data to plot. Must have shape (:, 4).</span>
<span class="sd">        :param add_a: Additional mass numbers for the additional data- Must have shape (:, 2).</span>
<span class="sd">         The reference is the second column.</span>
<span class="sd">        :returns: None. Generates a King-Plot based on the modified axes &#39;self.x_mod&#39; and &#39;self.y_mod&#39;</span>
<span class="sd">         as well as the fit results &#39;self.results&#39;.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">results</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;There are no results yet. Please use one of the fitting options.&#39;</span><span class="p">)</span>
            <span class="k">return</span>
        <span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">,</span> <span class="n">sigma_a</span><span class="p">,</span> <span class="n">sigma_b</span><span class="p">,</span> <span class="n">corr</span><span class="p">,</span> <span class="n">alpha</span><span class="p">)</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">results</span>
        <span class="n">scale_x</span> <span class="o">=</span> <span class="mf">1e-3</span>
        <span class="n">offset_str</span> <span class="o">=</span> <span class="s1">&#39; - </span><span class="si">{}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="nb">round</span><span class="p">(</span><span class="n">alpha</span> <span class="o">*</span> <span class="n">scale_x</span><span class="p">,</span> <span class="mi">1</span><span class="p">))</span> <span class="k">if</span> <span class="n">alpha</span> <span class="o">!=</span> <span class="mi">0</span> <span class="k">else</span> <span class="s1">&#39;&#39;</span>
        <span class="n">xlabel</span> <span class="o">=</span> <span class="s1">&#39;x</span><span class="si">{}</span><span class="s1"> (mode=</span><span class="se">\&#39;</span><span class="s1">shifts</span><span class="se">\&#39;</span><span class="s1"> or =</span><span class="se">\&#39;</span><span class="s1">radii</span><span class="se">\&#39;</span><span class="s1"> for right x-label)&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">offset_str</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">mode</span> <span class="o">==</span> <span class="s1">&#39;radii&#39;</span><span class="p">:</span>
            <span class="n">scale_x</span> <span class="o">=</span> <span class="mf">1.</span>
            <span class="n">offset_str</span> <span class="o">=</span> <span class="s1">&#39; - </span><span class="si">{}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="nb">round</span><span class="p">(</span><span class="n">alpha</span> <span class="o">*</span> <span class="n">scale_x</span><span class="p">,</span> <span class="mi">1</span><span class="p">))</span> <span class="k">if</span> <span class="n">alpha</span> <span class="o">!=</span> <span class="mi">0</span> <span class="k">else</span> <span class="s1">&#39;&#39;</span>
            <span class="n">xlabel</span> <span class="o">=</span> <span class="sa">r</span><span class="s1">&#39;$\mu\,\delta\langle r^2\rangle^{A, A^\prime}&#39;</span> <span class="o">+</span> <span class="n">offset_str</span> <span class="o">+</span> <span class="sa">r</span><span class="s1">&#39;\quad(\mathrm</span><span class="si">{u}</span><span class="s1">\,\mathrm</span><span class="si">{fm}</span><span class="s1">^2)$&#39;</span>
        <span class="k">elif</span> <span class="n">mode</span> <span class="o">==</span> <span class="s1">&#39;shifts&#39;</span><span class="p">:</span>
            <span class="n">scale_x</span> <span class="o">=</span> <span class="mf">1e-3</span>
            <span class="n">offset_str</span> <span class="o">=</span> <span class="s1">&#39; - </span><span class="si">{}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="nb">round</span><span class="p">(</span><span class="n">alpha</span> <span class="o">*</span> <span class="n">scale_x</span><span class="p">,</span> <span class="mi">1</span><span class="p">))</span> <span class="k">if</span> <span class="n">alpha</span> <span class="o">!=</span> <span class="mi">0</span> <span class="k">else</span> <span class="s1">&#39;&#39;</span>
            <span class="n">xlabel</span> <span class="o">=</span> <span class="sa">r</span><span class="s1">&#39;$\mu\,\delta\nu_x^{A, A^\prime}&#39;</span> <span class="o">+</span> <span class="n">offset_str</span> <span class="o">+</span> <span class="sa">r</span><span class="s1">&#39;\quad(\mathrm{u\,GHz})$&#39;</span>

        <span class="k">if</span> <span class="n">sigma2d</span><span class="p">:</span>
            <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">((</span><span class="bp">self</span><span class="o">.</span><span class="n">x_mod</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">]</span> <span class="o">-</span> <span class="n">alpha</span><span class="p">)</span> <span class="o">*</span> <span class="n">scale_x</span><span class="p">,</span>
                     <span class="bp">self</span><span class="o">.</span><span class="n">y_mod</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">]</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">scale_y</span><span class="p">,</span> <span class="s1">&#39;k.&#39;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;Data&#39;</span><span class="p">)</span>
            <span class="n">draw_sigma2d</span><span class="p">((</span><span class="bp">self</span><span class="o">.</span><span class="n">x_mod</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">]</span> <span class="o">-</span> <span class="n">alpha</span><span class="p">)</span> <span class="o">*</span> <span class="n">scale_x</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">y_mod</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">]</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">scale_y</span><span class="p">,</span>
                         <span class="bp">self</span><span class="o">.</span><span class="n">x_mod</span><span class="p">[:,</span> <span class="mi">1</span><span class="p">]</span> <span class="o">*</span> <span class="n">scale_x</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">y_mod</span><span class="p">[:,</span> <span class="mi">1</span><span class="p">]</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">scale_y</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">corr</span><span class="p">,</span> <span class="n">n</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">add_xy</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">((</span><span class="n">add_xy</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">]</span> <span class="o">-</span> <span class="n">alpha</span><span class="p">)</span> <span class="o">*</span> <span class="n">scale_x</span><span class="p">,</span>
                         <span class="n">add_xy</span><span class="p">[:,</span> <span class="mi">2</span><span class="p">]</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">scale_y</span><span class="p">,</span> <span class="s1">&#39;r.&#39;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;Data&#39;</span><span class="p">)</span>
                <span class="n">draw_sigma2d</span><span class="p">((</span><span class="n">add_xy</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">]</span> <span class="o">-</span> <span class="n">alpha</span><span class="p">)</span> <span class="o">*</span> <span class="n">scale_x</span><span class="p">,</span> <span class="n">add_xy</span><span class="p">[:,</span> <span class="mi">2</span><span class="p">]</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">scale_y</span><span class="p">,</span>
                             <span class="n">add_xy</span><span class="p">[:,</span> <span class="mi">1</span><span class="p">]</span> <span class="o">*</span> <span class="n">scale_x</span><span class="p">,</span> <span class="n">add_xy</span><span class="p">[:,</span> <span class="mi">3</span><span class="p">]</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">scale_y</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">corr</span><span class="p">,</span> <span class="n">n</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="o">**</span><span class="p">{</span><span class="s1">&#39;color&#39;</span><span class="p">:</span> <span class="s1">&#39;r&#39;</span><span class="p">})</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">plt</span><span class="o">.</span><span class="n">errorbar</span><span class="p">((</span><span class="bp">self</span><span class="o">.</span><span class="n">x_mod</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">]</span> <span class="o">-</span> <span class="n">alpha</span><span class="p">)</span> <span class="o">*</span> <span class="n">scale_x</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">y_mod</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">]</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">scale_y</span><span class="p">,</span>
                         <span class="n">xerr</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">x_mod</span><span class="p">[:,</span> <span class="mi">1</span><span class="p">]</span> <span class="o">*</span> <span class="n">scale_x</span><span class="p">,</span> <span class="n">yerr</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">y_mod</span><span class="p">[:,</span> <span class="mi">1</span><span class="p">]</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">scale_y</span><span class="p">,</span>
                         <span class="n">fmt</span><span class="o">=</span><span class="s1">&#39;k.&#39;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;Data&#39;</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">add_xy</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">plt</span><span class="o">.</span><span class="n">errorbar</span><span class="p">((</span><span class="n">add_xy</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">]</span> <span class="o">-</span> <span class="n">alpha</span><span class="p">)</span> <span class="o">*</span> <span class="n">scale_x</span><span class="p">,</span> <span class="n">add_xy</span><span class="p">[:,</span> <span class="mi">2</span><span class="p">]</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">scale_y</span><span class="p">,</span>
                             <span class="n">xerr</span><span class="o">=</span><span class="n">add_xy</span><span class="p">[:,</span> <span class="mi">1</span><span class="p">]</span> <span class="o">*</span> <span class="n">scale_x</span><span class="p">,</span> <span class="n">yerr</span><span class="o">=</span><span class="n">add_xy</span><span class="p">[:,</span> <span class="mi">3</span><span class="p">]</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">scale_y</span><span class="p">,</span>
                             <span class="n">fmt</span><span class="o">=</span><span class="s1">&#39;r.&#39;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;Add. Data&#39;</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">a_fit</span><span class="p">)):</span>
            <span class="n">pm</span> <span class="o">=</span> <span class="o">-</span><span class="mf">1.</span> <span class="k">if</span> <span class="n">b</span> <span class="o">&gt;</span> <span class="mi">0</span> <span class="k">else</span> <span class="mf">1.</span>
            <span class="n">plt</span><span class="o">.</span><span class="n">text</span><span class="p">((</span><span class="bp">self</span><span class="o">.</span><span class="n">x_mod</span><span class="p">[</span><span class="n">j</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span> <span class="o">+</span> <span class="mf">1.</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">x_mod</span><span class="p">[</span><span class="n">j</span><span class="p">,</span> <span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="n">alpha</span><span class="p">)</span> <span class="o">*</span> <span class="n">scale_x</span><span class="p">,</span>
                     <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">y_mod</span><span class="p">[</span><span class="n">j</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span> <span class="o">+</span> <span class="n">pm</span> <span class="o">*</span> <span class="mf">5.</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">y_mod</span><span class="p">[</span><span class="n">j</span><span class="p">,</span> <span class="mi">1</span><span class="p">])</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">scale_y</span><span class="p">,</span>
                     <span class="s1">&#39;</span><span class="si">{}</span><span class="s1"> - </span><span class="si">{}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">a_fit</span><span class="p">[</span><span class="n">j</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">a_ref</span><span class="p">[</span><span class="n">j</span><span class="p">]),</span> <span class="n">fontsize</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">fontsize</span><span class="p">,</span>
                     <span class="n">horizontalalignment</span><span class="o">=</span><span class="s1">&#39;left&#39;</span><span class="p">,</span> <span class="n">verticalalignment</span><span class="o">=</span><span class="s1">&#39;top&#39;</span> <span class="k">if</span> <span class="n">b</span> <span class="o">&gt;</span> <span class="mi">0</span> <span class="k">else</span> <span class="s1">&#39;bottom&#39;</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">add_a</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">add_xy</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">add_xy</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]):</span>
                <span class="n">pm</span> <span class="o">=</span> <span class="mf">1.</span> <span class="k">if</span> <span class="n">b</span> <span class="o">&gt;</span> <span class="mi">0</span> <span class="k">else</span> <span class="o">-</span><span class="mf">1.</span>
                <span class="n">plt</span><span class="o">.</span><span class="n">text</span><span class="p">((</span><span class="n">add_xy</span><span class="p">[</span><span class="n">j</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span> <span class="o">-</span> <span class="mf">1.</span> <span class="o">*</span> <span class="n">add_xy</span><span class="p">[</span><span class="n">j</span><span class="p">,</span> <span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="n">alpha</span><span class="p">)</span> <span class="o">*</span> <span class="n">scale_x</span><span class="p">,</span>
                         <span class="p">(</span><span class="n">add_xy</span><span class="p">[</span><span class="n">j</span><span class="p">,</span> <span class="mi">2</span><span class="p">]</span> <span class="o">+</span> <span class="n">pm</span> <span class="o">*</span> <span class="mf">5.</span> <span class="o">*</span> <span class="n">add_xy</span><span class="p">[</span><span class="n">j</span><span class="p">,</span> <span class="mi">3</span><span class="p">])</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">scale_y</span><span class="p">,</span>
                         <span class="s1">&#39;</span><span class="si">{}</span><span class="s1"> - </span><span class="si">{}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="o">*</span><span class="n">add_a</span><span class="p">[</span><span class="n">j</span><span class="p">]),</span> <span class="n">fontsize</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">fontsize</span><span class="p">,</span>
                         <span class="n">horizontalalignment</span><span class="o">=</span><span class="s1">&#39;right&#39;</span><span class="p">,</span> <span class="n">verticalalignment</span><span class="o">=</span><span class="s1">&#39;bottom&#39;</span> <span class="k">if</span> <span class="n">b</span> <span class="o">&gt;</span> <span class="mi">0</span> <span class="k">else</span> <span class="s1">&#39;top&#39;</span><span class="p">)</span>

        <span class="n">min_x</span><span class="p">,</span> <span class="n">max_x</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">min</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">x_mod</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">]),</span> <span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">x_mod</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">])</span>
        <span class="n">x_cont</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="n">min_x</span> <span class="o">-</span> <span class="mf">0.1</span> <span class="o">*</span> <span class="p">(</span><span class="n">max_x</span> <span class="o">-</span> <span class="n">min_x</span><span class="p">),</span> <span class="n">max_x</span> <span class="o">+</span> <span class="mf">0.1</span> <span class="o">*</span> <span class="p">(</span><span class="n">max_x</span> <span class="o">-</span> <span class="n">min_x</span><span class="p">),</span> <span class="mi">1001</span><span class="p">)</span> <span class="o">-</span> <span class="n">alpha</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">x_cont</span> <span class="o">*</span> <span class="n">scale_x</span><span class="p">,</span> <span class="n">straight</span><span class="p">(</span><span class="n">x_cont</span><span class="p">,</span> <span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">)</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">scale_y</span><span class="p">,</span> <span class="s1">&#39;b-&#39;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;Fit&#39;</span><span class="p">)</span>
        <span class="n">y_min</span> <span class="o">=</span> <span class="n">straight</span><span class="p">(</span><span class="n">x_cont</span><span class="p">,</span> <span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">)</span> <span class="o">-</span> <span class="n">straight_std</span><span class="p">(</span><span class="n">x_cont</span><span class="p">,</span> <span class="n">sigma_a</span><span class="p">,</span> <span class="n">sigma_b</span><span class="p">,</span> <span class="n">corr</span><span class="p">)</span>
        <span class="n">y_max</span> <span class="o">=</span> <span class="n">straight</span><span class="p">(</span><span class="n">x_cont</span><span class="p">,</span> <span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">)</span> <span class="o">+</span> <span class="n">straight_std</span><span class="p">(</span><span class="n">x_cont</span><span class="p">,</span> <span class="n">sigma_a</span><span class="p">,</span> <span class="n">sigma_b</span><span class="p">,</span> <span class="n">corr</span><span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">fill_between</span><span class="p">(</span><span class="n">x_cont</span> <span class="o">*</span> <span class="n">scale_x</span><span class="p">,</span> <span class="n">y_min</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">scale_y</span><span class="p">,</span> <span class="n">y_max</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">scale_y</span><span class="p">,</span>
                         <span class="n">color</span><span class="o">=</span><span class="s1">&#39;b&#39;</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.3</span><span class="p">,</span> <span class="n">antialiased</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        
        <span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="n">xlabel</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">fontsize</span><span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;$\mu\,\delta\nu_y^{A, A^\prime}\quad(\mathrm{u\,GHz})$&#39;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">fontsize</span><span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">xticks</span><span class="p">(</span><span class="n">fontsize</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">fontsize</span><span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">yticks</span><span class="p">(</span><span class="n">fontsize</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">fontsize</span><span class="p">)</span>

        <span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span><span class="n">numpoints</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">loc</span><span class="o">=</span><span class="s1">&#39;best&#39;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">fontsize</span><span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">margins</span><span class="p">(</span><span class="mf">0.1</span><span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">()</span>
        <span class="k">if</span> <span class="n">show</span><span class="p">:</span>
            <span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
            <span class="n">plt</span><span class="o">.</span><span class="n">gcf</span><span class="p">()</span><span class="o">.</span><span class="n">clear</span><span class="p">()</span></div>

<div class="viewcode-block" id="King.plot_nd"><a class="viewcode-back" href="../../pycol.html#pycol.analyze.King.plot_nd">[docs]</a>    <span class="k">def</span> <span class="nf">plot_nd</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">axis</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span> <span class="n">mode</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="n">sigma2d</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        :param axis: The axis which is used as the x-axis throughout the plots.</span>
<span class="sd">        :param mode: The mode of the King-plot. If mode=&#39;radii&#39;, the :math:`x`-axis must contain the differences of</span>
<span class="sd">         mean square nuclear charge radii or the Lambda-factor. For every other value,</span>
<span class="sd">         the :math:`x`-axis is assumed to be an isotope shift such that the slope corresponds to</span>
<span class="sd">         a field-shift ratio :math:`F(y_i) / F(x)`.</span>
<span class="sd">        :param sigma2d: Whether to draw the actual two-dimensional uncertainty bounds or the classical errorbars.</span>
<span class="sd">        :returns: None. Generates a King-Plot based on the modified axes &#39;self.x_mod_nd&#39; and &#39;self.y_mod_nd&#39;</span>
<span class="sd">         as well as the fit results &#39;self.results_nd&#39;.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">results_nd</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;There are no results yet. Please use one of the fitting options.&#39;</span><span class="p">)</span>
            <span class="k">return</span>
        <span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">,</span> <span class="n">sigma_a</span><span class="p">,</span> <span class="n">sigma_b</span><span class="p">,</span> <span class="n">corr</span><span class="p">)</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">results_nd</span>
        <span class="n">alpha</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="n">scale_x</span> <span class="o">=</span> <span class="mf">1e-3</span>
        <span class="n">offset_str</span> <span class="o">=</span> <span class="s1">&#39; - </span><span class="si">{}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="nb">round</span><span class="p">(</span><span class="n">alpha</span> <span class="o">*</span> <span class="n">scale_x</span><span class="p">,</span> <span class="mi">1</span><span class="p">))</span> <span class="k">if</span> <span class="n">alpha</span> <span class="o">!=</span> <span class="mi">0</span> <span class="k">else</span> <span class="s1">&#39;&#39;</span>
        <span class="n">xlabel</span> <span class="o">=</span> <span class="s1">&#39;x</span><span class="si">{}</span><span class="s1"> (mode=</span><span class="se">\&#39;</span><span class="s1">shifts</span><span class="se">\&#39;</span><span class="s1"> or =</span><span class="se">\&#39;</span><span class="s1">radii</span><span class="se">\&#39;</span><span class="s1"> for right x-label)&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">offset_str</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">mode</span> <span class="o">==</span> <span class="s1">&#39;radii&#39;</span><span class="p">:</span>
            <span class="n">scale_x</span> <span class="o">=</span> <span class="mf">1.</span>
            <span class="n">offset_str</span> <span class="o">=</span> <span class="s1">&#39; - </span><span class="si">{}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="nb">round</span><span class="p">(</span><span class="n">alpha</span> <span class="o">*</span> <span class="n">scale_x</span><span class="p">,</span> <span class="mi">1</span><span class="p">))</span> <span class="k">if</span> <span class="n">alpha</span> <span class="o">!=</span> <span class="mi">0</span> <span class="k">else</span> <span class="s1">&#39;&#39;</span>
            <span class="n">xlabel</span> <span class="o">=</span> <span class="sa">r</span><span class="s1">&#39;$\mu\,\delta\langle r^2\rangle^{A, A^\prime}&#39;</span> <span class="o">+</span> <span class="n">offset_str</span> <span class="o">+</span> <span class="sa">r</span><span class="s1">&#39;\quad(\mathrm</span><span class="si">{u}</span><span class="s1">\,\mathrm</span><span class="si">{fm}</span><span class="s1">^2)$&#39;</span>
        <span class="k">elif</span> <span class="n">mode</span> <span class="o">==</span> <span class="s1">&#39;shifts&#39;</span><span class="p">:</span>
            <span class="n">scale_x</span> <span class="o">=</span> <span class="mf">1e-3</span>
            <span class="n">offset_str</span> <span class="o">=</span> <span class="s1">&#39; - </span><span class="si">{}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="nb">round</span><span class="p">(</span><span class="n">alpha</span> <span class="o">*</span> <span class="n">scale_x</span><span class="p">,</span> <span class="mi">1</span><span class="p">))</span> <span class="k">if</span> <span class="n">alpha</span> <span class="o">!=</span> <span class="mi">0</span> <span class="k">else</span> <span class="s1">&#39;&#39;</span>
            <span class="n">xlabel</span> <span class="o">=</span> <span class="sa">r</span><span class="s1">&#39;$\mu\,\delta\nu_x^{A, A^\prime}&#39;</span> <span class="o">+</span> <span class="n">offset_str</span> <span class="o">+</span> <span class="sa">r</span><span class="s1">&#39;\quad(\mathrm{u\,GHz})$&#39;</span>
        
        <span class="n">n_rows</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">x_nd_mod</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="mi">1</span>
        <span class="n">rows</span> <span class="o">=</span> <span class="p">[</span><span class="n">i</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">n_rows</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span> <span class="k">if</span> <span class="n">i</span> <span class="o">!=</span> <span class="n">axis</span><span class="p">]</span>
        <span class="k">for</span> <span class="n">row</span><span class="p">,</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">rows</span><span class="p">):</span>
            <span class="n">plt</span><span class="o">.</span><span class="n">subplot</span><span class="p">(</span><span class="n">n_rows</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">row</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span>

            <span class="k">if</span> <span class="n">sigma2d</span><span class="p">:</span>
                <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">((</span><span class="bp">self</span><span class="o">.</span><span class="n">x_nd_mod</span><span class="p">[:,</span> <span class="n">axis</span><span class="p">]</span> <span class="o">-</span> <span class="n">alpha</span><span class="p">)</span> <span class="o">*</span> <span class="n">scale_x</span><span class="p">,</span>
                         <span class="bp">self</span><span class="o">.</span><span class="n">x_nd_mod</span><span class="p">[:,</span> <span class="n">i</span><span class="p">]</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">scale_y</span><span class="p">,</span> <span class="s1">&#39;k.&#39;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;Data&#39;</span><span class="p">)</span>
                <span class="n">draw_sigma2d</span><span class="p">((</span><span class="bp">self</span><span class="o">.</span><span class="n">x_nd_mod</span><span class="p">[:,</span> <span class="n">axis</span><span class="p">]</span> <span class="o">-</span> <span class="n">alpha</span><span class="p">)</span> <span class="o">*</span> <span class="n">scale_x</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">x_nd_mod</span><span class="p">[:,</span> <span class="n">i</span><span class="p">]</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">scale_y</span><span class="p">,</span>
                             <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">cov</span><span class="p">[:,</span> <span class="n">axis</span><span class="p">,</span> <span class="n">axis</span><span class="p">])</span> <span class="o">*</span> <span class="n">scale_x</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">cov</span><span class="p">[:,</span> <span class="n">i</span><span class="p">,</span> <span class="n">i</span><span class="p">])</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">scale_y</span><span class="p">,</span>
                             <span class="bp">self</span><span class="o">.</span><span class="n">cov</span><span class="p">[:,</span> <span class="n">axis</span><span class="p">,</span> <span class="n">i</span><span class="p">]</span> <span class="o">/</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">cov</span><span class="p">[:,</span> <span class="n">axis</span><span class="p">,</span> <span class="n">axis</span><span class="p">]</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">cov</span><span class="p">[:,</span> <span class="n">i</span><span class="p">,</span> <span class="n">i</span><span class="p">]),</span> <span class="n">n</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">plt</span><span class="o">.</span><span class="n">errorbar</span><span class="p">((</span><span class="bp">self</span><span class="o">.</span><span class="n">x_nd_mod</span><span class="p">[:,</span> <span class="n">axis</span><span class="p">]</span> <span class="o">-</span> <span class="n">alpha</span><span class="p">)</span> <span class="o">*</span> <span class="n">scale_x</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">x_nd_mod</span><span class="p">[:,</span> <span class="n">i</span><span class="p">]</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">scale_y</span><span class="p">,</span>
                             <span class="n">xerr</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">cov</span><span class="p">[:,</span> <span class="n">axis</span><span class="p">,</span> <span class="n">axis</span><span class="p">])</span> <span class="o">*</span> <span class="n">scale_x</span><span class="p">,</span>
                             <span class="n">yerr</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">cov</span><span class="p">[:,</span> <span class="n">i</span><span class="p">,</span> <span class="n">i</span><span class="p">])</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">scale_y</span><span class="p">,</span> <span class="n">fmt</span><span class="o">=</span><span class="s1">&#39;k.&#39;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;Data&#39;</span><span class="p">)</span>
            <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">a_fit</span><span class="p">)):</span>
                <span class="n">pm</span> <span class="o">=</span> <span class="o">-</span><span class="mf">1.</span> <span class="k">if</span> <span class="n">b</span><span class="p">[</span><span class="n">row</span><span class="p">]</span> <span class="o">&gt;</span> <span class="mi">0</span> <span class="k">else</span> <span class="mf">1.</span>
                <span class="n">plt</span><span class="o">.</span><span class="n">text</span><span class="p">((</span><span class="bp">self</span><span class="o">.</span><span class="n">x_nd_mod</span><span class="p">[</span><span class="n">j</span><span class="p">,</span> <span class="n">axis</span><span class="p">]</span> <span class="o">+</span> <span class="mf">1.</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">cov</span><span class="p">[</span><span class="n">j</span><span class="p">,</span> <span class="n">axis</span><span class="p">,</span> <span class="n">axis</span><span class="p">])</span> <span class="o">-</span> <span class="n">alpha</span><span class="p">)</span> <span class="o">*</span> <span class="n">scale_x</span><span class="p">,</span>
                         <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">x_nd_mod</span><span class="p">[</span><span class="n">j</span><span class="p">,</span> <span class="n">i</span><span class="p">]</span> <span class="o">+</span> <span class="n">pm</span> <span class="o">*</span> <span class="mf">5.</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">cov</span><span class="p">[</span><span class="n">j</span><span class="p">,</span> <span class="n">i</span><span class="p">,</span> <span class="n">i</span><span class="p">]))</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">scale_y</span><span class="p">,</span>
                         <span class="s1">&#39;</span><span class="si">{}</span><span class="s1"> - </span><span class="si">{}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">a_fit</span><span class="p">[</span><span class="n">j</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">a_ref</span><span class="p">[</span><span class="n">j</span><span class="p">]),</span> <span class="n">fontsize</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">fontsize</span><span class="p">,</span>
                         <span class="n">horizontalalignment</span><span class="o">=</span><span class="s1">&#39;left&#39;</span><span class="p">,</span> <span class="n">verticalalignment</span><span class="o">=</span><span class="s1">&#39;top&#39;</span> <span class="k">if</span> <span class="n">b</span><span class="p">[</span><span class="n">row</span><span class="p">]</span> <span class="o">&gt;</span> <span class="mi">0</span> <span class="k">else</span> <span class="s1">&#39;bottom&#39;</span><span class="p">)</span>

            <span class="n">min_x</span><span class="p">,</span> <span class="n">max_x</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">min</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">x_nd_mod</span><span class="p">[:,</span> <span class="n">axis</span><span class="p">]),</span> <span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">x_nd_mod</span><span class="p">[:,</span> <span class="n">axis</span><span class="p">])</span>
            <span class="n">x_cont</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="n">min_x</span> <span class="o">-</span> <span class="mf">0.1</span> <span class="o">*</span> <span class="p">(</span><span class="n">max_x</span> <span class="o">-</span> <span class="n">min_x</span><span class="p">),</span> <span class="n">max_x</span> <span class="o">+</span> <span class="mf">0.1</span> <span class="o">*</span> <span class="p">(</span><span class="n">max_x</span> <span class="o">-</span> <span class="n">min_x</span><span class="p">),</span> <span class="mi">1001</span><span class="p">)</span> <span class="o">-</span> <span class="n">alpha</span>
            <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">x_cont</span> <span class="o">*</span> <span class="n">scale_x</span><span class="p">,</span> <span class="n">straight</span><span class="p">(</span><span class="n">x_cont</span><span class="p">,</span> <span class="n">a</span><span class="p">[</span><span class="n">row</span><span class="p">],</span> <span class="n">b</span><span class="p">[</span><span class="n">row</span><span class="p">])</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">scale_y</span><span class="p">,</span> <span class="s1">&#39;b-&#39;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;Fit&#39;</span><span class="p">)</span>
            <span class="n">y_min</span> <span class="o">=</span> <span class="n">straight</span><span class="p">(</span><span class="n">x_cont</span><span class="p">,</span> <span class="n">a</span><span class="p">[</span><span class="n">row</span><span class="p">],</span> <span class="n">b</span><span class="p">[</span><span class="n">row</span><span class="p">])</span> <span class="o">-</span> <span class="n">straight_std</span><span class="p">(</span><span class="n">x_cont</span><span class="p">,</span> <span class="n">sigma_a</span><span class="p">[</span><span class="n">row</span><span class="p">],</span> <span class="n">sigma_b</span><span class="p">[</span><span class="n">row</span><span class="p">],</span> <span class="n">corr</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="n">axis</span><span class="p">])</span>
            <span class="n">y_max</span> <span class="o">=</span> <span class="n">straight</span><span class="p">(</span><span class="n">x_cont</span><span class="p">,</span> <span class="n">a</span><span class="p">[</span><span class="n">row</span><span class="p">],</span> <span class="n">b</span><span class="p">[</span><span class="n">row</span><span class="p">])</span> <span class="o">+</span> <span class="n">straight_std</span><span class="p">(</span><span class="n">x_cont</span><span class="p">,</span> <span class="n">sigma_a</span><span class="p">[</span><span class="n">row</span><span class="p">],</span> <span class="n">sigma_b</span><span class="p">[</span><span class="n">row</span><span class="p">],</span> <span class="n">corr</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="n">axis</span><span class="p">])</span>
            <span class="n">plt</span><span class="o">.</span><span class="n">fill_between</span><span class="p">(</span><span class="n">x_cont</span> <span class="o">*</span> <span class="n">scale_x</span><span class="p">,</span> <span class="n">y_min</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">scale_y</span><span class="p">,</span> <span class="n">y_max</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">scale_y</span><span class="p">,</span>
                             <span class="n">color</span><span class="o">=</span><span class="s1">&#39;b&#39;</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.3</span><span class="p">,</span> <span class="n">antialiased</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

            <span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="n">xlabel</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">fontsize</span><span class="p">)</span>
            <span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;$\mu\,\delta\nu_{y&#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">i</span><span class="p">)</span> <span class="o">+</span> <span class="sa">r</span><span class="s1">&#39;}^{A, A^\prime}\quad(\mathrm{u\,GHz})$&#39;</span><span class="p">,</span>
                       <span class="n">fontsize</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">fontsize</span><span class="p">)</span>
            <span class="n">plt</span><span class="o">.</span><span class="n">xticks</span><span class="p">(</span><span class="n">fontsize</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">fontsize</span><span class="p">)</span>
            <span class="n">plt</span><span class="o">.</span><span class="n">yticks</span><span class="p">(</span><span class="n">fontsize</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">fontsize</span><span class="p">)</span>

            <span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span><span class="n">numpoints</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">loc</span><span class="o">=</span><span class="s1">&#39;best&#39;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">fontsize</span><span class="p">)</span>
            <span class="n">plt</span><span class="o">.</span><span class="n">margins</span><span class="p">(</span><span class="mf">0.1</span><span class="p">)</span>
            <span class="n">plt</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">()</span>

        <span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">gcf</span><span class="p">()</span><span class="o">.</span><span class="n">clear</span><span class="p">()</span></div></div>
</pre></div>

           </div>
          </div>
          <footer>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2022, Patrick Mueller.</p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>